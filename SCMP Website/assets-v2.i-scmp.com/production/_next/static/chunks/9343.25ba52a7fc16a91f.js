try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="96e30b1c-9afe-45e4-812e-d7eef73cf244",e._sentryDebugIdIdentifier="sentry-dbid-96e30b1c-9afe-45e4-812e-d7eef73cf244")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4744,9343],{6336:(e,t,n)=>{n.d(t,{x:()=>a});let a="scmp_subscriptions"},14744:(e,t,n)=>{n.r(t),n.d(t,{ArticlePianoPaywallProvider:()=>c,useArticlePianoPaywallContext:()=>u}),n(19072),n(45582),n(86348),n(61189);var a=n(40932),i=n(69330),l=n(34266);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let s=(0,i.createContext)({}),c=e=>{let{children:t}=e,{0:n,1:a}=(0,i.useState)({}),r=(0,i.useMemo)(()=>o({},n),[n]),c=(0,i.useCallback)(e=>{null==a||a(t=>o(o({},t),{},{[e.articleEntityId]:e.state}))},[a]);return(0,l.jsx)(s.Provider,{value:{articlePianoPaywallStateMap:r,resetArticlePianoPaywallStateMap:()=>{null==a||a(()=>({}))},updateArticlePianoPaywallStateState:c},children:t})};c.displayName="ArticlePianoPaywallProvider";let u=()=>(0,i.useContext)(s)},24657:(e,t,n)=>{n.d(t,{RV:()=>m,aL:()=>f,f0:()=>g}),n(19072),n(45582),n(86348),n(32496);let a={fragment:{argumentDefinitions:i=[{defaultValue:null,kind:"LocalArgument",name:"first"},{defaultValue:null,kind:"LocalArgument",name:"sectionIds"}],kind:"Fragment",metadata:null,name:"helpersRosettaPaywallArticleSearchQuery",selections:[{alias:null,args:l=[{fields:[{kind:"Variable",name:"sectionIds",variableName:"sectionIds"}],kind:"ObjectValue",name:"filter"},{kind:"Variable",name:"first",variableName:"first"},{kind:"Literal",name:"orderBy",value:{direction:"DESC",field:"PUBLISHED_DATE"}}],concreteType:"ArticleConnection",kind:"LinkedField",name:"articles",plural:!1,selections:[{alias:null,args:null,concreteType:"ArticleEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Article",kind:"LinkedField",name:"node",plural:!1,selections:[r={alias:null,args:null,kind:"ScalarField",name:"entityId",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"headline",storageKey:null},s={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:i,kind:"Operation",name:"helpersRosettaPaywallArticleSearchQuery",selections:[{alias:null,args:l,concreteType:"ArticleConnection",kind:"LinkedField",name:"articles",plural:!1,selections:[{alias:null,args:null,concreteType:"ArticleEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Article",kind:"LinkedField",name:"node",plural:!1,selections:[r,o,s,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"532c7f0b9cfd7988a922677512089dc6",id:null,metadata:{},name:"helpersRosettaPaywallArticleSearchQuery",operationKind:"query",text:"query helpersRosettaPaywallArticleSearchQuery(\n  $first: Int!\n  $sectionIds: [String]\n) {\n  articles(first: $first, filter: {sectionIds: $sectionIds}, orderBy: {field: PUBLISHED_DATE, direction: DESC}) {\n    edges {\n      node {\n        entityId\n        headline\n        images {\n          url\n        }\n        id\n      }\n    }\n  }\n}\n"}};a.hash="b7c8548733cc146a2f0480854fa2cde3";var i,l,r,o,s,c=n(44061),u=n(51104),d=n.n(u),p=n(82915),y=n(29445);let g=(e,t)=>{var n;null==(n=c.IO.instance)||n.push(["setCustomVariable",e,t])},m=()=>{c.IO.loadedInstance&&document.body.classList.contains(y.M)&&(c.IO.loadedInstance.offer.close(),document.body.classList.remove(y.M))},f=async e=>{var t;let{environment:n,filter:a}=e,i={first:(null==a?void 0:a.size)??10,sectionIds:(null==a?void 0:a.sectionIds)??[]},l=await (0,p.fetchQuery)(n,v,i).toPromise();return{articles:(null==l||null==(t=l.articles)||null==(t=t.edges)?void 0:t.map(e=>{var t,n;return{entityId:e.node.entityId,headline:e.node.headline,imageUrl:null==(t=d()(null==e||null==(n=e.node)?void 0:n.images))?void 0:t.url}}))??[]}},v=a},29343:(e,t,n)=>{n.d(t,{N:()=>x}),n(19668),n(86401),n(92817);var a,i,l=n(44061),r=n(92891),o=n(40485),s=n(93933),c=n(69330),u=n(21482),d=n(21022),p=n(98970),y=n(92698),g=n(3478),m=n(58014),f=n(69754),v=n(35403),w=n(82673),b=n(43109),h=n(61020),I=n(72740),A=n(84852);let S={fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"rosettaConfigAppConfigQuery",selections:[{alias:null,args:a=[{kind:"Literal",name:"filter",value:{entityId:"rosetta"}}],concreteType:"AppConfig",kind:"LinkedField",name:"appConfig",plural:!1,selections:[i={alias:null,args:null,kind:"ScalarField",name:"json",storageKey:null}],storageKey:'appConfig(filter:{"entityId":"rosetta"})'}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"rosettaConfigAppConfigQuery",selections:[{alias:null,args:a,concreteType:"AppConfig",kind:"LinkedField",name:"appConfig",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:'appConfig(filter:{"entityId":"rosetta"})'}]},params:{cacheID:"ba87f29d45e0c4f16483caf962f6a201",id:null,metadata:{},name:"rosettaConfigAppConfigQuery",operationKind:"query",text:'query rosettaConfigAppConfigQuery {\n  appConfig(filter: {entityId: "rosetta"}) {\n    json\n    id\n  }\n}\n'}};S.hash="6f94a6408d173e20bb7b38467308b96e";var P=n(67571),O=n(82915),k=n(43074),C=n(93128),E=n(24657),_=n(6336),T=n(40021),D=n(499),$=n(89799);function L(e){return"production"===e.toLocaleLowerCase()?"production":"development"}let x=()=>{let e=(0,c.useRef)(!1),{navigatorInfo:t,navigatorInfoLoaded:n}=(0,o.md)(A.X),{isRosettaPianoExecutionReady:a,shouldSkipPianoExecution:i}=(0,T.x)(t,n),{registerRosettaCampaignPopupService:x}=(0,b.O)(),{handleUpdateRosettaState:j}=(0,$.n)(),{user:M}=(0,g.zI)(),{update:R}=(0,d.n)("scmp_subscriber",e=>e,{domain:u.$.account.cookieDomain,expires:1}),{set:V}=(0,p.Q)("scmp_subscriber",{parse:e=>e,stringify:e=>e}),{set:F}=(0,p.Q)(_.x,{defaultValue:[]}),K=(0,y.O)(),{getUrlAliasByUrl:U}=(0,D.n)(),{attachEventHandlers:q}=(0,k.b)(),{query:N}=(0,s.useRouter)(),H=(0,f.JO)(N.entityId)??"",[W,{execute:Q}]=(0,r.Y)(async()=>{if(!(e.current||(0,v.u)("piano"))){e.current=!0,l.Ay.setConfig({contentService:{apiKey:u.$.rosetta.contentService.apiKey,apiUri:`${u.$.rosetta.apiGatewayHost}/content-delivery/v2`,env:L(u.$.rosetta.contentService.environment)},piano:{aid:u.$.rosetta.piano.applicationId,apiUri:u.$.rosetta.piano.apiUri,env:"production"===u.$.rosetta.piano.environment.toLocaleLowerCase()?"production":"sandbox"},rosetta:{env:L(u.$.rosetta.environment),uri:`${u.$.rosetta.subscribeHost}`}}).setPageUrl(`${location.origin}${location.pathname}`),l.Ay.registerService("geo",{apiKey:u.$.rosetta.contentService.apiKey,apiUri:`${u.$.rosetta.apiGatewayHost}/gloc/v1`}),l.Ay.registerService("tierInfo",{apiKey:u.$.rosetta.contentService.apiKey,apiUri:`${u.$.corporateSubscriber.host}/tier`}),l.Ay.registerService("pianoUserInfo",{aid:u.$.rosetta.piano.applicationId,apiUri:`${u.$.rosetta.subscribeHost}/api/user`}),l.Ay.registerService("pianoPublisherConversions",{aid:u.$.rosetta.piano.applicationId,apiUri:`${u.$.rosetta.subscribeHost}/api/user/conversions`}),l.Ay.registerService("onboarding"),l.Ay.registerService("mastheadRenewPopUp"),l.Ay.registerService("cartAbandoner",{cookieDomain:u.$.account.cookieDomain,userTypeApiUri:`${u.$.general.userTypeHost}/client-id/`}),x();try{var t,n,a,r;let e,o;await l.Ay.init(),q(),await l.Ay.initRules();let{supportPiano:s=!0}=l.Ay.rulesEngine.getOutcome("guest")??{};(K===m.g.Homepage||K===m.g.Plus||K===m.g.Section&&(0,h.nu)(H).includes("plus"))&&!1===i&&l.Ay.execute();let c=l.Ay.rulesEngine.getFact("hasToken"),d=l.Ay.rulesEngine.getOutcome("user"),p=l.Ay.rulesEngine.getOutcome("tracking"),y=l.Ay.rulesEngine.getOutcome("user.isSCMPSubscriber"),g=null===l.Ay||void 0===l.Ay?void 0:l.Ay.rulesEngine.getOutcome("user.isSCMPPlusSubscriber");(e=>{let{tier:t}=e??{};(0,w.z2)(t)&&(0,I.EO)({tier:t})})(d),(0,E.f0)("SUBSCRIBER_STATUS",null==p?void 0:p.subscriberStatus),e=(null==M||null==(a=M.username)||null==(r=a.split)||null==(r=r.call(a,"@"))?void 0:r[0])??`${(null==M?void 0:M.firstname)??""} ${(null==M?void 0:M.lastname)??""}`,(0,w.z2)(null==e?void 0:e.trim())&&(0,E.f0)("USER_NAME",e),(0,E.f0)("subscribeUrl",((o=new URL(u.$.rosetta.subscribeHost)).searchParams.set("destination",location.origin),o.toString())),R((null==p?void 0:p.subscriberStatus)??""),V((null==p?void 0:p.subscriberStatus)??""),F([...g?["scmp-plus"]:[]]),j({contentServiceUserInfo:{isSubscriptionEnabled:s},instance:l.Ay,isScmpPlusSubscriber:g,isScmpSubscriber:y,tracking:p,user:d},"success");let f=U(window.location.href);["/scmp_comments","/newsletters"].every(e=>!f.startsWith(e))&&(null==(n=l.Ay.getService("cartAbandoner"))||n.placeTrigger({hasToken:c,isRosetta:!1,isSCMPSubscriber:y})),null==(t=l.Ay.getService("mastheadRenewPopUp"))||t.addMastheadRenewPopUpScript()}catch(e){j(void 0,"error",e instanceof Error?e:Error(JSON.stringify(e)))}try{l.Ay.initiateSwGLinkingFlow()}catch(e){}}});(0,c.useEffect)(()=>{!e.current&&a&&Q()},[Q,a]);let{rosettaConfigState:B}=(()=>{let e=(0,O.useRelayEnvironment)(),[t,n]=(0,r.Y)(async()=>{var t;let n=await (0,O.fetchQuery)(e,S,{},{fetchPolicy:"store-or-network"}).toPromise();if(!(null!=n&&null!=(t=n.appConfig)&&t.json))return;let a=n.appConfig.json;return"production"===u.$.general.env?a.production:a.dev});return(0,P.u)(()=>{n.execute()}),{rosettaConfigState:t}})();(0,c.useEffect)(()=>{var e;let{isShowPremiumPromo:t=!1,litePaywallTimeFrame:n=3,oldArticleTimeframe:a=15,paywallCampaign:i}=(null==(e=B.result)?void 0:e.paywallSettings)??{};j({appSettings:{isShowPremiumPromo:t,litePaywallTimeFrame:n,oldArticleTimeframe:a,paywallCampaignName:null==i?void 0:i.name}})},[j,B]),(0,C.lv)(),(0,c.useEffect)(()=>{let e;if(K!==m.g.Article)return;let t=!1,n=()=>{var n;t||(e=null==(n=l.Ay.setupPaywallCheckoutForPWA({account:{debugLog:u.$.account.debugLog,gtmContainerId:u.$.googleTagManager.containerId,isInWebView:!1,recaptchaContainerId:u.$.account.recaptchaContainerId,recaptchaSiteKey:u.$.account.recaptchaSiteKey,url:u.$.account.scmpAccountHost},scmp:{url:`https://${u.$.domain.scmp}`}}))?void 0:n.cleanup)};return l.Ay.on("onReady",n),()=>{var a;t=!0,null==(a=e)||a(),l.Ay.off("onReady",n)}},[K])}},29445:(e,t,n)=>{n.d(t,{M:()=>a});let a="offer-meter-open"},40021:(e,t,n)=>{n.d(t,{x:()=>i});var a=n(69330);let i=(e,t)=>({isRosettaPianoExecutionReady:!!t,shouldSkipPianoExecution:(0,a.useMemo)(()=>null!=e&&!!e.isLightHouseCrawler||(null==e||!e.isBot)&&(null==e?void 0:e.botScoreGroup)==="1-29",[e])})},43074:(e,t,n)=>{n.d(t,{b:()=>O});var a=n(40932),i=n(2798);n(86401),n(19072),n(45582),n(86348),n(74397),n(61189),n(1282),n(78801);var l=n(44061),r=n(40485),o=n(20340),s=n.n(o),c=n(69330),u=n(82915),d=n(54389),p=n(3478),y=n(74301),g=n(14744),m=n(2096),f=n(72740),v=n(6321),w=n(29445),b=n(54688),h=n(24657),I=n(89799);let A=["message"];function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let O=()=>{let e=(0,u.useRelayEnvironment)(),{openLoginDialog:t}=(0,m.g)(),{handleUpdateRosettaState:n}=(0,I.n)(),{isLoggedIn:a}=(0,r.md)(y.b),{updateArticlePianoPaywallStateState:o}=(0,g.useArticlePianoPaywallContext)();return{attachEventHandlers:(0,c.useCallback)(()=>{let r=e=>{let{maxViews:t,views:a,viewsLeft:i}=e;[1,50].includes(t)||(n({meterData:e}),(0,d.g$)("paywallMeterViews",`${a}`),(0,d.g$)("paywallMeterViewsLeft",`${i}`))};l.Ay.on("experienceExecute",async e=>{var t,a,i,r,o,s,c,u,d;(null==(o=l.IO.loadedInstance)||null==(o=o.customVariables)?void 0:o.ip_access_user)&&(null==(s=l.IO.loadedInstance)||null==(s=s.customVariables)?void 0:s.ip_access_client)&&((0,v.W5)({ipClientName:null==(c=l.IO.loadedInstance)||null==(c=c.customVariables)?void 0:c.ip_access_client}),(0,f.EO)({product:"SCMP - IP whitelisting"}),null!=(u=l.IO.loadedInstance)&&null!=(u=u.customVariables)&&u.ip_ezproxy_user?(0,f.EO)({ipClientIsEZproxy:"EZproxy"}):(0,f.EO)({ipClientIsEZproxy:"IP whitelisting"}));let p="paywallNotRequired";(null==(t=e.result)||null==(t=t.events)||null==(a=t.find)?void 0:a.call(t,e=>{var t;return(null==e||null==(t=e.eventParams)?void 0:t.displayMode)==="inline"}))&&(p="requiresInlinePaywall"),(null==(i=e.result)||null==(i=i.events)||null==(r=i.find)?void 0:r.call(i,e=>{var t;return(null==e||null==(t=e.eventParams)?void 0:t.displayMode)==="modal"}))&&(p="requiresModalPaywall");let y=((null==(d=l.IO.loadedInstance)||null==(d=d.customVariables)?void 0:d.ip_access_user)??!1)||Object.values(l.Ay.rulesEngine.getFact("ipRangeAccess")??{}).some(Boolean);l.Ay.rulesEngine.addFact("hasIpAccess",y),l.Ay.rulesEngine.setReady("pianoExperience"),await l.Ay.rulesEngine.run();let g=null===l.Ay||void 0===l.Ay?void 0:l.Ay.rulesEngine.getOutcome("user.hasSCMPLiteAccessRight");n({hasIpAccess:y,hasPianoExperienceExecuted:!0,hasScmpDigitalAccessRight:null===l.Ay||void 0===l.Ay?void 0:l.Ay.rulesEngine.getOutcome("user.hasSCMPDigitalAccessRight"),hasScmpLiteAccessRight:g,hasScmpPlusAccessRight:null===l.Ay||void 0===l.Ay?void 0:l.Ay.rulesEngine.getOutcome("user.hasSCMPPlusAccessRight")}),b.R.emit("showPaywall",p);let{ipAccess:m,ipRangeContractIds:w,siteLicenseContractIds:h}=l.Ay.rulesEngine.getOutcome("tracking.ga4")??{};if(h||w){let e=[h,w].filter(e=>null!==e).join(",");(0,f.EO)({ga4SiteLicensing:e})}let I=null==m?void 0:m.id,A=null==m?void 0:m.type;if(I&&A)switch(A){case"ezproxy":(0,f.EO)({ga4Ezproxy:I});break;case"whitelisting":(0,f.EO)({ga4IpWhitelisting:I})}}),l.Ay.on("showOffer",e=>{"modal"===e.displayMode&&document.body.classList.add(w.M),(()=>{if(!e.activeMeters)return;let t=JSON.parse(e.activeMeters);if(!t||0===t.length)return;let[n]=t,{maxViews:i,totalViews:o,viewsLeft:s}=n;if(o>5&&5===i&&0===s&&(r(n),a)){var c;null==(c=l.Ay.getService("cartAbandoner"))||c.showCartAbandonerOfferOnNextVisit()}})()}),l.Ay.on("meterActive",e=>{r(e)}),l.Ay.registerChannelListener("pwa/request-from-template"),l.Ay.on("COMM_CHANNEL",async n=>{var a,r,c,u,y,g;let{message:m}=n,v=(0,i.A)(n,A);if(m.requestType){switch(m.requestType){case"action/showPaywall":b.R.emit("showPaywall","requiresInlinePaywall"),m.responseData="ready";break;case"action/trackGA4":(0,f.UL)(m.requestData,{untyped:!0});break;case"appConfig/rosetta":case"context/appConfig":let n=l.Ay.getRosettaAppConfig();if(!n)break;m.responseData=n;break;case"article/search":let i=await (0,h.aL)({environment:e,filter:{sectionIds:(null==(a=m.requestData)?void 0:a.articleSectionIds)??[]}});m.responseData=i;break;case"cartAbandoner":{let e=l.Ay.getService("cartAbandoner");switch(null==(g=m.requestData)?void 0:g.action){case"cartAbandonerOfferShown":null==e||e.cartAbandonerOfferShown();break;case"clearCookies":null==e||e.cleanupCookies();break;case"login":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{trigger_point:"abandoned cart popup"}});break;case"registerOfferShown":null==e||e.registerOfferShown()}return}case"context/subscriptionStatus":{let e=l.Ay.rulesEngine.getOutcome("user");if(!e)break;m.responseData=e;break}case"localStorage/get":let w=null==(r=m.requestData)?void 0:r.localStorage;null!=w&&w.includes("rSDK_")&&(m.responseData={localStorageResult:localStorage.getItem(w),localStorageVar:w});break;case"localStorage/set":let I=null==(c=m.requestData)?void 0:c.localStorage,A=null==(u=m.requestData)?void 0:u.localStorageVal;null!=I&&I.includes("rSDK_")&&A&&((0,d.g$)(I,JSON.stringify(A)),m.responseData={localStorageResult:A,localStorageVar:I});break;case"login/archive":case"login/exclusiveHardPaywall":case"login/freeTrialPromo":case"login/lite":case"login/meter2":case"login/meter4":case"login/newsletter":case"login/paywall":case"login/regiwall":case"login/velocity":{let e={"login/archive":{ga4CustomParameter:{paywall_type:"archive_wall",trigger_point:"paywall"},wallType:"archive"},"login/exclusiveHardPaywall":{ga4CustomParameter:{paywall_type:"exclusive_wall",trigger_point:"paywall"},wallType:"exclusiveWall"},"login/freeTrialPromo":{ga4CustomParameter:{trigger_point:"paywall"},wallType:"freeTrialPromo"},"login/lite":{ga4CustomParameter:{paywall_type:"lite_wall",trigger_point:"paywall"},wallType:"lite"},"login/meter2":{ga4CustomParameter:{paywall_type:"meter_wall_2",trigger_point:"paywall"},wallType:"meter2"},"login/meter4":{ga4CustomParameter:{paywall_type:"meter_wall_4",trigger_point:"paywall"},wallType:"meter4"},"login/newsletter":{ga4CustomParameter:{paywall_type:"newsletter_wall",trigger_point:"paywall"},wallType:"newsletter"},"login/paywall":{ga4CustomParameter:{paywall_type:"paywall",trigger_point:"paywall"},wallType:"paywall"},"login/regiwall":{description:"To continue reading, create your free account or log in now",ga4CustomParameter:{paywall_type:"sign in wall",trigger_point:"paywall"},wallType:"regi"},"login/velocity":{ga4CustomParameter:{paywall_type:"velocity_wall",trigger_point:"paywall"},wallType:"velocity"}}[m.requestType];e&&t(P(P({},e),{},{destination:window.location.origin+window.location.pathname}));break}case"login/google/regiwall":(0,d.g$)("REGI_WALL_LOGIN_METHOD","Google"),location.href=(0,p.E6)({registerSource:"loginwall"});break;case"rendered/paywall":let S=m.requestData.articleEntityId,O=m.requestData.paywallType;S&&(null==o||o({articleEntityId:S,state:`shown${s()(O)}Paywall`}));break;case"rule/facts":m.responseData="*"===m.requestData.name?l.Ay.rulesEngine.getAllFacts():l.Ay.rulesEngine.getFact(m.requestData.name);break;case"rule/outcome":m.responseData="*"===m.requestData.name?l.Ay.rulesEngine.getAllOutcome():l.Ay.rulesEngine.getOutcome(m.requestData.name)??{};break;case"tp/customVariables":m.responseData=(null==(y=l.IO.loadedInstance)?void 0:y.customVariables)??{};break;default:return}l.Ay.sendMessage("pwa/response-from-app",P(P({},v),{},{message:m}))}})},[e,n,a,t,o])}}},54688:(e,t,n)=>{n.d(t,{R:()=>a});let a=new(n(93569)).A},61020:(e,t,n)=>{n.d(t,{kl:()=>i,nu:()=>l,xE:()=>r}),n(86401);var a=n(75018);let i=e=>{let t=l(e),n=t.includes("plus"),a=r(e),i=e=>t.includes(e)||n&&a===e;return{includeAsiaDiscoveryWidget:i("asia-discovery"),includeChinaFutureTechDiscoveryWidget:i("china-future-tech-discovery"),includeChinaScienceDiscoveryWidget:i("china-science-discovery"),includeComment:i("comment"),includeFocusArticle:i("focus-article"),includeMostPopular:i("most-popular"),includeMultimedia:i("multimedia"),includeOpenQuestionsSeriesDiscoveryWidget:i("open-questions-series-discovery"),includePlus:n,includeThisWeekInAsiaDiscovery:i("this-week-in-asia-discovery"),includeTrendingTopics:i("trending-topics")}},l=e=>{switch(e){case a.u.asia.entityId:return["this-week-in-asia-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.business.entityId:case a.u.economy.entityId:case a.u.hongKong.entityId:return["plus","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.china.entityId:return["china-science-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.chinaFutureTech.entityId:return["focus-article","plus","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.comment.entityId:case a.u.kPop.entityId:case a.u.sport.entityId:return["recommended-for-you","comment","multimedia","trending-topics"];case a.u.lifestyle.entityId:return["post-magazine","comment","recommended-for-you","multimedia","trending-topics"];case a.u.news.peopleAndCulture.entityId:return["post-magazine","recommended-for-you","comment","multimedia","trending-topics"];case a.u.olympic.entityId:return["recommended-for-you","multimedia","most-popular"];case a.u.tech.entityId:return["china-future-tech-discovery","recommended-for-you","comment","multimedia","trending-topics"];case a.u.thisWeekInAsia.entityId:return["asia-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.us.entityId:case a.u.us.usElections.entityId:return["focus-article","comment","recommended-for-you","multimedia","trending-topics"];case a.u.world.entityId:return["open-questions-series-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];default:return["comment","recommended-for-you","multimedia","trending-topics","most-popular"]}},r=e=>({[a.u.chinaFutureTech.entityId]:"china-science-discovery"})[e]??"china-future-tech-discovery"},89799:(e,t,n)=>{n.d(t,{n:()=>c}),n(19072),n(45582),n(86348),n(61189);var a=n(40932),i=n(40485),l=n(69330),r=n(75633);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let c=()=>{let e=(0,i.Xr)(r.E);return{handleUpdateRosettaState:(0,l.useCallback)((t,n,a)=>{e(e=>{var i,l;let r;return{error:a??(null==e?void 0:e.error),result:s(s({},null==e?void 0:e.result),t),status:(i=n??"loading",l=null==e?void 0:e.status,r={error:3,loading:1,"not-executed":0,success:2},l?r[i]>r[l]?i:l:i)}})},[e])}}},91711:(e,t,n)=>{n.d(t,{R:()=>y,f:()=>g}),n(86401),n(45582),n(86348);var a=n(44061),i=n(40485),l=n(69330),r=n(75018),o=n(86223),s=n(46336),c=n(1673),u=n(75633);let d=[r.u.hongKong.entityId,r.u.china.entityId,r.u.asia.entityId,r.u.thisWeekInAsia.entityId,r.u.business.entityId,r.u.economy.entityId,r.u.tech.entityId,r.u.world.entityId,r.u.comment.entityId],p=[r.u.lifestyle.entityId,r.u.postMagazine.entityId,r.u.sport.entityId],y=e=>{let{checkTargetUserGeoLocation:t}=g(),n=(0,o.Q)(s.w.breakpoints.down("desktop"),!1);return{getPaywallPosition:(0,l.useCallback)(a=>{let i=t(["US"]);if(!i||a.filter(e=>"p"===e.type).length<10)return null;let l=(0,c.e0)(e,d,{isCheckArticleFirstSectionOnly:!0}),r=(0,c.e0)(e,p,{isCheckArticleFirstSectionOnly:!0}),o=(e,t)=>{let n=0;for(let[a,i]of t.entries()){if(n===e)return a;"p"===i.type&&n++}};return i&&l?o(1,a):i&&r?o(n?7:6,a):null},[e,t,n])}},g=()=>{var e,t,n;let l=(0,i.md)(u.E),r=((null==l||null==(e=l.result)?void 0:e.hasPianoExperienceExecuted)&&(null==(t=a.IO.loadedInstance)?void 0:t.customVariables.geoLocation))??(null==l||null==(n=l.result)||null==(n=n.instance)?void 0:n.rulesEngine.getOutcome("guest.userGeolocation"));return{checkTargetUserGeoLocation:e=>!!e&&e.includes(r)}}},93128:(e,t,n)=>{n.d(t,{Fg:()=>m,lv:()=>y,NS:()=>g}),n(86401),n(45582),n(86348),n(32496);let a={kind:"InlineDataFragment",name:"hooksVelocityWallThresholdABTest"};a.hash="24f4781ebcb72939e081458116b35b95";var i=n(44061),l=n(61044),r=n(69330),o=n(82915),s=n(21482),c=n(99103);n(74397);var u=n(96348);let d=e=>{let{activeExperimentStates:t}=(0,u.h)();return{experiment:(0,r.useMemo)(()=>t?Object.values(t).find(t=>t.experimentName===e):null,[e,t])}};var p=n(91711);let y=()=>{let{experiment:e}=d(i.HG.SCMP_LITE_CORE_GEOS_TEST_NAME),{experiment:t}=d(i._p.LTS_AB_TEST_NAME),{experiment:n}=d("Contextual Paywall Messaging"),{experiment:a}=d("AppFreeTrialPromoSignInWall");(0,r.useEffect)(()=>{[t,e,n,a].forEach(e=>{e&&i.yH.setABTestVariablePianoCustomVariable({experimentId:e.id,testName:e.experimentName,variant:e.variation})})},[n,t,e,a])},g=e=>{var t;let n=(0,o.readInlineData)(a,e),{experiment:u}=d("Velocity Wall Threshold"),p=s.$.rosetta.piano.applicationId,y=(0,l.J)(i._p.getLtsBucketFromLocalStorage(p)??0),g=(0,r.useMemo)(()=>{var e;return null==(e=n.paywallTypes)?void 0:e.map(e=>null==e?void 0:e.entityId)},[n.paywallTypes]),m=null==g?void 0:g.includes(c.X.notVelocity.entityId),f=(0,r.useMemo)(()=>{var e;let t=0===y.current;return!!(null!=u&&null!=(e=u.variation)&&e.name)&&t&&!m&&(null==g?void 0:g.includes(c.X.velocity.entityId))},[null==u||null==(t=u.variation)?void 0:t.name,m,g,y]);return{applyVelocityWallThresholdLogic:(0,r.useCallback)(()=>{switch(null==u?void 0:u.variation.name){case"0":return null==g?void 0:g.includes(c.X.velocity.entityId);case"1":return null==g?void 0:g.includes(c.X.velocity2kViews.entityId);case"2":return null==g?void 0:g.includes(c.X.velocity3kViews.entityId);default:return!1}},[null==u?void 0:u.variation.name,g]),shouldApplyVelocityWallThresholdTest:f}},m=()=>{let{experiment:e}=d("LTS 70 Hard Paywall"),{checkTargetUserGeoLocation:t}=(0,p.f)(),n=s.$.rosetta.piano.applicationId,a=(0,l.J)(i._p.getLtsBucketFromLocalStorage(n)??0).current,o=t(["HK","SG"]);return{ltsHardPaywallABTestTag:(0,r.useMemo)(()=>{if(7>+a)return"";if(o){var t;return(null==e||null==(t=e.variation)?void 0:t.name)==="1"?"LTS-Hard-Paywall/hard-paywall-variant":""}return"LTS-Hard-Paywall/hard-paywall-variant"},[e,a,o])}}},99103:(e,t,n)=>{n.d(t,{X:()=>a});let a={notArchive:{entityId:"511139",entityUuid:"c4365f23-40c4-47d5-a503-5c7f58c7b2b5",name:"Not archive"},notVelocity:{entityId:"511138",entityUuid:"8f904aa8-bd1b-4a06-93fc-104e3559fd4e",name:"Not velocity"},scmpPlus:{entityId:"517129",entityUuid:"716f570e-3083-4138-a080-47d3830fafe3",name:"SCMP Plus"},signIn:{entityId:"524756",entityUuid:"c7dede75-563e-4cf8-8475-ce766b3a3273",name:"Sign In Wall"},velocity:{entityId:"507836",entityUuid:"a847a765-95e0-444a-a4df-76b85c9d089b",name:"velocity"},velocity2kViews:{entityId:"521128",name:"Velocity 2k"},velocity3kViews:{entityId:"521129",name:"Velocity 2k"}}}}]);
//# sourceMappingURL=9343.25ba52a7fc16a91f.js.map