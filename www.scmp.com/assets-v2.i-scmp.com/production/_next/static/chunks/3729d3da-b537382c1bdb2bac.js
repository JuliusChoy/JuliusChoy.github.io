try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="79cdcf60-f329-4ac5-8529-32324f0ea1fd",e._sentryDebugIdIdentifier="sentry-dbid-79cdcf60-f329-4ac5-8529-32324f0ea1fd")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3308],{44061:(e,t,n)=>{let r;n.d(t,{Ay:()=>ud,HG:()=>ut,Hu:()=>o2,IO:()=>K,_p:()=>oF,pU:()=>uc,yH:()=>lV});var i,s,a=n(37473),l=n(50884),o=n(39796),u=n(69969),c=n(18402),d=n(26833),p=n(68522),m=n(10860),f=n(89663),g=n(18156),y=n(4521),h=n(14932),b=n(76813),v=n(55352),P=n(15382),S=n(32977),w=n(99523),C=n(93784),A=n(93111),k=n(55975),T=n(32827),E=n(18911),R=n(14010);let I=typeof window>"u",M=e=>!(0,l.A)(e),O=A("@product/rosetta-sdk");function D(e){return{debug:t(`debug:${e}`),info:t(`info:${e}`),error:t(`error:${e}`)};function t(e){return function(...t){O.extend(e)(...t.map(e=>"object"==typeof e?JSON.stringify(e):e))}}}let x=O.extend("utils/cache"),$={},L=(e,t)=>{I?x("setCache() is client side only"):M(t)?M($[e])?x(`setCache(): key [${String(e)}] already exists, will not overwrite`):(x(`setCache(): setting cache for key [${String(e)}]`),$[e]=t):x("setCache(): value is empty")},_=e=>I?void x("getCache is client side only"):M($[e])?$[e]:void x(`getCache(): key [${String(e)}] does not exists`);function N(e,t,n,r,i,s,a){try{var l=e[s](a),o=l.value}catch(e){n(e);return}l.done?t(o):Promise.resolve(o).then(r,i)}function F(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){N(s,r,i,a,l,"next",e)}function l(e){N(s,r,i,a,l,"throw",e)}a(void 0)})}}function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e){var t=function(e,t){if("object"!=U(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=U(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==U(t)?t:t+""}function j(e,t,n){return(t=B(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null==arguments[t]?{}:arguments[t];t%2?Y(Object(n),!0).forEach(function(t){j(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function W(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.includes(n)||({}).propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let H=new Map;function V(e){if(typeof window>"u"||typeof document>"u")return Promise.resolve();let{src:t,insertLocation:n}=e;if(H.has(t))return H.get(t);let r=new Promise((e,r)=>{var i,s;let a=document.querySelector(`script[src="${t}"]`);if(a)return"true"===a.dataset.loaded?void e():(a.addEventListener("load",()=>{a.dataset.loaded="true",e()},{once:!0}),void a.addEventListener("error",()=>{H.delete(t),r(Error(`Failed: ${t}`))},{once:!0}));let l=document.createElement("script");switch(l.src=t,l.async=!0,l.onload=()=>{l.dataset.loaded="true",e()},l.onerror=()=>{H.delete(t),r(Error(`Failed: ${t}`))},n){case"before-head-first-script":null==(i=document.getElementsByTagName("head").item(0))||i.prepend(l);break;case"before-existing-scripts":let o=document.getElementsByTagName("script").item(0);null==o||null==(s=o.parentNode)||s.insertBefore(l,o)}});return H.set(t,r),r}function q(){return(q=F(function*(){if(typeof window>"u"||!window.ApplePaySession)return!1;try{return window.ApplePaySession.canMakePaymentsWithActiveCard(`merchant.${window.location.hostname}.stripe`)}catch(e){return console.error(Error("failed to check is support apple pay",{cause:e})),!1}})).apply(this,arguments)}var K=class e{static get instance(){return typeof window>"u"?null:(void 0===window.tp&&(window.tp=[]),Array.isArray(window.tp),window.tp)}static get loadedInstance(){let t=e.instance;return Array.isArray(t)?null:t}static loadScript(e="production"){return F(function*(){return V({src:"sandbox"===e?"//sandbox.tinypass.com/api/tinypass.min.js":"//cdn.tinypass.com/api/tinypass.min.js",insertLocation:"before-existing-scripts"})})()}static loadAdBlockDetectionScript(){return F(function*(){try{yield Promise.all([(V({src:"//www.npttech.com/advertising.js",insertLocation:"before-head-first-script"}),new Promise(e=>{let t="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",n=new XMLHttpRequest;n.timeout=1e3,n.addEventListener("readystatechange",function(){n.readyState===XMLHttpRequest.DONE&&e(0===n.status||n.responseURL!==t)}),n.open("HEAD",t,!0),n.send(null)}))])}catch(t){let e=new Date;e.setTime(e.getTime()+3e5),document.cookie=`__adblocker=true; expires="${e.toUTCString()}"; path=/`}})()}static setup(t){return F(function*(){var n;let r=e.instance;if(typeof window>"u"||!r)throw Error("should not call in server environment");let i=yield function(){return q.apply(this,arguments)}();if(r.push(["setAid",t.aid]),r.push(["setSandbox","sandbox"===t.env]),r.push(["setEndpoint","sandbox"===t.env?"https://sandbox.tinypass.com/api/v3":"https://buy.tinypass.com/api/v3"]),r.push(["setDebug",null!=(n=t.debug)&&n]),r.push(["setUseTinypassAccounts",!1]),r.push(["setUsePianoIdUserProvider",!1]),r.push(["setUsePianoIdLiteUserProvider",!0]),r.push(["setCustomVariable","hasApplePayAvailable",i]),r.push(["setMaxCookieExpirationInDays",60]),r.push(["setPageURL",location.origin+location.pathname]),null!=t&&t.cxenseSiteId&&r.push(["setCxenseSiteId",t.cxenseSiteId]),null!=t&&t.zone&&r.push(["setZone",t.zone]),t.applePayMerchantId&&r.push(["setApplePayMerchantId",t.applePayMerchantId]),t.externalJWTToken){let e=(0,k.default)(t.externalJWTToken),n=Math.floor(Date.now()/1e3),i=Number(e.exp);!isNaN(i)&&i>=n&&r.push(["setExternalJWT",t.externalJWTToken])}return window.location.host.includes("scmp-com")&&r.push(["setComposerHost","https://c2-piano-io"+window.location.host.substring(window.location.host.indexOf("."))]),new Promise(t=>{r.push(["init",()=>{t(e.loadedInstance)}])})})()}static setContentData(t){var n,r,i;let s=e.instance;s&&(s.push(["setTags",null==(n=t.tags)?[]:n]),Object.entries(null==(r=t.customVariables)?{}:r).forEach(([e,t])=>s.push(["setCustomVariable",e,t])),t.contentCreated&&s.push(["setContentCreated",t.contentCreated]),t.contentAuthor&&s.push(["setContentAuthor",t.contentAuthor]),t.contentSection&&s.push(["setContentSection",t.contentSection]),t.contentIsNative&&s.push(["setContentIsNative",null==(i=t.contentIsNative)||i]),t.pageUrl&&s.push(["setPageURL",t.pageUrl]))}};let z=["DIGITIMES","2024JAN","BOGOF","IntroABTest(B)","AddInk","Upgrade(Intro)","Upgrade(50%)","Downgrade(50%)","Downgrade(Intro)","PlusSoftLaunch(1M)","PlusSoftLaunch(2M)","Rack","Intro","Trial","USElection2024","DIGITIMES","FreeTrial(3M)","Upgrade(Lite-Dgt)","AlipayHK","AlipayHKTest",...(r=["0","1","2"],["N","L","M","H"].flatMap(e=>r.map(t=>`LTS(${e}-${t})`))),...["50%","70%","85%"].map(e=>`LiteABTest(${e})`),...["70%","85%"].map(e=>`LiteCoreGeosABTest(${e})`)],J=["HKD","MYR","SGD","USD-H","USD","PHP","AUD","CAD","EUR","GBP"],X=["digital","digitalFree","digitalLite","digitalB2B","digitalAccessGranted","plus","ePaper","print","yp","ypPrint","ypEpaper","ypSparkDigital","ypSparkEpaper","ypSparkPrint","postiesDigital","postiesEPaper"],Z=["v1WeekendPrint","v1FriToSunPrint","v1MonToFriPrint","v1MonToSatPrint","v1DailyPrint"],Q=["scmpPlusDailyPrintBundle","scmpPlusWeekdayPrintBundle","scmpPlusWeekendPrintBundle"],ee=["scmpAndScmpPlusEPaper"],et=["dailyEPaperBundle","weekendPrintBundle","weekdayPrintBundle","dailyPrintBundle","scmpPlusYp","postiesEPaperAndDigital","postiesPrintAndDigital","scmpAndYpSparkDigital","scmpPrintAndYpSparkDigitalAndPrint","scmpEpaperAndYpSparkDigitalAndPrint","scmpEpaperAndYpSparkDigitalAndEpaper","ypOnlineScmpBundle",...ee,...Q,"b2bScmpDigital","b2bScmpEpaper","b2bScmpDigitalAndPlus","b2bScmpDigitalAndEpaper","b2bScmpDigitalAndEpaperAndPlus","b2bScmpDigitalAndPrint","b2bScmpDigitalAndPrintAndEPaper","b2bScmpDigitalAndPrintAndEPaperAndPlus","accessGrantedScmpDigital","accessGrantedScmpEpaper","accessGrantedScmpPlus"],en=Object.fromEntries([...X,...Z,...et,...Q].map(e=>[e,e])),er=G({digital:{type:"standard",name:"SCMP Digital",family:["scmp"],additionalImpliedAccessibleResources:[en.digitalLite]},digitalFree:{type:"standard",name:"SCMP Digital - Free",family:["scmp"],additionalImpliedAccessibleResources:[en.digital,en.digitalLite]},digitalLite:{type:"standard",name:"SCMP Digital - Lite",family:["scmp"]},digitalB2B:{type:"standard",name:"SCMP Digital - B2B",family:["scmp"],additionalImpliedAccessibleResources:[en.digital,en.digitalLite]},digitalAccessGranted:{type:"standard",name:"SCMP Digital - Access Granted",family:["scmp"],additionalImpliedAccessibleResources:[en.digital,en.digitalLite]},ePaper:{type:"standard",name:"SCMP ePaper",family:["scmp"]},plus:{type:"standard",name:"SCMP Plus",family:["scmp"]},print:{type:"standard",name:"Print Bundle",isAddressRequired:!0,family:["scmp"]}},{v1WeekendPrint:{type:"standard",name:"SCMP Digital",isAddressRequired:!0,family:["scmp"],additionalImpliedAccessibleResources:[en.digitalLite,en.digital,en.print]},v1FriToSunPrint:{type:"standard",name:"SCMP Digital",isAddressRequired:!0,family:["scmp"],additionalImpliedAccessibleResources:[en.digitalLite,en.digital,en.print]},v1MonToFriPrint:{type:"standard",name:"SCMP Digital",isAddressRequired:!0,family:["scmp"],additionalImpliedAccessibleResources:[en.digitalLite,en.digital,en.print]},v1MonToSatPrint:{type:"standard",name:"SCMP Digital",isAddressRequired:!0,family:["scmp"],additionalImpliedAccessibleResources:[en.digitalLite,en.digital,en.print]},v1DailyPrint:{type:"standard",name:"SCMP Digital",isAddressRequired:!0,family:["scmp"],additionalImpliedAccessibleResources:[en.digitalLite,en.digital,en.print]}}),ei={yp:{type:"standard",name:"YP",family:["yp"]},ypPrint:{type:"standard",name:"YP Print",family:["yp"],isAddressRequired:!0},ypEpaper:{type:"standard",name:"YP ePaper",family:["yp"]},ypSparkDigital:{type:"standard",name:"YP Spark Digital",family:["yp"]},ypSparkEpaper:{type:"standard",name:"YP Spark ePaper",family:["yp"]},ypSparkPrint:{type:"standard",name:"YP Spark Print",family:["yp"]}},es={postiesDigital:{type:"standard",name:"Posties Digital",family:["posties"]},postiesEPaper:{type:"standard",name:"Posties ePaper",family:["posties"]},postiesPrintAndDigital:{type:"standard",name:"Posties Digital",legacyName:"Posties Print + Digital",isAddressRequired:!0,family:["posties"]}},ea=G(G(G({},er),ei),es),el=G(G(G({},{scmpAndScmpPlusEPaper:{type:"bundle",name:"SCMP Digital + Plus + Daily ePaper",standardResources:[ea.digital,ea.plus,ea.ePaper],family:["scmp"]}}),{scmpPlusDailyPrintBundle:{type:"bundle",name:"SCMP Digital + Plus + Daily Print + Daily ePaper",standardResources:[ea.digital,ea.plus,ea.ePaper,ea.print],family:["scmp"]},scmpPlusWeekdayPrintBundle:{type:"bundle",name:"SCMP Digital + Plus + Weekday Print + Weekday ePaper",standardResources:[ea.digital,ea.plus,ea.ePaper,ea.print],family:["scmp"]},scmpPlusWeekendPrintBundle:{type:"bundle",name:"SCMP Digital + Plus + Weekend Print + Weekend ePaper",standardResources:[ea.digital,ea.plus,ea.ePaper,ea.print],family:["scmp"]}}),{dailyEPaperBundle:{type:"bundle",name:"SCMP Digital + Daily ePaper",standardResources:[ea.digital,ea.ePaper],family:["scmp"]},weekendPrintBundle:{type:"bundle",name:"SCMP Digital + Weekend Print + Weekend ePaper",standardResources:[ea.digital,ea.ePaper,ea.print],family:["scmp"]},weekdayPrintBundle:{type:"bundle",name:"SCMP Digital + Weekday Print + Weekday ePaper",standardResources:[ea.digital,ea.ePaper,ea.print],family:["scmp"]},dailyPrintBundle:{type:"bundle",name:"SCMP Digital + Daily Print + Daily ePaper",standardResources:[ea.digital,ea.ePaper,ea.print],family:["scmp"]}}),eo={scmpPlusYp:{type:"bundle",name:"SCMP Digital + YP",standardResources:[ea.digital,ea.yp],family:["scmp","yp"]}},eu={postiesEPaperAndDigital:{type:"bundle",name:"Posties: ePaper + Digital",legacyName:"Posties ePaper + Digital",standardResources:[ea.postiesDigital,ea.postiesEPaper],family:["posties"]}},ec={ypOnlineScmpBundle:{type:"bundle",name:"YP Online SCMP Bundle",standardResources:[ea.digitalAccessGranted],family:["scmp"]},scmpAndYpSparkDigital:{type:"bundle",name:"SCMP Digital + YP Spark Digital",standardResources:[ea.digital,ea.yp,ea.ypSparkDigital],family:["scmp","yp"]},scmpPrintAndYpSparkDigitalAndPrint:{type:"bundle",name:"SCMP Print + YP Spark Digital + YP Spark Print",standardResources:[ea.print,ea.yp,ea.ypSparkDigital,ea.ypSparkPrint],family:["scmp","yp"]},scmpEpaperAndYpSparkDigitalAndPrint:{type:"bundle",name:"SCMP ePaper + YP Spark Digital + YP Spark Print",standardResources:[ea.ePaper,ea.yp,ea.ypSparkDigital,ea.ypSparkPrint],family:["scmp","yp"]},scmpEpaperAndYpSparkDigitalAndEpaper:{type:"bundle",name:"SCMP ePaper + YP Spark Digital + YP Spark ePaper",standardResources:[ea.ePaper,ea.yp,ea.ypSparkDigital,ea.ypSparkEpaper],family:["scmp","yp"]},b2bScmpDigital:{type:"bundle",name:"B2B: SCMP (Digital)",standardResources:[ea.digitalB2B],family:["scmp"]},b2bScmpDigitalAndPlus:{type:"bundle",name:"B2B: SCMP (Digital + Plus)",standardResources:[ea.digitalB2B,ea.plus],family:["scmp"]},b2bScmpEpaper:{type:"bundle",name:"B2B: SCMP (ePaper)",standardResources:[ea.ePaper],family:["scmp"]},b2bScmpDigitalAndEpaper:{type:"bundle",name:"B2B: SCMP (Digital + ePaper)",standardResources:[ea.digitalB2B,ea.ePaper],family:["scmp"]},b2bScmpDigitalAndEpaperAndPlus:{type:"bundle",name:"B2B: SCMP (Digital + ePaper + Plus)",standardResources:[ea.digitalB2B,ea.ePaper,ea.plus],family:["scmp"]},b2bScmpDigitalAndPrint:{type:"bundle",name:"B2B: SCMP (Digital + Print)",standardResources:[ea.digitalB2B,ea.print],family:["scmp"]},b2bScmpDigitalAndPrintAndEPaper:{type:"bundle",name:"B2B: SCMP (Digital + Print + ePaper)",standardResources:[ea.digitalB2B,ea.print,ea.ePaper],family:["scmp"]},b2bScmpDigitalAndPrintAndEPaperAndPlus:{type:"bundle",name:"B2B: SCMP (Digital + Print + ePaper + Plus)",standardResources:[ea.digitalB2B,ea.print,ea.ePaper,ea.plus],family:["scmp"]}},ed={accessGrantedScmpDigital:{type:"bundle",name:"Access Granted: SCMP (Digital)",standardResources:[ea.digitalAccessGranted],family:["scmp"]},accessGrantedScmpEpaper:{type:"bundle",name:"Access Granted: SCMP (ePaper)",standardResources:[ea.ePaper],family:["scmp"]},accessGrantedScmpPlus:{type:"bundle",name:"Access Granted: SCMP (Plus)",standardResources:[ea.plus],family:["scmp"]}},ep=G(G(G(G(G(G(G(G({},er),ei),es),el),eo),eu),ec),ed);function em(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,`\\x2d`)}function ef(e){let t=e.startsWith("Digital")?`SCMP ${e}`:e,n=Object.entries(ep).find(e=>{var n;return e[1].name===t||(null==(n=e[1])?void 0:n.legacyName)===t});return n&&n[0]}function eg(e){let t=RegExp(["Monthly","Yearly","Annual","1-Month","1-Year","2-Year"].map(e=>em(e)).join("|"),"i");var n,r=(null==(n=e.match(t))?[]:n)[0];return r?({"1-Month":"1m","1-Year":"1y","2-Year":"2y",Monthly:"1m",Annual:"1y",Yearly:"1y"})[r]:void 0}var ey=class{static decodeTermName(e){var t,n,r;return e?G(G({},(t=e,RegExp("^\\[(iOS|Android)] ","i").test(t))?{billingCycle:eg(n=e),isCrossProduct:!1,isSwG:!1,isLatest:!1,platform:"mobile",resource:(r=n,/Plus/i.test(r)?"scmpAndScmpPlusEPaper":"digital"),resourceFamilies:["scmp"],variant:null}:function(e){var t,n,r,i,s,a;let l,o,u,c,d=eg(e),p=function(e){for(let t of e.split("|"))for(let e of z)if(t.trim().toLowerCase()===e.toLowerCase())return e;return null}(e),m=function(e){var t;let n,r=(t=(e.includes("|")?e.replace(/^(?:\d|Monthly|Annual).*?\| /,""):"").replace(/ latest/i,""),n=new RegExp(J.join("|")),t.replace(n,"")).replace(new RegExp(/FY\d\d\d\dQ\d/i),"").replace(new RegExp(/CrossProduct/i),"").replace(new RegExp(/SwG \| External|SwG/i),"").replaceAll("|","").replaceAll(" ","");if(!z.includes(r))return r.length>0?r:void 0}(e),f=(n=e,l=RegExp(J.map(e=>`${em(e)}(?=)`).join("|"),"i"),(null==(r=n.match(l))?[]:r)[0]),{resource:g,rawResourceName:y}=null==(t=function(e){var t,n;let r=/\: (.+?)(?: \||$)/.exec(e);if(!r)return;let i=null==(t=r[1])?"":t;return{resource:null==(n=ef(i))?({AlipayHK:"digital"})[i]:n,rawResourceName:i}}(e))?{}:t,h=(o=e.match(/FY[0-9]{4}Q[0-9]/))?null==(i=o[0])?"":i:"",b=(s=e,u=RegExp("FY\\d{4}Q[1-4]\\s\\|\\sLatest+$","i"),c=RegExp("New price+$","i"),u.test(s)||c.test(s));return{billingCycle:d,currency:f,isCrossProduct:e.includes("CrossProduct"),isSwG:e.includes("SwG"),isLatest:b,platform:"desktop",resource:g,rawResourceName:y,resourceFamilies:g&&g in ep?null==(a=ep[g])?void 0:a.family:void 0,variant:p,unknown:m,version:h}}(e)),{},{decoded:!0}):{decoded:!1}}};let eh=Object.entries(ep).reduce((e,[t,n])=>(e.set(n,t),e),new Map);function eb(e){try{if(!e)return null;let r=ep[e];if(!r)return null;switch(r.type){case"bundle":return Array.from(new Set(r.standardResources.reduce((e,t)=>{let r=n(t);return null!==r&&e.push(...r),e},[])));case"standard":var t;return null==(t=n(r))?[]:t}function n(e){var t;let n=eh.get(e);return n?[n,...null==(t=e.additionalImpliedAccessibleResources)?[]:t]:null}}catch(t){return console.warn(`Failed to decode term name: ${e}`,t),null}}function ev(e){return new eP(e)}var eP=class{constructor(e){j(this,"conversions",void 0),j(this,"filterFunctions",[]),j(this,"sortFunction",void 0),this.conversions=e}filter(e){return this.filterFunctions.push(e),this}filterByBillingCycles(e){return this.filter(eS.byBillingCycles(e))}filterByResources(e){return this.filter(eS.byResources(e))}filterByResourceFamilies(e,t="subset"){return this.filter(eS.byResourceFamilies(e,t))}filterByUserAccessGrantedState(e="inactive"){return this.filter(eS.byUserAccessGrantedState(e))}filterBySubscriptionAutoRenewalState(e){return this.filter(eS.bySubscriptionAutoRenewalState(e))}filterByUsedPromotionName(e,t){return this.filter(eS.byUsedPromotionName(e,t))}filterByCustom(e){return this.filter(e)}sort(e){return this.sortFunction=e,this}sortByAccessStartDate(e="desc"){return this.sort(ew.byUserAccessStartDate(e))}sortByCreateDate(e="desc"){return this.sort(ew.byCreateDate(e))}sortByCustom(e){return this.sort(e)}execute(){let e=this.conversions.reduce((e,t)=>{let n=ey.decodeTermName(t.term.name);return n.decoded&&this.filterFunctions.every(e=>e(t,n))&&e.push(t),e},[]);return e?this.sortFunction?e.sort(this.sortFunction):e:[]}};let eS={byBillingCycles:e=>(t,n)=>0===e.length||null!=n.billingCycle&&e.map(e=>e.toLowerCase()).includes(n.billingCycle),byResources:e=>(t,n)=>0===e.length||null!=n.resource&&e.includes(n.resource),byResourceFamilies:(e,t="subset")=>(n,r)=>{var i;if(0===e.length)return!0;let s=null==(i=r.resourceFamilies)?[]:i;switch(t){case"exact":let a=new Set(e),l=new Set(s);return a.size===l.size&&[...a].every(e=>l.has(e));case"subset":return e.every(e=>s.includes(e));default:return!0}},byUserAccessGrantedState:(e="inactive")=>(t,n)=>t.user_access.granted===("active"===e),bySubscriptionAutoRenewalState:(e=!0)=>(t,n)=>{var r;return!("subscription"in t)||(null==(r=t.subscription)?void 0:r.auto_renew)===e},byUsedPromotionName:(e,t)=>(n,r)=>{var i;if(!("promo_code"in n))return!1;let s=t.find(t=>t.name===e);return!!s&&(null==(i=n.promo_code)?void 0:i.promotion_id)===s.promotion_id}},ew={byUserAccessStartDate:(e="desc")=>(t,n)=>{let r=t.user_access.start_date,i=n.user_access.start_date,s="desc"===e?1:-1;return r>i?-1*s:r<i?+s:0},byCreateDate:(e="desc")=>(t,n)=>{let r=t.create_date,i=n.create_date,s="desc"===e?1:-1;return r>i?-1*s:r<i?+s:0}};function eC(e){return({digital:`${eA.scmp}-${ek.digital}`,digitalAccessGranted:`${eA.scmp}-${ek.digital}(${eT.accessGranted})`,digitalB2B:`${eA.scmp}-${ek.digital}(${eT.b2b})`,digitalFree:`${eA.scmp}-${ek.digital}(${eT.free})`,digitalLite:`${eA.scmp}-${ek.digital}(${eT.lite})`,plus:`${eA.scmp}-${ek.plus}`,ePaper:`${eA.scmp}-${ek.ePaper}`,print:`${eA.scmp}-${ek.print}`,v1DailyPrint:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.daily}+${eT.v1})`,v1FriToSunPrint:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.friToSun}+${eT.v1})`,v1MonToFriPrint:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.weekday}+${eT.v1})`,v1MonToSatPrint:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.monToSat}+${eT.v1})`,v1WeekendPrint:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.weekend}+${eT.v1})`,dailyEPaperBundle:`${eA.scmp}-${ek.ePaper}${ek.bundle}(${eT.PERIOD.daily})`,weekendPrintBundle:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.weekend})`,weekdayPrintBundle:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.weekday})`,dailyPrintBundle:`${eA.scmp}-${ek.print}${ek.bundle}(${eT.PERIOD.daily})`,scmpAndScmpPlusEPaper:`${eA.scmp}-${ek.plus}${ek.ePaper}${ek.bundle}(${eT.PERIOD.daily})`,scmpPlusDailyPrintBundle:`${eA.scmp}-${ek.plus}${ek.print}${ek.bundle}(${eT.PERIOD.daily})`,scmpPlusWeekdayPrintBundle:`${eA.scmp}-${ek.plus}${ek.print}${ek.bundle}(${eT.PERIOD.weekday})`,scmpPlusWeekendPrintBundle:`${eA.scmp}-${ek.plus}${ek.print}${ek.bundle}(${eT.PERIOD.weekend})`,yp:`${eA.yp}-${ek.digital}`,ypPrint:`${eA.yp}-${ek.print}`,ypEpaper:`${eA.yp}-${ek.ePaper}`,scmpPlusYp:`${eA.scmp}-${ek.digital}+${eA.yp}-${ek.digital}`,ypSparkDigital:`${eA.ypSpark}-${ek.digital}`,ypSparkEpaper:`${eA.ypSpark}-${ek.ePaper}`,ypSparkPrint:`${eA.ypSpark}-${ek.print}`,postiesDigital:`${eA.posties}-${ek.digital}`,postiesEPaper:`${eA.posties}-${ek.ePaper}`,postiesEPaperAndDigital:`${eA.posties}-${ek.ePaper}${ek.bundle}`,postiesPrintAndDigital:`${eA.posties}-${ek.print}${ek.bundle}`,b2bScmpDigital:`${eT.b2b}:${eA.scmp}-${ek.digital}`,b2bScmpDigitalAndPlus:`${eT.b2b}:${eA.scmp}-${ek.digital}+${ek.plus}`,b2bScmpEpaper:`${eT.b2b}:${eA.scmp}-${ek.ePaper}`,b2bScmpDigitalAndEpaper:`${eT.b2b}:${eA.scmp}-${ek.digital}+${ek.ePaper}`,b2bScmpDigitalAndEpaperAndPlus:`${eT.b2b}:${eA.scmp}-${ek.digital}+${ek.ePaper}+${ek.plus}`,b2bScmpDigitalAndPrint:`${eT.b2b}:${eA.scmp}-${ek.digital}+${ek.print}`,b2bScmpDigitalAndPrintAndEPaper:`${eT.b2b}:${eA.scmp}-${ek.digital}+${ek.print}+${ek.ePaper}`,b2bScmpDigitalAndPrintAndEPaperAndPlus:`${eT.b2b}:${eA.scmp}-${ek.digital}+${ek.print}+${ek.ePaper}+${ek.plus}`,scmpAndYpSparkDigital:`${eA.scmp}-${ek.digital}+${eA.ypSpark}-${ek.digital}+${eA.ypSpark}-${ek.digital}`,scmpEpaperAndYpSparkDigitalAndEpaper:`${eA.scmp}-${ek.ePaper}+${eA.yp}-${ek.digital}+${eA.ypSpark}-${ek.digital}+${ek.ePaper}`,scmpEpaperAndYpSparkDigitalAndPrint:`${eA.scmp}-${ek.ePaper}+${eA.yp}-${ek.digital}+${eA.ypSpark}-${ek.digital}+${ek.print}`,scmpPrintAndYpSparkDigitalAndPrint:`${eA.scmp}-${ek.print}+${eA.ypSpark}-${ek.digital}+${ek.print}`,ypOnlineScmpBundle:`${eA.scmp}-${ek.bundle}(${eT.ypOnline})`,accessGrantedScmpDigital:`${eT.accessGranted}:${eA.scmp}-${ek.digital}`,accessGrantedScmpEpaper:`${eT.accessGranted}:${eA.scmp}-${ek.ePaper}`,accessGrantedScmpPlus:`${eT.accessGranted}:${eA.scmp}-${ek.plus}`})[e]}let eA={scmp:"s",yp:"y",ypSpark:"ys",posties:"p"},ek={digital:"Dgt",ePaper:"Epr",print:"Prt",plus:"Pus",bundle:"B"},eT={accessGranted:"ag",free:"f",v1:"v1",PERIOD:{daily:"17",weekday:"15",weekend:"67",friToSun:"57",monToSat:"16"},lite:"l",ypOnline:"yo",b2b:"b"};function eE(e){return e instanceof Date&&globalThis.Number.isFinite(e.getTime())}function eR(e){return e instanceof globalThis.Uint8Array}function eI(e){return"object"==typeof e&&!!e}function eM(e){return globalThis.Array.isArray(e)&&!globalThis.ArrayBuffer.isView(e)}function eO(e){return void 0===e}G({},{BUNDLE_PAGE_OFFER:"Bundle Page Offer",INDEX_PAGE_OFFER:"Index Page Offer",PLUS_PAGE_OFFER:"Plus Page Offer",PLUS_X_DIGITIMES_PAGE_OFFER:"Plus x DIGITIMES Page Offer",PREMIUM_PAYWALL:"Premium Paywall",RENEW_OFFER:"Renew Offer",SCMP_PAYWALL_OFFER:"SCMP Paywall Offer",SWG_MONTHLY:"SwG Monthly",SWG_ANNUAL:"SwG Annual",CART_ABANDONER_OFFER:"Cart Abandoner Offer"});function eD(e){return"boolean"==typeof e}function ex(e){return"number"==typeof e}function e$(e){return"bigint"==typeof e}function eL(e){return"string"==typeof e}function e_(e){return"symbol"==typeof e}var eN=nR||(nR={});function eF(e){let t=eI(e);return eN.AllowArrayObject?t:t&&!eM(e)}eN.InstanceMode="default",eN.ExactOptionalPropertyTypes=!1,eN.AllowArrayObject=!1,eN.AllowNaN=!1,eN.AllowNullVoid=!1,eN.IsExactOptionalProperty=function(e,t){return eN.ExactOptionalPropertyTypes?t in e:void 0!==e[t]},eN.IsObjectLike=eF,eN.IsRecordLike=function(e){return eF(e)&&!(e instanceof Date)&&!(e instanceof Uint8Array)},eN.IsNumberLike=function(e){return eN.AllowNaN?ex(e):Number.isFinite(e)},eN.IsVoidLike=function(e){let t=eO(e);return eN.AllowNullVoid?t||null===e:t};let eU=new Map,eB=new Map;function ej(e){return Array.isArray(e)}function eY(e){return"bigint"==typeof e}function eG(e){return"boolean"==typeof e}function eW(e){return e instanceof globalThis.Date}function eH(e){return"number"==typeof e}function eV(e){return"object"==typeof e&&!!e}function eq(e){return e instanceof globalThis.RegExp}function eK(e){return"string"==typeof e}function ez(e){return e instanceof globalThis.Uint8Array}function eJ(e){return void 0===e}function eX(e){return ej(e)?e.map(e=>eX(e)):eW(e)?new Date(e.getTime()):ez(e)?new Uint8Array(e):eq(e)?new RegExp(e.source,e.flags):eV(e)?function(e){let t={};for(let n of Object.getOwnPropertyNames(e))t[n]=eX(e[n]);for(let n of Object.getOwnPropertySymbols(e))t[n]=eX(e[n]);return t}(e):e}function eZ(e,t){let n=void 0===t?e:G(G({},t),e);switch(nR.InstanceMode){case"freeze":return function e(t){return ej(t)?globalThis.Object.freeze(t).map(t=>e(t)):eW(t)||ez(t)||eq(t)?t:eV(t)?function(t){let n={};for(let r of Object.getOwnPropertyNames(t))n[r]=e(t[r]);for(let r of Object.getOwnPropertySymbols(t))n[r]=e(t[r]);return globalThis.Object.freeze(n)}(t):t}(n);case"clone":return eX(n);default:return n}}let eQ=Symbol.for("TypeBox.Transform"),e0=Symbol.for("TypeBox.Readonly"),e1=Symbol.for("TypeBox.Optional"),e2=Symbol.for("TypeBox.Hint"),e3=Symbol.for("TypeBox.Kind");function e4(e={}){var t;return eZ({[e3]:null==(t=e[e3])?"Unsafe":t},e)}var e8=class extends Error{constructor(e){super(e)}};function e5(e){return eZ({[e3]:"MappedResult",properties:e})}function e6(e,t){return t.reduce((e,t)=>(function(e,t){let{[t]:n}=e;return W(e,[t].map(B))})(e,t),e)}function e9(e,t){return eZ({[e3]:"Array",type:"array",items:e},t)}function e7(e,t){return eZ({[e3]:"AsyncIterator",type:"AsyncIterator",items:e},t)}function te(e,t,n){return eZ({[e3]:"Constructor",type:"Constructor",parameters:e,returns:t},n)}function tt(e,t,n){return eZ({[e3]:"Function",type:"Function",parameters:e,returns:t},n)}function tn(e,t,n){return eZ({[e3]:"Computed",target:e,parameters:t},n)}function tr(e){return eZ({[e3]:"Never",not:{}},e)}function ti(e){return eV(e)&&"Readonly"===e[e0]}function ts(e){return eV(e)&&"Optional"===e[e1]}function ta(e){return th(e,"Argument")}function tl(e){return th(e,"Array")}function to(e){return th(e,"AsyncIterator")}function tu(e){return th(e,"BigInt")}function tc(e){return th(e,"Boolean")}function td(e){return th(e,"Computed")}function tp(e){return th(e,"Constructor")}function tm(e){return th(e,"Function")}function tf(e){return th(e,"Integer")}function tg(e){return th(e,"Intersect")}function ty(e){return th(e,"Iterator")}function th(e,t){return eV(e)&&e3 in e&&e[e3]===t}function tb(e){return eG(e)||eH(e)||eK(e)}function tv(e){return th(e,"Literal")}function tP(e){return th(e,"MappedKey")}function tS(e){return th(e,"MappedResult")}function tw(e){return th(e,"Never")}function tC(e){return th(e,"Null")}function tA(e){return th(e,"Number")}function tk(e){return th(e,"Object")}function tT(e){return th(e,"Promise")}function tE(e){return th(e,"Record")}function tR(e){return th(e,"Ref")}function tI(e){return th(e,"RegExp")}function tM(e){return th(e,"String")}function tO(e){return th(e,"Symbol")}function tD(e){return th(e,"TemplateLiteral")}function tx(e){return eV(e)&&eQ in e}function t$(e){return th(e,"Tuple")}function tL(e){return th(e,"Undefined")}function t_(e){return th(e,"Union")}function tN(e){return th(e,"Any")||ta(e)||tl(e)||tc(e)||tu(e)||to(e)||td(e)||tp(e)||th(e,"Date")||tm(e)||tf(e)||tg(e)||ty(e)||tv(e)||tP(e)||tS(e)||tw(e)||th(e,"Not")||tC(e)||tA(e)||tk(e)||tT(e)||tE(e)||tR(e)||tI(e)||tM(e)||tO(e)||tD(e)||th(e,"This")||t$(e)||tL(e)||t_(e)||th(e,"Uint8Array")||th(e,"Unknown")||th(e,"Unsafe")||th(e,"Void")||eV(e)&&e3 in e&&eK(e[e3])}function tF(e,t){var n;let r=null==t||t;return tS(e)?e5(function(e,t){var n=e.properties;let r={};for(let e of globalThis.Object.getOwnPropertyNames(n))r[e]=tF(n[e],t);return r}(e,r)):(n=e,!1===r?eZ(e6(n,[e1])):eZ(G(G({},n),{},{[e1]:"Optional"})))}function tU(e,t={}){let n=e.every(e=>tk(e)),r=tN(t.unevaluatedProperties)?{unevaluatedProperties:t.unevaluatedProperties}:{};return eZ(!1===t.unevaluatedProperties||tN(t.unevaluatedProperties)||n?G(G({},r),{},{[e3]:"Intersect",type:"object",allOf:e}):G(G({},r),{},{[e3]:"Intersect",allOf:e}),t)}function tB(e){return e.map(e=>ts(e)?e6(e,[e1]):e)}function tj(e,t={}){if(1===e.length)return eZ(e[0],t);if(0===e.length)return tr(t);if(e.some(e=>tx(e)))throw Error("Cannot intersect transform types");return e.every(e=>ts(e))?tF(tU(tB(e),t)):tU(tB(e),t)}function tY(e,t){if(1===e.length)return eZ(e[0],t);if(0===e.length)return tr(t);if(e.some(e=>tx(e)))throw Error("Cannot intersect transform types");return tU(e,t)}function tG(e,t){return eZ({[e3]:"Union",anyOf:e},t)}function tW(e){return e.map(e=>ts(e)?e6(e,[e1]):e)}function tH(e,t){var n,r;return 1===e.length?eZ(e[0],t):0===e.length?tr(t):(n=e,r=t,n.some(e=>ts(e))?tF(tG(tW(n),r)):tG(tW(n),r))}function tV(e,t){return 0===e.length?tr(t):1===e.length?eZ(e[0],t):tG(e,t)}var tq=class extends e8{};function tK(e,t,n){return e[t]===n&&92!==e.charCodeAt(t-1)}function tz(e,t){return tK(e,t,"(")}function tJ(e,t){return tK(e,t,")")}function tX(e){return function e(t){return!function(e){if(!(tz(e,0)&&tJ(e,e.length-1)))return!1;let t=0;for(let n=0;n<e.length;n++)if(tz(e,n)&&(t+=1),tJ(e,n)&&--t,0===t&&n!==e.length-1)return!1;return!0}(t)?!function(e){let t=0;for(let n=0;n<e.length;n++)if(tz(e,n)&&(t+=1),tJ(e,n)&&--t,tK(e,n,"|")&&0===t)return!0;return!1}(t)?!function(e){for(let t=0;t<e.length;t++)if(tz(e,t))return!0;return!1}(t)?{type:"const",const:t.replace(/\\\$/g,"$").replace(/\\\*/g,"*").replace(/\\\^/g,"^").replace(/\\\|/g,"|").replace(/\\\(/g,"(").replace(/\\\)/g,")")}:function(t){let n=[];for(let r=0;r<t.length;r++)if(tz(t,r)){let[i,s]=function(e,t){if(!tz(e,t))throw new tq("TemplateLiteralParser: Index must point to open parens");let n=0;for(let r=t;r<e.length;r++)if(tz(e,r)&&(n+=1),tJ(e,r)&&--n,0===n)return[t,r];throw new tq("TemplateLiteralParser: Unclosed group parens in expression")}(t,r),a=t.slice(i,s+1);n.push(e(a)),r=s}else{let[i,s]=function(e,t){for(let n=t;n<e.length;n++)if(tz(e,n))return[t,n];return[t,e.length]}(t,r),a=t.slice(i,s);a.length>0&&n.push(e(a)),r=s-1}return 0===n.length?{type:"const",const:""}:1===n.length?n[0]:{type:"and",expr:n}}(t):function(t){let[n,r]=[0,0],i=[];for(let s=0;s<t.length;s++)if(tz(t,s)&&(n+=1),tJ(t,s)&&--n,tK(t,s,"|")&&0===n){let n=t.slice(r,s);n.length>0&&i.push(e(n)),r=s+1}let s=t.slice(r);return s.length>0&&i.push(e(s)),0===i.length?{type:"const",const:""}:1===i.length?i[0]:{type:"or",expr:i}}(t):e(t.slice(1,t.length-1))}(e.slice(1,e.length-1))}var tZ=class extends e8{};function tQ(e){return("or"!==e.type||2!==e.expr.length||"const"!==e.expr[0].type||"0"!==e.expr[0].const||"const"!==e.expr[1].type||"[1-9][0-9]*"!==e.expr[1].const)&&("const"!==e.type||".*"!==e.const)&&("or"===e.type&&2===e.expr.length&&"const"===e.expr[0].type&&"true"===e.expr[0].const&&"const"===e.expr[1].type&&"false"===e.expr[1].const||("and"===e.type||"or"===e.type?e.expr.every(e=>tQ(e)):"const"===e.type||(()=>{throw new tZ("Unknown expression type")})()))}var t0=class extends e8{};function*t1(e){return"and"===e.type?yield*function*(e){return yield*function* e(t){if(1===t.length)return yield*t[0];for(let n of t[0])for(let r of e(t.slice(1)))yield`${n}${r}`}(e.expr.map(e=>[...t1(e)]))}(e):"or"===e.type?yield*function*(e){for(let t of e.expr)yield*t1(t)}(e):"const"===e.type?yield*function*(e){return yield e.const}(e):(()=>{throw new t0("Unknown expression")})()}function t2(e){let t=tX(e.pattern);return tQ(t)?[...t1(t)]:[]}function t3(e,t){return eZ({[e3]:"Literal",const:e,type:typeof e},t)}function t4(e){return eZ({[e3]:"Boolean",type:"boolean"},e)}function t8(e){return eZ({[e3]:"BigInt",type:"bigint"},e)}function t5(e){return eZ({[e3]:"Number",type:"number"},e)}function t6(e){return eZ({[e3]:"String",type:"string"},e)}let t9="(0|[1-9][0-9]*)",t7="(.*)",ne=`^${t9}$`,nt=`^${t7}$`;var nn=class extends e8{};function nr(e){return`^${e.map(e=>(function e(t,n){return tD(t)?t.pattern.slice(1,t.pattern.length-1):t_(t)?`(${t.anyOf.map(t=>e(t,n)).join("|")})`:tA(t)||tf(t)||tu(t)?`${n}${t9}`:tM(t)?`${n}${t7}`:tv(t)?`${n}${t.const.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`:tc(t)?`${n}(true|false)`:(()=>{throw new nn(`Unexpected Kind '${t[e3]}'`)})()})(e,"")).join("")}$`}function ni(e){return tH(t2(e).map(e=>t3(e)))}function ns(e,t){return eZ({[e3]:"TemplateLiteral",type:"string",pattern:eK(e)?nr([...function* e(t){for(let n=0;n<t.length;n++)if("$"===t[n])return yield*[t3(t.slice(0,n)),...function*(t){if("{"!==t[1])return yield*[t3("$"),...e(t.slice(1))];for(let n=2;n<t.length;n++)if("}"===t[n]){let r=function*(e){let t,n=e.trim().replace(/"|'/g,"");return"boolean"===n?yield t4():"number"===n?yield t5():"bigint"===n?yield t8():"string"===n?yield t6():yield 0===(t=n.split("|").map(e=>t3(e.trim()))).length?tr():1===t.length?t[0]:tH(t)}(t.slice(2,n)),i=e(t.slice(n+1));return yield*[...r,...i]}yield t3(t)}(t.slice(n))];yield t3(t)}(e)]):nr(e)},t)}function na(e){return[...new Set(tD(e)?t2(e).map(e=>e.toString()):t_(e)?function(e){let t=[];for(let n of e)t.push(...na(n));return t}(e.anyOf):tv(e)?[e.const.toString()]:tA(e)||tf(e)?["[number]"]:[])]}function nl(e,t){return e.map(e=>no(e,t))}function no(e,t){var n,r,i,s,a,l;return tg(e)?(l=e.allOf,tj(nl(l,t).filter(e=>!tw(e)))):t_(e)?tH((r=nl(e.anyOf,t)).some(e=>tw(e))?[]:r):t$(e)?t in(i=null==(n=e.items)?[]:n)?i[t]:"[number]"===t?tH(i):tr():tl(e)?(s=e.items,"[number]"===t?s:tr()):tk(e)&&t in(a=e.properties)?a[t]:tr()}function nu(e,t){return t.map(t=>no(e,t))}function nc(e,t,n){if(tR(e)||tR(t)){if(!tN(e)||!tN(t))throw new e8("Index types using Ref parameters require both Type and Key to be of TSchema");return tn("Index",[e,t])}return tS(t)?e5(function(e,t,n){var r=t.properties;let i={};for(let t of Object.getOwnPropertyNames(r))i[t]=nc(e,na(r[t]),n);return i}(e,t,n)):tP(t)?function(e,t,n){var r;return e5((r=t.keys,r.reduce((t,r)=>{var i,s;return G(G({},t),(i=e,{[s=r]:nc(i,[s],eX(n))}))},{})))}(e,t,n):eZ(tN(t)?tH(nu(e,na(t))):tH(nu(e,t)),n)}function nd(e,t){return eZ({[e3]:"Iterator",type:"Iterator",items:e},t)}var np=function(e,t){let n=function(e){let t=[];for(let n in e)ts(e[n])||t.push(n);return t}(e);return eZ(n.length>0?{[e3]:"Object",type:"object",properties:e,required:n}:{[e3]:"Object",type:"object",properties:e},t)};function nm(e,t){return eZ({[e3]:"Promise",type:"Promise",item:e},t)}function nf(e,t){var n;let r=null==t||t;return tS(e)?e5(function(e,t){var n=e.properties;let r={};for(let e of globalThis.Object.getOwnPropertyNames(n))r[e]=nf(n[e],t);return r}(e,r)):(n=e,!1===r?eZ(e6(n,[e0])):eZ(G(G({},n),{},{[e0]:"Readonly"})))}function ng(e,t){return eZ(e.length>0?{[e3]:"Tuple",type:"array",items:e,additionalItems:!1,minItems:e.length,maxItems:e.length}:{[e3]:"Tuple",type:"array",minItems:e.length,maxItems:e.length},t)}function ny(e,t){return e in t?nb(e,t[e]):e5(t)}function nh(e,t){return t.map(t=>nb(e,t))}function nb(e,t){var n,r;let i=G({},t);return ts(t)?tF(nb(e,e6(t,[e1]))):ti(t)?nf(nb(e,e6(t,[e0]))):tS(t)?ny(e,t.properties):tP(t)?ny(e,(r=t.keys,r.includes(e))?{[e]:t3(e)}:function(e){let t={};for(let n of e)t[n]=t3(n);return t}(r)):tp(t)?te(nh(e,t.parameters),nb(e,t.returns),i):tm(t)?tt(nh(e,t.parameters),nb(e,t.returns),i):to(t)?e7(nb(e,t.items),i):ty(t)?nd(nb(e,t.items),i):tg(t)?tY(nh(e,t.allOf),i):t_(t)?tV(nh(e,t.anyOf),i):t$(t)?ng(nh(e,null==(n=t.items)?[]:n),i):tk(t)?np(function(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(t))n[r]=nb(e,t[r]);return n}(e,t.properties),i):tl(t)?e9(nb(e,t.items),i):tT(t)?nm(nb(e,t.item),i):t}function nv(e,t,n){let r=tN(e)?na(e):e;return np(function(e,t){let n={};for(let r of e)n[r]=nb(r,t);return n}(r,t({[e3]:"MappedKey",keys:r})),n)}function nP(...e){let[t,n]="string"==typeof e[0]?[e[0],e[1]]:[e[0].$id,e[1]];if("string"!=typeof t)throw new e8("Ref: $ref must be a string");return eZ({[e3]:"Ref",$ref:t},n)}function nS(e){let t=[];for(let n of e)t.push(nw(n));return t}function nw(e){var t,n,r,i,s,a;return tg(e)?function(e){var t=nS(e);let n=[];for(let e of t)n.push(...e);return n}(e.allOf):t_(e)?1===(n=nS(e.anyOf)).length?n[0]:n.length>1?(r=n.slice(1),i=n[0],r.reduce((e,t)=>e.filter(e=>t.includes(e)),i)):[]:t$(e)?(null==(t=e.items)?[]:t).map((e,t)=>t.toString()):tl(e)?(e.items,["[number]"]):tk(e)?(s=e.properties,globalThis.Object.getOwnPropertyNames(s)):tE(e)?(a=e.patternProperties,nC?globalThis.Object.getOwnPropertyNames(a).map(e=>"^"===e[0]&&"$"===e[e.length-1]?e.slice(1,e.length-1):e):[]):[]}let nC=!1;function nA(e){nC=!0;let t=nw(e);return nC=!1,`^(${t.map(e=>`(${e})`).join("|")})$`}function nk(e,t){return td(e)?tn("KeyOf",[tn(e.target,e.parameters)]):tR(e)?tn("KeyOf",[nP(e.$ref)]):tS(e)?e5(function(e,t){var n=e.properties;let r={};for(let e of globalThis.Object.getOwnPropertyNames(n))r[e]=nk(n[e],eX(t));return r}(e,t)):eZ(tH(nw(e).map(e=>"[number]"===e?t5():t3(e))),t)}var nT=class extends e8{constructor(e){super(`Unable to dereference schema with $id '${e.$ref}'`),this.schema=e}};function nE(e,t){return"This"===e[e3]||"Ref"===e[e3]?function(e,t){let n=t.find(t=>t.$id===e.$ref);if(void 0===n)throw new nT(e);return nE(n,t)}(e,t):e}var nR,nI,nM=class extends e8{constructor(e){super("Unable to hash value"),this.value=e}};(rP=nI||(nI={}))[rP.Undefined=0]="Undefined",rP[rP.Null=1]="Null",rP[rP.Boolean=2]="Boolean",rP[rP.Number=3]="Number",rP[rP.String=4]="String",rP[rP.Object=5]="Object",rP[rP.Array=6]="Array",rP[rP.Date=7]="Date",rP[rP.Uint8Array=8]="Uint8Array",rP[rP.Symbol=9]="Symbol",rP[rP.BigInt=10]="BigInt";let nO=BigInt("14695981039346656037"),[nD,nx]=[BigInt("1099511628211"),BigInt("18446744073709551616")],n$=Array.from({length:256}).map((e,t)=>BigInt(t)),nL=new Float64Array(1),n_=new DataView(nL.buffer),nN=new Uint8Array(nL.buffer);function nF(e){nO^=n$[e],nO=nO*nD%nx}function nU(e){return eZ({[e3]:"Any"},e)}function nB(e){return eZ({[e3]:"Unknown"},e)}let nj="Argument.Any.Array.AsyncIterator.BigInt.Boolean.Computed.Constructor.Date.Enum.Function.Integer.Intersect.Iterator.Literal.MappedKey.MappedResult.Not.Null.Number.Object.Promise.Record.Ref.RegExp.String.Symbol.TemplateLiteral.This.Tuple.Undefined.Union.Uint8Array.Unknown.Void".split(".");function nY(e){try{return new RegExp(e),!0}catch(e){return!1}}function nG(e){if(!eK(e))return!1;for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);if(n>=7&&n<=13||27===n||127===n)return!1}return!0}function nW(e){return eJ(e)||eY(e)}function nH(e){return eJ(e)||eH(e)}function nV(e){return eJ(e)||eG(e)}function nq(e){return eJ(e)||eK(e)}function nK(e){return eV(e)&&"Optional"===e[e1]}function nz(e){return n6(e,"Any")&&nq(e.$id)}function nJ(e){var t;return n6(e,"Array")&&"array"===e.type&&nq(e.$id)&&rv(e.items)&&nH(e.minItems)&&nH(e.maxItems)&&nV(e.uniqueItems)&&(eJ(t=e.contains)||rv(t))&&nH(e.minContains)&&nH(e.maxContains)}function nX(e){return n6(e,"AsyncIterator")&&"AsyncIterator"===e.type&&nq(e.$id)&&rv(e.items)}function nZ(e){return n6(e,"BigInt")&&"bigint"===e.type&&nq(e.$id)&&nW(e.exclusiveMaximum)&&nW(e.exclusiveMinimum)&&nW(e.maximum)&&nW(e.minimum)&&nW(e.multipleOf)}function nQ(e){return n6(e,"Boolean")&&"boolean"===e.type&&nq(e.$id)}function n0(e){return n6(e,"Constructor")&&"Constructor"===e.type&&nq(e.$id)&&ej(e.parameters)&&e.parameters.every(e=>rv(e))&&rv(e.returns)}function n1(e){return n6(e,"Date")&&"Date"===e.type&&nq(e.$id)&&nH(e.exclusiveMaximumTimestamp)&&nH(e.exclusiveMinimumTimestamp)&&nH(e.maximumTimestamp)&&nH(e.minimumTimestamp)&&nH(e.multipleOfTimestamp)}function n2(e){return n6(e,"Function")&&"Function"===e.type&&nq(e.$id)&&ej(e.parameters)&&e.parameters.every(e=>rv(e))&&rv(e.returns)}function n3(e){return n6(e,"Integer")&&"integer"===e.type&&nq(e.$id)&&nH(e.exclusiveMaximum)&&nH(e.exclusiveMinimum)&&nH(e.maximum)&&nH(e.minimum)&&nH(e.multipleOf)}function n4(e){return eV(e)&&Object.entries(e).every(([e,t])=>nG(e)&&rv(t))}function n8(e){var t;return n6(e,"Intersect")&&!(eK(e.type)&&"object"!==e.type)&&ej(e.allOf)&&e.allOf.every(e=>{var t;return rv(e)&&!(eV(t=e)&&eQ in t)})&&nq(e.type)&&(nV(e.unevaluatedProperties)||eJ(t=e.unevaluatedProperties)||rv(t))&&nq(e.$id)}function n5(e){return n6(e,"Iterator")&&"Iterator"===e.type&&nq(e.$id)&&rv(e.items)}function n6(e,t){return eV(e)&&e3 in e&&e[e3]===t}function n9(e){return rt(e)&&eK(e.const)}function n7(e){return rt(e)&&eH(e.const)}function re(e){return rt(e)&&eG(e.const)}function rt(e){var t;return n6(e,"Literal")&&nq(e.$id)&&(eG(t=e.const)||eH(t)||eK(t))}function rn(e){return n6(e,"Never")&&eV(e.not)&&0===Object.getOwnPropertyNames(e.not).length}function rr(e){return n6(e,"Not")&&rv(e.not)}function ri(e){return n6(e,"Null")&&"null"===e.type&&nq(e.$id)}function rs(e){return n6(e,"Number")&&"number"===e.type&&nq(e.$id)&&nH(e.exclusiveMaximum)&&nH(e.exclusiveMinimum)&&nH(e.maximum)&&nH(e.minimum)&&nH(e.multipleOf)}function ra(e){var t;return n6(e,"Object")&&"object"===e.type&&nq(e.$id)&&n4(e.properties)&&(nV(t=e.additionalProperties)||rv(t))&&nH(e.minProperties)&&nH(e.maxProperties)}function rl(e){return n6(e,"Promise")&&"Promise"===e.type&&nq(e.$id)&&rv(e.item)}function ro(e){var t,n;let r;return n6(e,"Record")&&"object"===e.type&&nq(e.$id)&&(nV(t=e.additionalProperties)||rv(t))&&eV(e.patternProperties)&&1===(r=Object.getOwnPropertyNames((n=e).patternProperties)).length&&nY(r[0])&&eV(n.patternProperties)&&rv(n.patternProperties[r[0]])}function ru(e){return n6(e,"RegExp")&&nq(e.$id)&&eK(e.source)&&eK(e.flags)&&nH(e.maxLength)&&nH(e.minLength)}function rc(e){var t,n;return n6(e,"String")&&"string"===e.type&&nq(e.$id)&&nH(e.minLength)&&nH(e.maxLength)&&(eJ(t=e.pattern)||eK(t)&&nG(t)&&nY(t))&&(eJ(n=e.format)||eK(n)&&nG(n))}function rd(e){return n6(e,"Symbol")&&"symbol"===e.type&&nq(e.$id)}function rp(e){return n6(e,"TemplateLiteral")&&"string"===e.type&&eK(e.pattern)&&"^"===e.pattern[0]&&"$"===e.pattern[e.pattern.length-1]}function rm(e){return n6(e,"Tuple")&&"array"===e.type&&nq(e.$id)&&eH(e.minItems)&&eH(e.maxItems)&&e.minItems===e.maxItems&&(eJ(e.items)&&eJ(e.additionalItems)&&0===e.minItems||ej(e.items)&&e.items.every(e=>rv(e)))}function rf(e){return n6(e,"Undefined")&&"undefined"===e.type&&nq(e.$id)}function rg(e){return n6(e,"Union")&&nq(e.$id)&&eV(e)&&ej(e.anyOf)&&e.anyOf.every(e=>rv(e))}function ry(e){return n6(e,"Uint8Array")&&"Uint8Array"===e.type&&nq(e.$id)&&nH(e.minByteLength)&&nH(e.maxByteLength)}function rh(e){return n6(e,"Unknown")&&nq(e.$id)}function rb(e){return n6(e,"Void")&&"void"===e.type&&nq(e.$id)}function rv(e){return eV(e)&&(nz(e)||n6(e,"Argument")&&eH(e.index)||nJ(e)||nQ(e)||nZ(e)||nX(e)||n6(e,"Computed")&&eK(e.target)&&ej(e.parameters)&&e.parameters.every(e=>rv(e))||n0(e)||n1(e)||n2(e)||n3(e)||n8(e)||n5(e)||rt(e)||n6(e,"MappedKey")&&ej(e.keys)&&e.keys.every(e=>eH(e)||eK(e))||n6(e,"MappedResult")&&n4(e.properties)||rn(e)||rr(e)||ri(e)||rs(e)||ra(e)||rl(e)||ro(e)||n6(e,"Ref")&&nq(e.$id)&&eK(e.$ref)||ru(e)||rc(e)||rd(e)||rp(e)||n6(e,"This")&&nq(e.$id)&&eK(e.$ref)||rm(e)||rf(e)||rg(e)||ry(e)||rh(e)||n6(e,"Unsafe")||rb(e)||eV(e)&&e3 in e&&eK(e[e3])&&!nj.includes(e[e3]))}var rP,rS,rw=class extends e8{};function rC(e){return e===rS.False?e:rS.True}function rA(e){throw new rw(e)}function rk(e){return rn(e)||n8(e)||rg(e)||rh(e)||nz(e)}function rT(e,t){return rn(t)?rS.False:n8(t)?rI(e,t):rg(t)?rj(e,t):rh(t)?rS.True:nz(t)?rS.True:rA("StructuralRight")}function rE(e,t){return re(e)||nQ(e)?rS.True:rS.False}function rR(e,t){return rt(e)&&eH(e.const)||rs(e)||n3(e)?rS.True:rS.False}function rI(e,t){return t.allOf.every(t=>rY(e,t)===rS.True)?rS.True:rS.False}(s=rS||(rS={}))[s.Union=0]="Union",s[s.True=1]="True",s[s.False=2]="False";function rM(e){let[t,n]=[e,0];for(;rr(t);)t=t.not,n+=1;return n%2==0?t:nB()}function rO(e,t){return n7(e)||rs(e)||n3(e)?rS.True:rS.False}function rD(e,t){return Object.getOwnPropertyNames(e.properties).length===t}function rx(e){return rD(e,0)||rD(e,1)&&"description"in e.properties&&rg(e.properties.description)&&2===e.properties.description.anyOf.length&&(rc(e.properties.description.anyOf[0])&&rf(e.properties.description.anyOf[1])||rc(e.properties.description.anyOf[1])&&rf(e.properties.description.anyOf[0]))}function r$(e){let t=t5();return rD(e,0)||rD(e,1)&&"length"in e.properties&&rC(rY(e.properties.length,t))===rS.True}function rL(e,t){return rY(e,t)===rS.False||nK(e)&&!nK(t)?rS.False:rS.True}function r_(e,t){let n;return rh(e)?rS.False:nz(e)?rS.Union:rn(e)||n9(e)&&r$(t)||n7(e)&&rD(t,0)||re(e)&&rD(t,0)||rd(e)&&rx(t)||nZ(e)&&rD(t,0)||rc(e)&&r$(t)||rd(e)&&rx(t)||rs(e)&&rD(t,0)||n3(e)&&rD(t,0)||nQ(e)&&rD(t,0)||ry(e)&&r$(t)||n1(e)&&rD(t,0)||n0(e)&&rD(t,0)||n2(e)&&(n=t5(),rD(t,0)||rD(t,1)&&"length"in t.properties&&rC(rY(t.properties.length,n))===rS.True)?rS.True:ro(e)&&rc(rN(e))?"Record"===t[e2]?rS.True:rS.False:ro(e)&&rs(rN(e))&&rD(t,0)?rS.True:rS.False}function rN(e){return ne in e.patternProperties?t5():nt in e.patternProperties?t6():rA("Unknown record key pattern")}function rF(e){return ne in e.patternProperties?e.patternProperties[ne]:nt in e.patternProperties?e.patternProperties[nt]:rA("Unable to get record value schema")}function rU(e,t){let[n,r]=[rN(t),rF(t)];return n9(e)&&rs(n)&&rC(rY(e,r))===rS.True?rS.True:ry(e)&&rs(n)||rc(e)&&rs(n)||nJ(e)&&rs(n)?rY(e,r):ra(e)?(()=>{for(let t of Object.getOwnPropertyNames(e.properties))if(rL(r,e.properties[t])===rS.False)return rS.False;return rS.True})():rS.False}function rB(e,t){return rt(e)&&eK(e.const)||rc(e)?rS.True:rS.False}function rj(e,t){return t.anyOf.some(t=>rY(e,t)===rS.True)?rS.True:rS.False}function rY(e,t){var n;let r;return rp(e)||rp(t)?rp(e)?rY(ni(e),t):rp(t)?rY(e,ni(t)):rA("Invalid fallthrough for TemplateLiteral"):ru(e)||ru(t)?rY(ru(e)?t6():e,ru(t)?t6():t):rr(e)||rr(t)?rr(e)?rY(rM(e),t):rr(t)?rY(e,rM(t)):rA("Invalid fallthrough for Not"):nz(e)?n8(t)?rI(e,t):rg(t)&&t.anyOf.some(e=>nz(e)||rh(e))?rS.True:rg(t)?rS.Union:rh(t)||nz(t)?rS.True:rS.Union:nJ(e)?ra(t)&&r$(t)?rS.True:rk(t)?rT(e,t):nJ(t)?rC(rY(e.items,t.items)):rS.False:nZ(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):nZ(t)?rS.True:rS.False:nQ(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):nQ(t)?rS.True:rS.False:nX(e)?rk(t)?rT(e,t):nX(t)?rC(rY(e.items,t.items)):rS.False:n0(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):n0(t)?e.parameters.length>t.parameters.length?rS.False:e.parameters.every((e,n)=>rC(rY(t.parameters[n],e))===rS.True)?rC(rY(e.returns,t.returns)):rS.False:rS.False:n1(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):n1(t)?rS.True:rS.False:n2(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):n2(t)?e.parameters.length>t.parameters.length?rS.False:e.parameters.every((e,n)=>rC(rY(t.parameters[n],e))===rS.True)?rC(rY(e.returns,t.returns)):rS.False:rS.False:n3(e)?n3(t)||rs(t)?rS.True:rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):rS.False:n8(e)?e.allOf.some(e=>rY(e,t)===rS.True)?rS.True:rS.False:n5(e)?rk(t)?rT(e,t):n5(t)?rC(rY(e.items,t.items)):rS.False:rt(e)?rt(t)&&t.const===e.const?rS.True:rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):rc(t)?rB(e,t):rs(t)?rO(e,t):n3(t)?rR(e,t):nQ(t)?rE(e,t):rS.False:rn(e)?rS.True:ri(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):ri(t)?rS.True:rS.False:rs(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):n3(t)||rs(t)?rS.True:rS.False:ra(e)?rk(t)?rT(e,t):ro(t)?rU(e,t):ra(t)?(()=>{for(let n of Object.getOwnPropertyNames(t.properties)){if(!(n in e.properties)&&!nK(t.properties[n]))return rS.False;if(nK(t.properties[n]))break;if(rL(e.properties[n],t.properties[n])===rS.False)return rS.False}return rS.True})():rS.False:ro(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rY(rF(e),rF(t)):rS.False:rc(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):rc(t)?rS.True:rS.False:rd(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):rd(t)?rS.True:rS.False:rm(e)?rk(t)?rT(e,t):ra(t)&&r$(t)||nJ(t)&&nJ(t)&&void 0!==e.items&&e.items.every(e=>rY(e,t.items)===rS.True)?rS.True:rm(t)?eJ(e.items)&&!eJ(t.items)||!eJ(e.items)&&eJ(t.items)?rS.False:eJ(e.items)&&!eJ(t.items)||e.items.every((e,n)=>rY(e,t.items[n])===rS.True)?rS.True:rS.False:rS.False:rl(e)?rk(t)?rT(e,t):ra(t)&&(r=tt([nU()],nU()),rD(t,0)||rD(t,1)&&"then"in t.properties&&rC(rY(t.properties.then,r))===rS.True)?rS.True:rl(t)?rC(rY(e.item,t.item)):rS.False:ry(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):ry(t)?rS.True:rS.False:rf(e)?rk(t)?rT(e,t):ra(t)?r_(e,t):ro(t)?rU(e,t):rb(t)?rf(n=e)||rf(n)?rS.True:rS.False:rf(t)?rS.True:rS.False:rg(e)?e.anyOf.every(e=>rY(e,t)===rS.True)?rS.True:rS.False:rh(e)?rn(t)?rS.False:n8(t)?rI(e,t):rg(t)?rj(e,t):nz(t)?rS.True:rc(t)?rB(e,t):rs(t)?rO(e,t):n3(t)?rR(e,t):nQ(t)?rE(e,t):nJ(t)?rh(e)?rS.False:nz(e)?rS.Union:rn(e)?rS.True:rS.False:rm(t)?rn(e)?rS.True:rh(e)?rS.False:nz(e)?rS.Union:rS.False:ra(t)?r_(e,t):rh(t)?rS.True:rS.False:rb(e)?n8(t)?rI(e,t):rg(t)?rj(e,t):rh(t)||nz(t)?rS.True:ra(t)?r_(e,t):rb(t)?rS.True:rS.False:rA(`Unknown left type operand '${e[e3]}'`)}var rG=class extends e8{constructor(e){super("Unknown type"),this.schema=e}};function rW(e){return void 0!==e}function rH(e,t,n){var r,i,s,a,l,o;let u=(rW(e.$id)&&(!eL(e.$id)||t.some(t=>t.$id===e.$id)||t.push(e)),t);switch(e[e3]){case"Any":case"Argument":case"Unknown":return!0;case"Array":if(!eM(n)||rW(e.minItems)&&!(n.length>=e.minItems)||rW(e.maxItems)&&!(n.length<=e.maxItems)||!n.every(t=>rH(e.items,u,t))||!0===e.uniqueItems&&!function(){let e=new Set;for(let t of n){let n=(nO=BigInt("14695981039346656037"),function e(t){if(eM(t)){for(let n of(nF(nI.Array),t))e(n);return}if(eD(t))return void(nF(nI.Boolean),nF(+!!t));if(e$(t)){for(let e of(nF(nI.BigInt),n_.setBigInt64(0,t),nN))nF(e);return}if(eE(t))return void(nF(nI.Date),e(t.getTime()));if(null===t)return void nF(nI.Null);if(ex(t)){for(let e of(nF(nI.Number),n_.setFloat64(0,t),nN))nF(e);return}if(eI(t)){for(let n of(nF(nI.Object),globalThis.Object.getOwnPropertyNames(t).sort()))e(n),e(t[n]);return}if(eL(t)){nF(nI.String);for(let e=0;e<t.length;e++)for(let n of function*(e){let t=0===e?1:Math.ceil(Math.floor(Math.log2(e)+1)/8);for(let n=0;n<t;n++)yield e>>8*(t-1-n)&255}(t.charCodeAt(e)))nF(n);return}if(e_(t))return void(nF(nI.Symbol),e(t.description));if(eR(t)){nF(nI.Uint8Array);for(let e=0;e<t.length;e++)nF(t[e]);return}if(eO(t))return nF(nI.Undefined);throw new nM(t)}(t),nO);if(e.has(n))return!1;e.add(n)}return!0}())return!1;if(!(rW(e.contains)||ex(e.minContains)||ex(e.maxContains)))return!0;let c=rW(e.contains)?e.contains:tr(),d=n.reduce((e,t)=>rH(c,u,t)?e+1:e,0);return!(0===d||ex(e.minContains)&&d<e.minContains||ex(e.maxContains)&&d>e.maxContains);case"AsyncIterator":return eI(n)&&globalThis.Symbol.asyncIterator in n;case"BigInt":return!(!e$(n)||rW(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||rW(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||rW(e.maximum)&&!(n<=e.maximum)||rW(e.minimum)&&!(n>=e.minimum)||rW(e.multipleOf)&&n%e.multipleOf!==BigInt(0));case"Boolean":return eD(n);case"Constructor":return rH(e.returns,u,n.prototype);case"Date":return!(!eE(n)||rW(e.exclusiveMaximumTimestamp)&&!(n.getTime()<e.exclusiveMaximumTimestamp)||rW(e.exclusiveMinimumTimestamp)&&!(n.getTime()>e.exclusiveMinimumTimestamp)||rW(e.maximumTimestamp)&&!(n.getTime()<=e.maximumTimestamp)||rW(e.minimumTimestamp)&&!(n.getTime()>=e.minimumTimestamp)||rW(e.multipleOfTimestamp)&&n.getTime()%e.multipleOfTimestamp!=0);case"Function":return"function"==typeof n;case"Import":let p;return p=globalThis.Object.values(e.$defs),rH(e.$defs[e.$ref],[...u,...p],n);case"Integer":return!(!globalThis.Number.isInteger(n)||rW(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||rW(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||rW(e.maximum)&&!(n<=e.maximum)||rW(e.minimum)&&!(n>=e.minimum)||rW(e.multipleOf)&&n%e.multipleOf!=0);case"Intersect":return function(e,t,n){let r=e.allOf.every(e=>rH(e,t,n));if(!1===e.unevaluatedProperties){let t=new RegExp(nA(e)),i=Object.getOwnPropertyNames(n).every(e=>t.test(e));return r&&i}if(!tN(e.unevaluatedProperties))return r;{let i=new RegExp(nA(e)),s=Object.getOwnPropertyNames(n).every(r=>i.test(r)||rH(e.unevaluatedProperties,t,n[r]));return r&&s}}(e,u,n);case"Iterator":return eI(n)&&globalThis.Symbol.iterator in n;case"Literal":return n===e.const;case"Never":return!1;case"Not":return!rH(e.not,u,n);case"Null":return null===n;case"Number":return!(!nR.IsNumberLike(n)||rW(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||rW(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||rW(e.minimum)&&!(n>=e.minimum)||rW(e.maximum)&&!(n<=e.maximum)||rW(e.multipleOf)&&n%e.multipleOf!=0);case"Object":if(!nR.IsObjectLike(n)||rW(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||rW(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;let m=Object.getOwnPropertyNames(e.properties);for(let t of m){let r=e.properties[t];if(e.required&&e.required.includes(t)){if(!rH(r,u,n[t])||(function e(t){return"Intersect"===t[e3]?t.allOf.every(t=>e(t)):"Union"===t[e3]?t.anyOf.some(t=>e(t)):"Not"===t[e3]?!e(t.not):"Undefined"===t[e3]}(r)||"Any"===(o=r)[e3]||"Unknown"===o[e3])&&!(t in n))return!1}else if(nR.IsExactOptionalProperty(n,t)&&!rH(r,u,n[t]))return!1}if(!1===e.additionalProperties){let t=Object.getOwnPropertyNames(n);return!!e.required&&e.required.length===m.length&&t.length===m.length||t.every(e=>m.includes(e))}if("object"==typeof e.additionalProperties)return Object.getOwnPropertyNames(n).every(t=>m.includes(t)||rH(e.additionalProperties,u,n[t]));return!0;case"Promise":return n instanceof globalThis.Promise;case"Record":return function(e,t,n){if(!nR.IsRecordLike(n)||rW(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||rW(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;let[r,i]=Object.entries(e.patternProperties)[0],s=new RegExp(r),a=Object.entries(n).every(([e,n])=>!s.test(e)||rH(i,t,n)),l="object"!=typeof e.additionalProperties||Object.entries(n).every(([n,r])=>!!s.test(n)||rH(e.additionalProperties,t,r)),o=!1!==e.additionalProperties||Object.getOwnPropertyNames(n).every(e=>s.test(e));return a&&l&&o}(e,u,n);case"Ref":case"This":return rH(nE(e,u),u,n);case"RegExp":let f;return f=new RegExp(e.source,e.flags),!(rW(e.minLength)&&!(n.length>=e.minLength)||rW(e.maxLength)&&!(n.length<=e.maxLength))&&f.test(n);case"String":return!(!eL(n)||rW(e.minLength)&&!(n.length>=e.minLength)||rW(e.maxLength)&&!(n.length<=e.maxLength)||rW(e.pattern)&&!new RegExp(e.pattern).test(n))&&(!rW(e.format)||(r=e.format,!!eU.has(r)&&(i=e.format,eU.get(i))(n)));case"Symbol":return e_(n);case"TemplateLiteral":return eL(n)&&new RegExp(e.pattern).test(n);case"Tuple":if(!eM(n)||void 0===e.items&&0!==n.length||n.length!==e.maxItems)return!1;if(!e.items)return!0;for(let t=0;t<e.items.length;t++)if(!rH(e.items[t],u,n[t]))return!1;return!0;case"Undefined":return eO(n);case"Union":return e.anyOf.some(e=>rH(e,u,n));case"Uint8Array":return!(!eR(n)||rW(e.maxByteLength)&&!(n.length<=e.maxByteLength)||rW(e.minByteLength)&&!(n.length>=e.minByteLength));case"Void":return nR.IsVoidLike(n);default:if(s=e[e3],!eB.has(s))throw new rG(e);return a=e[e3],!!eB.has(a)&&(l=e[e3],eB.get(l))(e,n)}}function rV(e,t){return eX(void 0===t?e:G(G({},t),e))}function rq(e){return eZ({[e3]:"Argument",index:e})}function rK(e){return e.map(e=>rz(e))}function rz(e,t){return eZ(td(e)?tn("Awaited",[tn(e.target,e.parameters)]):tg(e)?tY(rK(e.allOf)):t_(e)?tV(rK(e.anyOf)):tT(e)?rz(e.item):tR(e)?tn("Awaited",[nP(e.$ref)]):e,t)}function rJ(e,t){return np(function(e,t){let n={};for(let r of t)n[r]=tj(function(e,t){let n=[];for(let r of e)n.push(...nu(r,[t]));return n.filter(e=>!tw(e))}(e,r));return n}(e,function(e){let t=[];for(let n of e)t.push(...nw(n));return[...new Set(t)]}(e)),t)}function rX(e){return eZ({[e3]:"Date",type:"Date"},e)}function rZ(e){return eZ({[e3]:"Null",type:"null"},e)}function rQ(e){return eZ({[e3]:"Symbol",type:"symbol"},e)}function r0(e){return eZ({[e3]:"Undefined",type:"undefined"},e)}function r1(e){return eZ({[e3]:"Uint8Array",type:"Uint8Array"},e)}function r2(e,t){return!0===t?e:nf(e)}function r3(e,t){return eZ(function e(t,n){return eV(t)&&!ej(t)&&!ez(t)&&Symbol.asyncIterator in t||eV(t)&&!ej(t)&&!ez(t)&&Symbol.iterator in t?r2(nU(),n):ej(t)?nf(ng(t.map(t=>e(t,!1)))):ez(t)?r1():eW(t)?rX():eV(t)?r2(np(function(t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(t))n[r]=nf(e(t[r],!1));return n}(t)),n):"function"==typeof t?r2(tt([],nB()),n):eJ(t)?r0():null===t?rZ():"symbol"==typeof t?rQ():eY(t)?t8():eH(t)||eG(t)||eK(t)?t3(t):np({})}(e,!0),t)}function r4(e,t){return tp(e)?ng(e.parameters,t):tr(t)}function r8(e,t){if(eJ(e))throw Error("Enum undefined or empty");return tV([...new Set(globalThis.Object.getOwnPropertyNames(e).filter(e=>isNaN(e)).map(t=>e[t]))].map(e=>t3(e)),G(G({},t),{},{[e2]:"Enum"}))}function r5(e,t){return tp(e)?eZ(e.returns,t):tr(t)}function r6(e){return nf(tF(e))}function r9(e,t,n){return eZ({[e3]:"Record",type:"object",patternProperties:{[e]:t}},n)}function r7(e,t,n){let r={};for(let n of e)r[n]=t;return np(r,G(G({},n),{},{[e2]:"Record"}))}function ie(e,t,n={}){var r,i,s,a,l;return t_(e)?(r=e.anyOf,r7(na(tV(r)),t,n)):tD(e)?(s=e,a=t,l=n,tQ(tX(s.pattern))?r7(na(s),a,l):r9(s.pattern,a,l)):tv(e)?(i=e.const,r7([i.toString()],t,n)):tc(e)?np({true:t,false:t},n):tf(e)||tA(e)?r9(ne,t,n):tI(e)?r9(e.source,t,n):tM(e)?r9(eJ(e.pattern)?nt:e.pattern,t,n):th(e,"Any")?r9(nt,t,n):tw(e)?r9("^(?!.*)$",t,n):tr(n)}function it(e){return globalThis.Object.getOwnPropertyNames(e.patternProperties)[0]}function ir(e){return e.patternProperties[it(e)]}function ii(e,t){return t.map(t=>is(e,t))}function is(e,t){var n,r,i,s;let a,l,o;return tp(t)||tm(t)?(t.parameters=ii(e,t.parameters),t.returns=is(e,t.returns),t):tg(t)?(t.allOf=ii(e,t.allOf),t):t_(t)?(t.anyOf=ii(e,t.anyOf),t):t$(t)?(eJ(t.items)||(t.items=ii(e,t.items)),t):tl(t)||to(t)||ty(t)?(t.items=is(e,t.items),t):tT(t)?(t.item=is(e,t.item),t):tk(t)?(n=e,r=t.properties,a=globalThis.Object.getOwnPropertyNames(r).reduce((e,t)=>{var i;let s,a,l;return G(G({},e),{},{[t]:(s=ti(i=r[t]),a=ts(i),l=is(n,i),s&&a?r6(l):s&&!a?nf(l):!s&&a?tF(l):l)})},{}),G(G({},t),np(a))):tE(t)?(o=ie(is(i=e,(l=it(s=t))===nt?t6():l===ne?t5():t6({pattern:l})),is(i,ir(s))),G(G({},s),o)):ta(t)?t.index in e?e[t.index]:nB():t}function ia(e,t){return is(t,rV(e))}function il(e){return eZ({[e3]:"Integer",type:"integer"},e)}function io(e,t){return"string"==typeof e?"Uncapitalize"===t?function(e){let[t,n]=[e.slice(0,1),e.slice(1)];return[t.toLowerCase(),n].join("")}(e):"Capitalize"===t?function(e){let[t,n]=[e.slice(0,1),e.slice(1)];return[t.toUpperCase(),n].join("")}(e):"Uppercase"===t?e.toUpperCase():"Lowercase"===t?e.toLowerCase():e:e.toString()}function iu(e,t){return e.map(e=>ic(e,t))}function ic(e,t,n={}){var r;let i;return tP(e)?e5((r=e.keys,r.reduce((e,r)=>{var i,s,a;return G(G({},e),(i=r,s=t,a=n,{[i]:ic(t3(i),s,eX(a))}))},{}))):tD(e)?tQ(i=tX(e.pattern))?ns([tV(iu([...t1(i)].map(e=>t3(e)),t))],n):G(G({},e),{},{pattern:io(e.pattern,t)}):t_(e)?tV(iu(e.anyOf,t),n):tv(e)?t3(io(e.const,t),n):eZ(e,n)}function id(e,t={}){return ic(e,"Capitalize",t)}function ip(e,t={}){return ic(e,"Lowercase",t)}function im(e,t={}){return ic(e,"Uncapitalize",t)}function ig(e,t={}){return ic(e,"Uppercase",t)}function iy(e,t,n){let r=ej(t)?tV(t.reduce((e,t)=>tb(t)?[...e,t3(t)]:e,[])):t,i=tN(t)?na(t):t,s=tR(e),a=tR(t);return tS(e)?e5(function(e,t,n){var r=e.properties;let i={};for(let e of globalThis.Object.getOwnPropertyNames(r))i[e]=iy(r[e],t,eX(n));return i}(e,i,n)):tP(t)?function(e,t,n){var r;return e5((r=t.keys,r.reduce((t,r)=>{var i,s;return G(G({},t),(i=e,{[s=r]:iy(i,[s],eX(n))}))},{})))}(e,t,n):s&&a||!s&&a||s&&!a?tn("Omit",[e,r],n):eZ(G(G({},function e(t,n){var r,i,s;let a;return tg(t)?tY((r=t.allOf,r.map(t=>e(t,n)))):t_(t)?tV((i=t.anyOf,i.map(t=>e(t,n)))):tk(t)?(a=e6(t,[eQ,"$id","required","properties"]),np((s=t.properties,n.reduce((e,t)=>(function(e,t){let{[t]:n}=e;return W(e,[t].map(B))})(e,t),s)),a)):np({})}(e,i)),n))}function ih(e,t,n){let r=ej(t)?tV(t.reduce((e,t)=>tb(t)?[...e,t3(t)]:e,[])):t,i=tN(t)?na(t):t,s=tR(e),a=tR(t);return tS(e)?e5(function(e,t,n){var r=e.properties;let i={};for(let e of globalThis.Object.getOwnPropertyNames(r))i[e]=ih(r[e],t,eX(n));return i}(e,i,n)):tP(t)?function(e,t,n){var r;return e5((r=t.keys,r.reduce((t,r)=>{var i,s;return G(G({},t),(i=e,{[s=r]:ih(i,[s],eX(n))}))},{})))}(e,t,n):s&&a||!s&&a||s&&!a?tn("Pick",[e,r],n):eZ(G(G({},function e(t,n){var r,i;let s;return tg(t)?tY((r=t.allOf,r.map(t=>e(t,n)))):t_(t)?tV((i=t.anyOf,i.map(t=>e(t,n)))):tk(t)?(s=e6(t,[eQ,"$id","required","properties"]),np(function(e,t){let n={};for(let r of t)r in e&&(n[r]=e[r]);return n}(t.properties,n),s)):np({})}(e,i)),n))}function ib(e){return e.map(e=>iv(e))}function iv(e){let t;return td(e)?tn("Partial",[tn(e.target,e.parameters)]):tR(e)?tn("Partial",[nP(e.$ref)]):tg(e)?tY(ib(e.allOf)):t_(e)?tV(ib(e.anyOf)):tk(e)?(t=e6(e,[eQ,"$id","required","properties"]),np(function(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=tF(e[n]);return t}(e.properties),t)):tu(e)||tc(e)||tf(e)||tv(e)||tC(e)||tA(e)||tM(e)||tO(e)||tL(e)?e:np({})}function iP(e,t){return tS(e)?e5(function(e,t){var n=e.properties;let r={};for(let e of globalThis.Object.getOwnPropertyNames(n))r[e]=iP(n[e],eX(t));return r}(e,t)):eZ(G(G({},iv(e)),t))}function iS(e){return e.map(e=>iw(e))}function iw(e){let t;return td(e)?tn("Required",[tn(e.target,e.parameters)]):tR(e)?tn("Required",[nP(e.$ref)]):tg(e)?tY(iS(e.allOf)):t_(e)?tV(iS(e.anyOf)):tk(e)?(t=e6(e,[eQ,"$id","required","properties"]),np(function(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=e6(e[n],[e1]);return t}(e.properties),t)):tu(e)||tc(e)||tf(e)||tv(e)||tC(e)||tA(e)||tM(e)||tO(e)||tL(e)?e:np({})}function iC(e,t){return tS(e)?e5(function(e,t){var n=e.properties;let r={};for(let e of globalThis.Object.getOwnPropertyNames(n))r[e]=iC(n[e],t);return r}(e,t)):eZ(G(G({},iw(e)),t))}function iA(e,t){return t in e?tR(e[t])?iA(e,e[t].$ref):iT(e,e[t]):tr()}function ik(e,t){return t.map(t=>iT(e,t))}function iT(e,t){var n,r,i,s,a;return ts(t)?eZ(iT(e,e6(t,[e1])),t):ti(t)?eZ(iT(e,e6(t,[e0])),t):tx(t)?eZ(tR(t)?G(G({},iA(e,t.$ref)),{},{[eQ]:t[eQ]}):t,t):tl(t)?eZ(e9(iT(e,t.items)),t):to(t)?eZ(e7(iT(e,t.items)),t):td(t)?eZ(function(e,t,n){let r=n.map(t=>tR(t)?iA(e,t.$ref):iT(e,t));return"Awaited"===t?rz(r[0]):"Index"===t?nc(r[0],r[1]):"KeyOf"===t?nk(r[0]):"Partial"===t?iP(r[0]):"Omit"===t?iy(r[0],r[1]):"Pick"===t?ih(r[0],r[1]):"Required"===t?iC(r[0]):tr()}(e,t.target,t.parameters)):tp(t)?eZ((n=t.parameters,r=t.returns,te(ik(e,n),iT(e,r))),t):tm(t)?eZ((i=t.parameters,s=t.returns,tt(ik(e,i),iT(e,s))),t):tg(t)?eZ(tY(ik(e,t.allOf)),t):ty(t)?eZ(nd(iT(e,t.items)),t):tk(t)?eZ((a=t.properties,np(globalThis.Object.keys(a).reduce((t,n)=>G(G({},t),{},{[n]:iT(e,a[n])}),{}))),t):tE(t)?eZ(function(e,t){let[n,r]=[iT(e,ir(t)),it(t)],i=rV(t);return i.patternProperties[r]=n,i}(e,t)):t$(t)?eZ(ng(ik(e,t.items||[])),t):t_(t)?eZ(tV(ik(e,t.anyOf)),t):t}var iE=class{constructor(e){let t=function(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>G(G({},t),{},{[n]:n in e?iT(e,e[n]):tr()}),{})}(e);this.$defs=this.WithIdentifiers(t)}Import(e,t){let n=G(G({},this.$defs),{},{[e]:eZ(this.$defs[e],t)});return eZ({[e3]:"Import",$defs:n,$ref:e})}WithIdentifiers(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>G(G({},t),{},{[n]:G(G({},e[n]),{},{$id:n})}),{})}};function iR(e){return new iE(e)}function iI(e,t){return eZ({[e3]:"Not",not:e},t)}function iM(e,t){return tm(e)?ng(e.parameters,t):tr()}let iO=0;function iD(e,t={}){eJ(t.$id)&&(t.$id=`T${iO++}`);let n=rV(e({[e3]:"This",$ref:`${t.$id}`}));return n.$id=t.$id,eZ(G({[e2]:"Recursive"},n),t)}function ix(e,t){let n=eK(e)?new globalThis.RegExp(e):e;return eZ({[e3]:"RegExp",type:"RegExp",source:n.source,flags:n.flags},t)}function i$(e){var t;return tg(e)?e.allOf:t_(e)?e.anyOf:t$(e)?null==(t=e.items)?[]:t:[]}function iL(e,t){return tm(e)?eZ(e.returns,t):tr(t)}var i_=class{constructor(e){this.schema=e}Decode(e){return new iN(this.schema,e)}},iN=class{constructor(e,t){this.schema=e,this.decode=t}EncodeTransform(e,t){return G(G({},t),{},{[eQ]:{Encode:n=>t[eQ].Encode(e(n)),Decode:e=>this.decode(t[eQ].Decode(e))}})}EncodeSchema(e,t){let n={Decode:this.decode,Encode:e};return G(G({},t),{},{[eQ]:n})}Encode(e){return tx(this.schema)?this.EncodeTransform(e,this.schema):this.EncodeSchema(e,this.schema)}};function iF(e){return new i_(e)}function iU(e){return eZ({[e3]:"Void",type:"void"},e)}let iB=(0,a.t)({Any:()=>nU,Argument:()=>rq,Array:()=>e9,AsyncIterator:()=>e7,Awaited:()=>rz,BigInt:()=>t8,Boolean:()=>t4,Capitalize:()=>id,Composite:()=>rJ,Const:()=>r3,Constructor:()=>te,ConstructorParameters:()=>r4,Date:()=>rX,Enum:()=>r8,Exclude:()=>function e(t,n,r={}){var i;let s;return tD(t)?eZ(e(ni(t),n),r):tS(t)?eZ(e5(function(t,n){var r=t.properties;let i={};for(let t of globalThis.Object.getOwnPropertyNames(r))i[t]=e(r[t],n);return i}(t,n)),r):eZ(t_(t)?(i=t.anyOf,1===(s=i.filter(e=>rY(e,n)===rS.False)).length?s[0]:tV(s)):rY(t,n)===rS.False?t:tr(),r)},Extends:()=>function e(t,n,r,i,s){var a,l,o,u;let c;return tS(t)?e5(function(t,n,r,i,s){var a=t.properties;let l={};for(let t of globalThis.Object.getOwnPropertyNames(a))l[t]=e(a[t],n,r,i,eX(s));return l}(t,n,r,i,s)):tP(t)?eZ(function(t,n,r,i,s){var a;return e5((a=t.keys,a.reduce((t,a)=>{var l,o,u,c,d;return G(G({},t),(l=a,o=n,u=r,c=i,d=s,{[l]:e(t3(l),o,u,c,eX(d))}))},{})))}(t,n,r,i,s)):eZ((a=t,l=n,o=r,u=i,(c=rY(a,l))===rS.Union?tV([o,u]):c===rS.True?o:u),s)},Extract:()=>function e(t,n,r){var i;let s;return tD(t)?eZ(e(ni(t),n),r):tS(t)?eZ(e5(function(t,n){var r=t.properties;let i={};for(let t of globalThis.Object.getOwnPropertyNames(r))i[t]=e(r[t],n);return i}(t,n)),r):eZ(t_(t)?(i=t.anyOf,1===(s=i.filter(e=>rY(e,n)!==rS.False)).length?s[0]:tV(s)):rY(t,n)===rS.False?tr():t,r)},Function:()=>tt,Index:()=>nc,InstanceType:()=>r5,Instantiate:()=>ia,Integer:()=>il,Intersect:()=>tY,Iterator:()=>nd,KeyOf:()=>nk,Literal:()=>t3,Lowercase:()=>ip,Mapped:()=>nv,Module:()=>iR,Never:()=>tr,Not:()=>iI,Null:()=>rZ,Number:()=>t5,Object:()=>np,Omit:()=>iy,Optional:()=>tF,Parameters:()=>iM,Partial:()=>iP,Pick:()=>ih,Promise:()=>nm,Readonly:()=>nf,ReadonlyOptional:()=>r6,Record:()=>ie,Recursive:()=>iD,Ref:()=>nP,RegExp:()=>ix,Required:()=>iC,Rest:()=>i$,ReturnType:()=>iL,String:()=>t6,Symbol:()=>rQ,TemplateLiteral:()=>ns,Transform:()=>iF,Tuple:()=>ng,Uint8Array:()=>r1,Uncapitalize:()=>im,Undefined:()=>r0,Union:()=>tV,Unknown:()=>nB,Unsafe:()=>e4,Uppercase:()=>ig,Void:()=>iU}),ij=iB.Union(["14D","1M","2M","3M","1Y","2Y"].map(e=>iB.Literal(e))),iY=iB.Union(z.map(e=>iB.Literal(e))),iG=iB.Union(Z.map(e=>iB.Literal(e))),iW=iB.Union([iG,...X.map(e=>iB.Literal(e))]),iH=iB.Union([...et.map(e=>iB.Literal(e))]),iV=iB.Union([iW,iH]);function iq(e){for(let r of e.configurations){var t,n;let i=function(e){var t;let{configuration:n,context:{user:r,article:i,paywall:s,app:a},schema:l}=e,u=null==(t=null==a?void 0:a.now)?new Date:t,c=n.configs.reduce((e,t)=>{let{targetCriteria:n=[],settings:l={}}=t;return!(null!=n&&n.length)||null!=n&&n.some(e=>{var t,n,l,o,c,p,m,f,g,y,h,b,v;return!(null!=e&&null!=(t=e.user)&&t.types&&(!(null!=r&&r.type)||!(null!=e&&null!=(n=e.user)&&null!=(n=n.types)&&n.includes(r.type)))||null!=e&&null!=(l=e.user)&&l.currencies&&null!=r&&r.currency&&!(null!=e&&null!=(o=e.user)&&null!=(o=o.currencies)&&o.includes(r.currency))||null!=e&&null!=(c=e.article)&&c.sections&&!function(e,t){return!!t&&e.some(e=>t.some(t=>t.toLowerCase().startsWith(e.toLowerCase())))}(null==e?void 0:e.article.sections,null==i?void 0:i.sections)||null!=e&&null!=(p=e.article)&&p.topics&&!d(null==e?void 0:e.article.topics,null==i?void 0:i.topics)||null!=e&&null!=(m=e.paywall)&&m.variants&&!d(null==e?void 0:e.paywall.variants,[null==(f=null==s?void 0:s.variant)?"":f])||null!=e&&null!=(g=e.paywall)&&g.types&&!d(null==e?void 0:e.paywall.types,[null==(y=null==s?void 0:s.type)?"":y])||null!=e&&e.dateRanges&&!function(e,t){return!!t&&!!t.find(t=>{let n=new Date(t.start)<=e,r=!!t.end&&e>=new Date(t.end);return n&&!r})}(u,null==e?void 0:e.dateRanges)||null!=e&&null!=(h=e.user)&&h.conversions&&!function(e,t){return!!t&&e.some(e=>{var n,r,i;if("last-inactive"!==e.state)return ev(t).filterByResources(e.resources).filterByBillingCycles(e.billingCycles).filterByUserAccessGrantedState(e.state).filterBySubscriptionAutoRenewalState(null==(i=e.isAutoRenewEnabled)||i).execute().length>0;{let i=ev(t).filterByUserAccessGrantedState("inactive").sortByAccessStartDate("desc").execute();if(0===i.length)return!1;let s=i[0],{billingCycle:a,resource:l}=ey.decodeTermName(null==(n=null==s||null==(r=s.term)?void 0:r.name)?"":n),o=!!l&&e.resources.includes(l),u=!!a&&e.billingCycles.includes(a);return o&&u}})}(e.user.conversions,null==r?void 0:r.conversions)||null!=e&&null!=(b=e.user)&&b.promotionUsage&&!function(e,t,n){if(!t)return!1;let r=t.reduce((e,t)=>{var n;if(!("promo_code"in t))return e;let r=null==(n=t.promo_code)?void 0:n.promotion_id;return r&&(e[r]?e[r]=e[r]+1:e[r]=1),e},{}),i={"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,">":(e,t)=>e>t,"=":(e,t)=>e===t},s="production"===n?"productionId":"sandboxId";return e.some(e=>{var t,n;let a=i[e.operator];return!!a&&a(null==(n=r[null==(t=e.promotion[s])?"":t])?0:n,e.limit)})}(null==(v=e.user)?void 0:v.promotionUsage,null==r?void 0:r.conversions,null==a?void 0:a.env))})?(0,o.A)(e,l):e},{});if(!function(...e){return 3===e.length?rH(e[0],e[1],e[2]):rH(e[0],[],e[1])}(l,c))return null;return{name:n.name,settings:c};function d(e,t){return!!t&&e.some(e=>t.some(t=>t.toLowerCase()===e.toLowerCase()))}}({configuration:r,context:e.context,schema:iK});if(null===i)continue;let s=null==(t=null==(n=e.context.app)?void 0:n.now)?new Date:t,a=i.settings.dates.find(e=>{let t=new Date(e.start)<=s,n=!!e.end&&s>=new Date(e.end);return t&&!n});if(void 0!==a)return G(G({},i),{},{activeDate:a})}return null}let iK=iB.Object({popup:iB.Optional(iB.Object({displayInterval:iB.Optional(iB.Object({days:iB.Optional(iB.Number())})),titleHTML:iB.String(),countDownTimer:iB.Optional(iB.Object({isEnabled:iB.Boolean(),label:iB.String()})),buttonCTA:iB.Object({label:iB.String(),link:iB.String()}),tncHTML:iB.Optional(iB.String())})),paywall:iB.Optional(iB.Object({recommendLabel:iB.Optional(iB.String()),headerHTML:iB.Optional(iB.String()),background:iB.Optional(iB.Object({fileNames:iB.Object({desktop:iB.String(),mobile:iB.String()})})),benefitListItems:iB.Optional(iB.Array(iB.String())),archive:iB.Optional(iB.Object({articleAgeThresholdDays:iB.Number()}))})),plans:iB.Array(iB.Object({resource:iV,billingCycle:ij,variant:iB.Optional(iY),promotionName:iB.Optional(iB.String())})),dates:iB.Array(iB.Object({start:iB.String(),end:iB.Optional(iB.String())})),tncLink:iB.Optional(iB.String()),subscriptionPageRibbonHTML:iB.Optional(iB.String())}),iz=Symbol.for("constructDateFrom");function iJ(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&iz in e?e[iz](t):e instanceof Date?new e.constructor(t):new Date(t)}function iX(e,t){return iJ(t||e,e)}var iZ=class{constructor(e,t={storage:localStorage,now:()=>new Date}){j(this,"activeCampaignSettings",void 0),j(this,"context",void 0),this.activeCampaignSettings=e,this.context=t}get popupSettings(){return this.activeCampaignSettings.settings.popup}get lastShownKey(){return`rosettaCampaignPopUpLastShown_${this.activeCampaignSettings.name}`}shouldShowPopupByInterval(){try{var e;if(!this.popupSettings)return!1;let t=this.popupSettings.displayInterval;if(!t)return!0;let n=this.context.storage.getItem(this.lastShownKey);if(!n)return!0;let r=function(e,t,n){var r;let i,{years:s=0,months:a=0,weeks:l=0,days:o=0,hours:u=0,minutes:c=0,seconds:d=0}=t,p=iX(e,void 0),m=a||s?function(e,t,n){let r=iX(e,void 0);if(isNaN(t))return iJ(e,NaN);if(!t)return r;let i=r.getDate(),s=iJ(e,r.getTime());return s.setMonth(r.getMonth()+t+1,0),i>=s.getDate()?s:(r.setFullYear(s.getFullYear(),s.getMonth(),i),r)}(p,a+12*s):p,f=o||l?(r=o+7*l,i=iX(m,void 0),isNaN(r)?iJ(m,NaN):(r&&i.setDate(i.getDate()+r),i)):m;return iJ(e,+f+(d+(c+60*u)*60)*1e3)}(new Date(Number.parseInt(n,10)),t);return e=this.context.now(),+iX(e)>+iX(r)}catch(e){return console.error("Failed to check campaign popup display interval.",{error:e}),!1}}shouldShowCounterTimer(){var e,t;return(null==(e=this.popupSettings)||null==(e=e.countDownTimer)?void 0:e.isEnabled)===!0&&(null==(t=this.activeCampaignSettings.activeDate)?void 0:t.end)!=null}markShown(){try{this.context.storage.setItem(this.lastShownKey,this.context.now().toString())}catch(e){console.error("Failed to update campaign popup last shown time.",{error:e})}}},iQ=class{static dispatchShowRequest({tracking:e}){window.dispatchEvent(new CustomEvent(this.eventName,{detail:{tracking:e}}))}static onShowRequest(e){return window.addEventListener(this.eventName,e),()=>{window.removeEventListener(this.eventName,e)}}};j(iQ,"eventName","scmp:campaign:popup:show");let i0=O.extend("utils/piano"),i1=Symbol("pianoConfig");function i2(){return(i2=F(function*(e){let t=_(i1);if(!t){let e=Error("Missing Piano Config. Please set with pianoSetConfig.");throw i0("pianoSetup()",e),e}let n=yield K.setup(G(G({},t),{},{externalJWTToken:w.A.get("scmp_pat"),cxenseSiteId:"production"===t.env?"1138611009236567654":void 0}));sessionStorage.setItem("subscribe.google.com:toast","1"),i6.forEach(t=>{n.addHandler(t,(...n)=>e.emit(t,...n))})})).apply(this,arguments)}function i3(e){var t,n,r,i,s,a,o,m,f,g;i0("pianoPrepareArticleData()",{article:e});let y={tags:[],contentAuthor:void 0,contentSection:void 0,contentCreated:void 0,contentIsNative:void 0,pageUrl:void 0,customVariables:{}},h=e.topics,b=e.sponsorType,v=null==(t=e.contentLock)||t,P=null==(n=e.types)||null==(n=n[0])||null==(n=n[0])?void 0:n.name,S=e.__typename;y.tags=(0,u.A)((0,c.A)(h,"name"),M(b)?[`sponsorType/${b}`]:[],M(P)?[`articleType/${P}`]:[],M(S)?[`contentType/${S}`]:[],v?[]:["contentUnlocked"]).filter(Boolean),y.customVariables={entityId:null==(r=e.entityId)?null:r,entityUuid:null==(i=e.entityUuid)?null:i,headline:null==(s=e.headline)?null:s},y.contentCreated=new Date(e.publishedDate||e.createdDate||0).toISOString(),y.contentAuthor=null==(a=null==(o=e.authors)||null==(o=o[0])?void 0:o.name)?void 0:a;let w=(0,d.A)(null==(m=e.sections)?[]:m);if((0,l.A)(w)||(y.contentSection=w.slice(-2).map(e=>e.name).join("/")),y.contentIsNative=!(0,p.A)(null==(f=e.sponsor)||f),"u">typeof location){let{protocol:t,host:n,pathname:r}=location;y.pageUrl=t+"//"+n+(null==(g=e.urlAlias)?r:g)}return y}function i4(e){i0("pianoSetArticleData()",{contentData:e}),K.setContentData(e)}function i8(e,t){return i5.apply(this,arguments)}function i5(){return(i5=F(function*(e,t){let n=Object.assign({},t,{user_provider:"piano_id_lite"});return(0,S.A)(Object.assign({},{url:`${e}`},I?{method:"POST",params:n}:{method:"GET",params:n,adapter:C}))})).apply(this,arguments)}let i6=["completeUpgradePurchase","checkoutComplete","checkoutClose","checkoutError","checkoutSelectTerm","checkoutStateChange","checkoutCustomEvent","showOffer","showTemplate","startCheckout","submitPayment","loginRequired","loginSuccess","experienceExecute","meterActive","meterExpired","beforeBrowserEvent","setResponseVariable","externalCheckoutComplete"],i9=Symbol("csConfig");var i7=(0,a.t)({BILLING_PERIOD:()=>ss,CACHE_KEYS:()=>si,FIX_TERM_IDS:()=>se,SUBSCRIBER_PHASES:()=>sr,WAIT_KEY_PIANO:()=>st,WAIT_KEY_WINDOW:()=>sn});let se=["TMPKDW7DW2F7","TMQUKCLWNAF4","TMKM4W55X891","TMS4536VXPO9","TMQNWRE0VDJK","TMLF1MZG4SGY","TMBFSJASEZWE","TMTTJZ3V2WFM","TM9KDFOKM3VI","TMT0CYJOOAV1","TMEUARRDGAHU","TMV8NG1EWOK3","TM4B3B5C3Q98","TMUBR23FAIX8","TMK3NEIOS5YB","TMX36JEWSO5S","TMR589AD3H7B","TM6AEZH2NL6S"],st="pianoExperience",sn="windowObject",sr={NONSUBSCRIBER:"non subscriber",PRECHURNING:"pre-churn(point of disable - l31d)",FIRSTCHURNING:"pre-churn(30-8 days before expiry)",SECONDCHURNING:"pre-churn(last 7 days before expiry)",FIRSTGRACE:"grace period(1st phase)",SECONDGRACE:"grace period(2nd phase)",WINBACK:"winback",DEFAULT:"subscription & upgrade"},si={ROSETTA_CONFIG:"rosettaConfig"},ss={MONTHLY:"1 month",ANNUAL:"1 year",BIANNUAL:"2 years"},sa=D("utils/rosetta"),sl={getConfig:()=>_(si.ROSETTA_CONFIG),setConfig(e){L(si.ROSETTA_CONFIG,e)},getOfferByName:e=>F(function*(){let t=so();try{var n,r;let i=yield S.A.get(`${t}/api/offer/list`,{params:{q:e}});return(null==i||null==(n=i.data)?void 0:n.code)===0&&(null==(r=i.data)||null==(r=r.offers)?void 0:r[0])||null}catch(e){return sa.error("getOfferByName()",e),null}})(),sendActivationEmail:e=>F(function*(){let{email:t,destination:n}=e,r=so(),{data:i}=yield S.A.post(`${r}/api/email/activation`,{email:t,destination:n});return i})(),fetchPromotionList:e=>F(function*(){let t=so(),{data:n}=yield S.A.get(`${t}/api/promotion/list?q=${e}`);return n})(),getPayment:e=>F(function*(){if(!e)return null;let t=so();try{let{data:n}=yield(0,S.A)({url:`${t}/api/payment/${e}`,method:"GET"});return{transactionId:null==n?void 0:n.transactionId}}catch(e){return null}})(),getUserConversionStatusFromWebhook:(e,t)=>F(function*(){try{var n,r;let i=t&&(null==(n=(0,k.default)(t))?void 0:n.email),s=so(e),a=yield S.A.post(`${s}/api/webhooks/user-conversion-status`,{orderBy:"create_date",orderDirection:"desc",userEmail:i});return null==(r=null==a?void 0:a.data)?{}:r}catch(e){return sa.error("getUserConversionStatusFromWebhook()",e),{}}})(),logPianoExecution:e=>F(function*(){try{yield S.A.post(`${so()}/api/tracking/piano-execution?url=${encodeURIComponent(window.location.href)}&isTrackingConfigNull=${!0===e}`,{},{withCredentials:!0})}catch(e){return console.error("Error executing piano tracking:",{error:e}),null}})(),checkCanSubscriptionUpgrade:(e,t)=>F(function*(){if(!e||!t)return!1;try{var n;let r=so(e),i=yield S.A.get(`${r}/api/term/change/can?subscriptionId=${t}`);return null!=(n=null==i?void 0:i.data.data)&&n}catch(e){return sa.error("checkCanSubscriptionUpgrade",e),!1}})()};function so(e=sl.getConfig()){if(!(null!=e&&e.uri))throw Error("Rosetta URI not set");return e.uri}let su=O.extend("rulesEngine/index");var sc=class{constructor(e){j(this,"state",void 0),this.state={key:e,waitFor:[],enabled:!0,executed:!1,priority:1,stage:1}}waitFor(e){return(0,m.A)(e)&&e.length>0?this.state.waitFor=e:"string"==typeof e&&""!==e&&(this.state.waitFor=[e]),this}when(e){return(0,f.A)(e)?this.state.when=e:su(`[${this.state.key}]: argument passed to when() must be a function`),this}then(e){return this.state.then=e,this}fallback(e){return this.state.fallback=e,this}priority(e){return this.state.priority=e,this}stage(e){return this.state.stage=e,this}deprecate(e){return su(`[${this.state.key}] is deprecated, reason: ${e}`),this}disable(){return this.state.enabled=!1,su(`[${this.state.key}] disabled`),this}enable(){return this.state.enabled=!0,su(`[${this.state.key}] enabled`),this}reset(){return this.state.executed=!1,su(`[${this.state.key}] reset`),this}execute(e,t){var n=this;return F(function*(){if(!0===n.state.enabled)try{var r,i;if(n.state.executed=!0,null!=(r=n.state)&&null!=(i=r.when)&&i.call(r,e,t))return su(`  [${n.state.key}] passed the condition test`),(0,f.A)(n.state.then)?yield n.state.then(e,t):n.state.then;if(su(`  [${n.state.key}] failed the condition test`),(0,f.A)(n.state.fallback))return yield n.state.fallback(e,t);if(void 0!==n.state.fallback)return n.state.fallback}catch(e){su(`  error when executing [${n.state.key}]: ${e.message}`)}else su(`  [${n.state.key}] is disabled, skipped`)})()}get rule(){return this.state}},sd=class{constructor(){j(this,"ruleSet",void 0),j(this,"facts",void 0),j(this,"outcome",void 0),j(this,"ready",void 0),j(this,"locked",void 0),this.ruleSet={},this.facts={},this.outcome={},this.ready=[],this.locked=!1}addRule(e){if(!(e instanceof sc))return void su(`  ${e} is not a Rule object`);let{key:t,priority:n,stage:r}=e.rule;su(`adding rule [${t}] (stage: ${r}, priority: ${n})`),t in this.ruleSet?n>this.ruleSet[t].rule.priority?(su(`  [${t}] (priority: ${n}) overwrites [${t}] (priority: ${this.ruleSet[t].rule.priority})`),this.ruleSet[t]=e):su(`  [${t}] (priority: ${n}) dropped because higher priority one exists: [${t}] (priority: ${this.ruleSet[t].rule.priority})`):this.ruleSet[t]=e}setReady(e){su(`[${e}] is ready`),this.ready.push(e)}getRule(e){return(0,g.A)(this.ruleSet[e])}getRuleSet(){return(0,g.A)(this.ruleSet)}addFact(e,t,n){let{replace:r}=null==n?{}:n;(su(`adding fact [${e}]`),this.facts[e]&&!r)?su(`  fact [${e}] already exists, skipped`):this.facts[e]=t}getFact(e){return(0,g.A)(this.facts[e])}getAllFacts(){return(0,g.A)(this.facts)}prepare(e){if((0,l.A)(e))return void su("  ruleSet is empty, nothing to execute");let t=[];for(let n of Object.values(e)){let{key:e,waitFor:r,executed:i,enabled:s}=n.rule;if(!0!==s){su(`  ${e} is disabled, will not execute`);continue}if(!0===i){su(`  ${e} already executed, will not execute`);continue}if(r.length>0&&0!==(0,y.A)(r,this.ready).length){su(`  ${e} is still waiting for [${r}], current ready list [${this.ready}], will not execute`);continue}t.push(n)}return t.sort((e,t)=>e.rule.stage-t.rule.stage),t.reduce((e,t)=>{var n;if(0===e.length)return[[t]];let r=null==e?void 0:e.at(-1);return t.rule.stage===(null==r||null==(n=r.at(0))?void 0:n.rule.stage)?r.push(t):e.push([t]),e},[])}run(e=""){var t=this;return F(function*(){t.locked&&(su("warn: run() triggered while executing rules, hold for %d ms",800),yield new Promise(e=>setTimeout(e,800))),su("---------- executing rules -------------"),t.locked=!0;let n=t.prepare(t.ruleSet);if(null!=n&&n.length){let r=(0,g.A)(t.facts);for(let[i,s]of n.entries()){su(`executing group [${i+1}]: ${s.length} rules`);let n=(0,g.A)(t.outcome),a=s.map(e=>e.execute(r,n)),l=yield Promise.all(a);for(let[n,r]of s.entries()){let{key:i}=r.rule;su(`  set outcome [${i}] with result: %o`,l[n]),(0,h.A)(t.outcome,i,l[n]),ud.emit(`outcome.${i}`,l[n],e)}}}ud.emit("onEngineRun",e),t.locked=!1})()}getOutcome(e){return(0,g.A)((0,b.A)(this.outcome,e))}getAllOutcome(){return(0,g.A)(this.outcome)}},sp=new sd,sm=(0,a.t)({getGeo:()=>sg});let sf=O.extend("services/geo");function sg(){return sy.apply(this,arguments)}function sy(){return(sy=F(function*(){try{var e,t,n,r;let i=function(){let e=ay("geo");if(!e)return sf("prepareAxiosInstance()","empty serviceConfig"),null;let t=e.apiUri,n=e.apiKey;return t&&n?S.A.create({baseURL:t,headers:{apiKey:n,"Access-Control-Allow-Origin":"*"},timeout:2e3,responseType:"json"}):(sf("prepareAxiosInstance()","apiUri and apiKey are required"),null)}();if(!i)return null;let s=yield i.get("/"),a=null==(e=null==s||null==(t=s.data)?void 0:t["CF-IPCountry"])?null:e,l=null==(n=null==s||null==(r=s.data)?void 0:r.IP)?null:n;return sf("getGeo()",{ipCountry:a,ip:l}),{ipCountry:a,ip:l}}catch(e){sf("getGeo()",e.message)}})).apply(this,arguments)}var sh=(0,a.t)({getTierInfo:()=>sP});let sb="tierInfo",sv=O.extend(`services/${sb}`);function sP(){return sS.apply(this,arguments)}function sS(){return(sS=F(function*(){try{let e=(JSON.parse(w.A.get("scmp_user")||"{}").useremail||"").toLowerCase();if(!e)return sv("getTierInfo()","userEmail is empty"),null;let t=function(){let e=ay(sb);if(!e||0===Object.keys(e).length)return sv("prepareAxiosInstance()","empty serviceConfig"),null;let t=e.apiUri,n=e.apiKey;if(!t||!n)return sv("prepareAxiosInstance()","apiUri and apiKey are required"),null;let r=S.A.create({baseURL:t,headers:{apiKey:n},timeout:2e3,responseType:"json"});return sv("prepareAxiosInstance()",{baseURL:t,headers:{apiKey:n}}),r}();if(!t)return null;let n=(yield t.post("/",{email:e})).data.Tier;return sv("getTierInfo()",n),n}catch(e){sv("getTierInfo() %s",e)}})).apply(this,arguments)}var sw=(0,a.t)({getPianoUserInfo:()=>sk,updatePianoUserHasShownSCMPPlusWelcomePopUpField:()=>sI,updatePianoUserHasShownSwGLinkingFlowField:()=>sE});let sC="pianoUserInfo",sA=O.extend(`services/${sC}`);function sk(){return sT.apply(this,arguments)}function sT(){return(sT=F(function*(){try{let e=sO();if(!e)return null;let t=(yield e.post("/get")).data.user;return sA("getPianoUserInfo()",t),t}catch(e){return sA("getPianoUserInfo() %s",e),null}})).apply(this,arguments)}function sE(e){return sR.apply(this,arguments)}function sR(){return(sR=F(function*(e){try{let t=sO();if(!t)return null;let n=yield t.post("/swg/linking",{hasShownSwGLinkingFlow:e}),r=n.data.success,i=n.data.error;return sA("updatePianoUserHasShownSwGLinkingFlowField()",{success:r,error:i}),r}catch(e){sA("updatePianoUserHasShownSwGLinkingFlowField() %s",e)}})).apply(this,arguments)}function sI(e){return sM.apply(this,arguments)}function sM(){return(sM=F(function*(e){try{let t=sO();if(!t)return null;let n=yield t.post("/scmp-plus-welcome-popup",{hasShownSCMPPlusWelcomePopUp:e}),r=n.data.success,i=n.data.error;return sA("updatePianoUserHasShownSCMPPlusWelcomePopUpField()",{success:r,error:i}),r}catch(e){sA("updatePianoUserHasShownSCMPPlusWelcomePopUpField() %s",e)}})).apply(this,arguments)}function sO(){let e=JSON.parse(w.A.get("scmp_user")||"{}").uuid;if(!e)return sA("prepareAxiosInstance()","userId is empty"),null;let t=ay(sC);if(!t||0===Object.keys(t).length)return sA("prepareAxiosInstance()","empty serviceConfig"),null;let n=t.aid,r=t.apiUri;if(!r||!n)return sA("prepareAxiosInstance()","apiUri and aid are required"),null;let i=S.A.create({baseURL:r,timeout:8e3,responseType:"json"});return i.interceptors.request.use(t=>(t.data=G(G({},t.data),{},{uid:e}),t)),i}var sD=(0,a.t)({getPianoPublisherConversions:()=>sL});let sx="pianoPublisherConversions",s$=O.extend(`services/${sx}`);function sL(e){return s_.apply(this,arguments)}function s_(){return(s_=F(function*({config:e,scmpUserCookie:t}){try{var n;let r=null==e?ay(sx):e;if(!r||0===Object.keys(r).length)return s$("getPianoPublisherConversions()","empty serviceConfig"),null;let i=r.aid,s=r.apiUri;if(!s||!i)return s$("getPianoPublisherConversions()","apiUri and aid are required"),null;let a=JSON.parse((null==t?w.A.get("scmp_user"):t)||"{}").uuid;if(!a)return s$("getPianoPublisherConversions()","userId is empty"),null;let l=(n=s)?S.A.create({baseURL:n,timeout:8e3,responseType:"json"}):(s$("prepareAxiosInstance()","apiUri is required"),null);if(!l)return null;let o=(yield l.post("/",{uid:a})).data.conversions;return s$("getPianoPublisherConversions()",o),o}catch(e){s$("getPianoPublisherConversions() %s",e)}})).apply(this,arguments)}function sN(e){let{jsLink:t,tagId:n}=e,r=O.extend(`addScript() tagId:${n}`);try{if(!t)return void r("jsLink is not available");if(document.getElementById(n))return void r("tagId already exists");let e=document.createElement("script");e.setAttribute("id",n),e.src=t,e.defer=!0,document.head.appendChild(e)}catch(e){r("[Error]",e.message)}}function sF(e){var t,n;let{filename:r}=e,i=O.extend(`getTemplateBuilderLink() filename:${r}`),s=null==(t=_(i9))?void 0:t.env;if(!s)return void i("env is not available");let a="production"===s?"https://assets.i-scmp.com/subscription-template":"https://product-web-scmp-pwa-dev.oss-cn-hongkong.aliyuncs.com/subscription-template",l=`${r}?ts=${Math.round(Date.now().valueOf()/1e3/60/60)}`;if("production"===s)return`${a}/${l}`;let o=null==(n=new URLSearchParams(window.location.search).get("branch"))?"staging":n;return"localhost"===o?`http://localhost:6016/dev/${l}`:`${a}/${o}/${l}`}var sU=(0,a.t)({addOnboardingScript:()=>sY,removeOnboardingScript:()=>sG});let sB=O.extend("services/onboarding"),sj="onboarding-script";function sY(){try{sN({jsLink:sF({filename:"subscriberonboarding.js"}),tagId:sj})}catch(e){sB("addOnboardingScript(): %s",e)}}function sG(){try{let e=document.getElementById(sj);null==e||e.remove()}catch(e){sB("removeOnboardingScript(): %s",e)}}let sW=O.extend("utils/appConfig");function sH(e){return sV.apply(this,arguments)}function sV(){return(sV=F(function*(e){let{env:t,apiUri:n,apiKey:r}=null==e?{}:e;if(!n||!r||!t)return void sW("fetchAppConfig(): apiUri, apiKey and env are required");try{sW("fetchAppConfig(): getting app config from graphql");let e=yield(0,S.A)({url:n,method:"POST",data:{query:'{ appConfig(filter: {entityId: "rosetta"}) { json } }'},headers:{apikey:r,"Access-Control-Allow-Origin":"*"}});if(200===e.status)return e.data.data.appConfig.json["production"===t?"production":"dev"];sW("fetchAppConfig()::error:%s",`status code ${e.status}`);return}catch(e){sW("fetchAppConfig()::error:%s",e);return}})).apply(this,arguments)}function sq(e){return sK.apply(this,arguments)}function sK(){return(sK=F(function*(e){if(I)return yield sH(null==e?void 0:e.contentService);let t=_(sJ);if(t)return t;let n=yield sH(null==e?void 0:e.contentService);return n&&L(sJ,n),n})).apply(this,arguments)}function sz(){return _(sJ)}let sJ=Symbol("appConfig");var sX=(0,a.t)({addAbandonerScript:()=>s0,cartAbandonerOfferShown:()=>ae,cleanupCookies:()=>at,placeTrigger:()=>an,registerOfferShown:()=>s7,showCartAbandonerOffer:()=>s6,showCartAbandonerOfferOnNextVisit:()=>s2,showRegisterOffer:()=>s8,showRegisterOfferOnNextVisit:()=>s1,trySignUpOfferByUserType:()=>s3});let sZ="cartAbandoner",sQ=O.extend(`services/${sZ}`);function s0(e){try{sN({jsLink:sF({filename:e}),tagId:"cart-abandoner-script"})}catch(e){sQ("addAbandonerScript() %s",e instanceof Error?e.message:e)}}function s1(){sQ("showRegisterOfferOnNextVisit(): adding cookie A"),aa("_caA")}function s2(){sQ("showCartAbandonerOfferOnNextVisit(): adding cookie B"),aa("_caB"),sQ("showCartAbandonerOfferOnNextVisit(): removing cookie A"),au("_caA")}function s3(){return s4.apply(this,arguments)}function s4(){return(s4=F(function*(){(yield function(){return as.apply(this,arguments)}())&&s2()})).apply(this,arguments)}function s8(){return s5.apply(this,arguments)}function s5(){return(s5=F(function*(){var e;let t=yield sq({contentService:_(i9)});null!=t&&null!=(e=t.cartAbandoner)&&e.showRegisterOffer&&(al("_caA")?(sQ("showRegisterOffer(): adding cartabandonerregister.js"),s0("cartabandonerregister.js"),sQ("pause the abandon plan experience (1-m free trial)")):sQ("showRegisterOffer(): cookie check failed, will not show offer"))})).apply(this,arguments)}function s6(){return s9.apply(this,arguments)}function s9(){return(s9=F(function*(){var e;let t=yield sq({contentService:_(i9)});null!=t&&null!=(e=t.cartAbandoner)&&e.showAbandonOffer&&(al("_caB")?(sQ("showCartAbandonerOffer(): adding cartabandoner.js"),s0("cartabandoner.js")):sQ("showCartAbandonerOffer(): cookie check failed, will not show offer"))})).apply(this,arguments)}function s7(){sQ("registerOfferShown(): update cookie counter"),ao("_caA")}function ae(){sQ("cartAbandonerOfferShown(): update cookie counter"),ao("_caB")}function at(){au("_caA"),au("_caB")}function an(e={}){let{isSCMPSubscriber:t,hasToken:n,isRosetta:r}=e;if(function(){if(!window||!window.localStorage)return!1;try{return"yes"===localStorage.getItem("_cartAbandoner_claim_flag")}catch(e){return sQ.error("hasCartAbandonerClaimFlag: ",e instanceof Error?e.message:e),!1}}())n&&s8();else{if(t)return void at();if(n){let e=al("_caB");e&&e.split(":").length<2&&s6()}else{let e=al("_caA");e&&e.split(":").length<2&&s8()}r?n?s2():s1():s3()}}function ar(e){return!!e&&""!==e&&!!w.A.get(e)}function ai(){var e;let{cookieDomain:t}=null==(e=ay(sZ))?{}:e;if(t)return{expires:90,domain:t,secure:!0}}function as(){return(as=F(function*(){var e,t,n;let{userTypeApiUri:r}=null==(e=ay(sZ))?{}:e;if(!r)return void sQ("isCartAbandonerUserType(): no userTypeApiUri");if(!ar("scmp_pat"))return void sQ("isCartAbandonerUserType(): not a registered user, skip calling api");if(ar("_caB"))return void sQ("isCartAbandonerUserType(): cookie B exists, skip calling api");let i=null==(t=window)||null==(t=t.ga)||null==(t=t.getAll())||null==(t=t[0])?void 0:t.get("clientId");if(!i)return void sQ("isCartAbandonerUserType(): no gaId, skip calling api");let s=yield S.A.get(`${r}/${i}`);return!!(null!=s&&null!=(n=s.data)&&null!=(n=n.data)&&null!=(n=n.user_types)&&n.find(e=>(null==e?void 0:e.id)==="009"))})).apply(this,arguments)}function aa(e){if(ar(e))return void sQ(`addCookie(): cookie [${e}] already exists`);let t=ai();t&&(sQ(`addCookie(): setting cookie [${e}]`),w.A.set(e,"i",t))}function al(e){let t=w.A.get(e);return t&&t.startsWith("i")?t:null}function ao(e){let t=al(e);if(t){let n,r=ai();return!!r&&(sQ(`updateCookie(): updating cookie [${e}]`),w.A.set(e,`${t}:${((n=new Date).getMonth()+1).toString().padStart(2,"0")+n.getDate().toString().padStart(2,"0")+n.getHours().toString().padStart(2,"0")}`,r),!0)}return!1}function au(e){let t=ai();e&&t&&w.A.remove(e,t)}var ac=(0,a.t)({addMastheadRenewPopUpScript:()=>ap});let ad=O.extend("services/masthead");function ap(){try{if(!document.getElementById("template-builder-container--mastheadrenewpopup")){let e=document.createElement("div");e.setAttribute("id","template-builder-container--mastheadrenewpopup"),document.body.appendChild(e)}sN({jsLink:sF({filename:"mastheadrenewpopup.js"}),tagId:"masthead-renew-pop-up-script"})}catch(e){ad("addMastheadScript(): %s",e)}}let am=O.extend("services"),af={geo:{service:sm,config:void 0,isRegistered:!1},tierInfo:{service:sh,config:void 0,isRegistered:!1},pianoUserInfo:{service:sw,config:void 0,isRegistered:!1},pianoPublisherConversions:{service:sD,config:void 0,isRegistered:!1},onboarding:{service:sU,config:null,isRegistered:!1},cartAbandoner:{service:sX,config:void 0,isRegistered:!1},mastheadRenewPopUp:{service:ac,config:null,isRegistered:!1}};function ag(e,...[t]){if(I)return void am("servicesRegister()","service registration is for client side only");if(!e){am("servicesRegister()","missing service name"),am("servicesRegister()",{serviceName:e,config:t});return}if(!af[e])return void am("servicesRegister()",`unknown service: ${e}`);try{af[e].config=t,af[e].isRegistered=!0}catch(e){am("servicesRegister()",e)}}function ay(e){return e?af[e].config:(am("servicesGetConfig()","serviceName not provided"),null)}function ah(e){return e?af[e].isRegistered?af[e].service:null:(am("servicesGetService()","serviceName not provided"),null)}let ab=O.extend("rulesEngine/apiCalls");function av(){return(av=F(function*(e){var t,n,r,i;let{apiUri:s,aid:a,token:l}=null==e?{}:e;if(!s||!a)return ab("getConversions(): apiUri and aid are required"),[];let o=null==l?null==(t=K.loadedInstance)?void 0:t.externalJWT:l;ab("getConversions(): getting conversions from piano");let u=yield i8(`${s}/conversion/list`,{aid:a,user_token:o,offset:0});return 200===u.status&&0===u.data.code?null==(n=null==u||null==(r=u.data)?void 0:r.conversions)?[]:n:(ab("getConversions()::error:%s",null==u||null==(i=u.data)?void 0:i.message),[])})).apply(this,arguments)}function aP(){return(aP=F(function*(e){var t,n,r,i;let{apiUri:s,aid:a,token:l}=null==e?{}:e;if(!s||!a)return ab("getSubscriptions(): apiUri and aid are required"),[];let o=null==l?null==(t=K.loadedInstance)?void 0:t.externalJWT:l;ab("getSubscriptions(): getting subscriptions from piano");let u=yield i8(`${s}/subscription/list`,{aid:a,user_token:o,offset:0});return 200===u.status&&0===u.data.code?null==(n=null==u||null==(r=u.data)?void 0:r.subscriptions)?[]:n:(ab("getSubscriptions()::error:%s",null==u||null==(i=u.data)?void 0:i.message),[])})).apply(this,arguments)}let aS=sl.getUserConversionStatusFromWebhook,aw=sl.checkCanSubscriptionUpgrade,aC=O.extend("rulesEngine/facts/guest");function aA(e){return ak.apply(this,arguments)}function ak(){return(ak=F(function*(e,t={}){var n,r,i;e.addFact("unSupportedGeos",aT),e.addFact("seaCountries",aE),e.addFact("euCountries",aR),e.addFact("hasToken",!(0,l.A)(null==(n=null==t||null==(r=t.piano)?void 0:r.token)?null==(i=K.loadedInstance)?void 0:i.externalJWT:n));try{let n=yield sq(t);(0,l.A)(n)?aC("error: appConfig is empty"):e.addFact("appConfig",n);let r=(0,b.A)((yield sg()),"ipCountry");(0,l.A)(r)&&(aC("error: geo is empty, assigned HK"),r="HK"),e.addFact("geo",r)}catch(e){aC("loadGuestFacts error: %s",e.message)}})).apply(this,arguments)}let aT="IN",aE="SG, PH, MY, IN, ID, BN, MM, TL, LA, TH, VN",aR="AD, AL, AT, AX, BA, BE, BG, BY, CH, CY, CZ, DE, DK, EE, ES, FI, FO, FR, GB, GG, GI, GR, HR, HU, IE, IM, IS, IT, JE, LI, LT, LU, LV, MC, MD, ME, MK, MT, NL, NO, PL, PT, RO, RS, RU, SE, SI, SJ, SK, SM, UA, VA, XK";function aI(e,t){return!Array.isArray(e)||e.length<1?[]:e.map(e=>null==t?void 0:t[e]).filter(Boolean)}function aM(e,t){if(!e||0===e.length)return"";for(let n in t)if(t[n]===e)return n;return e}let aO=["SCMP+ePaper","SCMP+Daily+ePaper","SCMP+SCMPPlus+ePaper","SCMP+SCMPPlus+Daily+ePaper","SCMP+SCMPPlus+Weekday+ePaper","SCMP+SCMPPlus+Weekend+ePaper","SCMP+Weekday+ePaper","SCMP+Weekend+ePaper","siteLicenseYP+YPePaper+SCMPePaper","siteLicenseYP+YPPrint+SCMPePaper","siteLicenseSCMPePaper","YPePaper","posties+ePaper","postiesEPaper","SCMPePaper","ypSparkEpaper","scmpEpaper+ypSparkDigital+ypSparkEpaper","b2bScmpEpaper","b2bScmpDigitalAndEpaper","b2bScmpDigitalAndEpaperAndPlus","b2bScmpDigitalAndPrintAndEPaper","b2bScmpDigitalAndPrintAndEPaperAndPlus","accessGrantedScmpEpaper"],aD=["SCMP","SCMP+Lite","SCMP+YP","SCMP+SCMPPlus+ePaper","SCMP+SCMPPlus+Daily+ePaper","SCMP+SCMPPlus+Weekday+ePaper","SCMP+SCMPPlus+Weekend+ePaper","printBundle","SCMP+ePaper","SCMP+Daily+ePaper","SCMP+Weekday+ePaper","SCMP+Weekend+ePaper"],ax=["YP","SCMP+YP"],a$=["posties","posties+ePaper"],aL=["SCMPPlus","SCMP+SCMPPlus+ePaper","SCMP+SCMPPlus+Daily+ePaper","SCMP+SCMPPlus+Weekday+ePaper","SCMP+SCMPPlus+Weekend+ePaper"],a_="SCMP.SCMP-B2B.SCMP+YP.SCMP+SCMPPlus+ePaper.SCMP+SCMPPlus+Daily+ePaper.SCMP+SCMPPlus+Weekday+ePaper.SCMP+SCMPPlus+Weekend+ePaper.corporateBulk.corporateDigital.siteLicenseSCMP.siteLicenseSCMP+YP.free.printBundle.internal.vip.partners.SCMP+ePaper.SCMP+Daily+ePaper.SCMP+Weekday+ePaper.SCMP+Weekend+ePaper.b2bScmpDigital.b2bScmpDigitalAndPlus.b2bScmpDigitalAndEpaper.b2bScmpDigitalAndEpaperAndPlus.b2bScmpDigitalAndPrint.b2bScmpDigitalAndPrintAndEPaper.b2bScmpDigitalAndPrintAndEPaperAndPlus.digitalAccessGranted.accessGrantedScmpDigital.ypOnlineScmpBundle".split("."),aN=["SCMP+Lite"],aF="SCMP.SCMP-B2B.SCMPePaper.SCMP+Lite.SCMP+YP.SCMP+SCMPPlus+ePaper.SCMP+SCMPPlus+Daily+ePaper.SCMP+SCMPPlus+Weekday+ePaper.SCMP+SCMPPlus+Weekend+ePaper.corporateBulk.corporateDigital.siteLicenseSCMP.siteLicenseSCMP+YP.free.printBundle.internal.vip.partners.SCMP+ePaper.SCMP+Daily+ePaper.SCMP+Weekday+ePaper.SCMP+Weekend+ePaper.b2bScmpDigital.b2bScmpDigitalAndPlus.b2bScmpEpaper.b2bScmpDigitalAndEpaper.b2bScmpDigitalAndEpaperAndPlus.b2bScmpDigitalAndPrint.b2bScmpDigitalAndPrintAndEPaper.b2bScmpDigitalAndPrintAndEPaperAndPlus.digitalAccessGranted.accessGrantedScmpDigital.accessGrantedScmpPlus.ypOnlineScmpBundle".split("."),aU=["YP","SCMP+YP","siteLicenseYP","siteLicenseSCMP+YP","siteLicenseYP+YPePaper+SCMPePaper","siteLicenseYP+YPPrint+SCMPePaper","ypSparkDigital","scmpDigital+ypSparkDigital","scmpEpaper+ypSparkDigital+ypSparkPrint","scmpEpaper+ypSparkDigital+ypSparkEpaper","scmpPrint+ypSparkDigital+ypSparkPrint","YPPrint","YPePaper"],aB=["ypSparkDigital","scmpDigital+ypSparkDigital","scmpEpaper+ypSparkDigital+ypSparkPrint","scmpEpaper+ypSparkDigital+ypSparkEpaper","scmpPrint+ypSparkDigital+ypSparkPrint"],aj=["posties","posties+ePaper","postiesSchool","postiesSchool+ePaper"],aY=["corporateBulk","corporateDigital"],aG=["free"],aW=["partners"],aH=["SCMPPlus","SCMP+SCMPPlus+ePaper","SCMP+SCMPPlus+Daily+ePaper","SCMP+SCMPPlus+Weekday+ePaper","SCMP+SCMPPlus+Weekend+ePaper","b2bScmpDigitalAndPlus","b2bScmpDigitalAndEpaperAndPlus","b2bScmpDigitalAndPrintAndEPaperAndPlus"];function aV(e){return aq(e).length>0}function aq(e){return ev(e).filterByResourceFamilies(["scmp"],"exact").filterByCustom((e,t)=>(function(e,t){let n=aK(e),r="true"!==e.user_access.granted.toString(),{platform:i,isSwG:s}=t;return n&&r&&"mobile"!==i&&!s})(e,t)).execute()}function aK(e){switch(e.term.type){case"payment":return!0;case"custom":return e.term.name.toLowerCase().includes("alipay");default:return!1}}function az(e,t){switch(t){case"scmp":case"yp":case"posties":let n=aJ({subscriptions:e.user.subscriptions,isSubscriptionActive:!0,targetResourceByFamilies:[t]});return 0!==n.length&&n.every(e=>!0===e.auto_renew)}}let aJ=function(e){let{subscriptions:t,isSubscriptionActive:n,targetResourceByFamilies:r}=e;return t.filter(e=>{let t=n?"active"===e.status:"active"!==e.status,{resourceFamilies:i}=ey.decodeTermName(e.term.name),s=r.some(e=>null==i?void 0:i.includes(e));return t&&s})};function aX(e){return t=>t.user_access.granted===e.granted}function aZ(e){return t=>new Set(e.targetTypes).has(t.term.type)}let aQ=[{resourceKeys:["digital"],parameters:[{sourceTerm:{billingCycle:"1M"},targetTerm:{billingCycle:"1M"}},{sourceTerm:{billingCycle:"1M"},targetTerm:{billingCycle:"1Y"}},{sourceTerm:{billingCycle:"1Y"},targetTerm:{billingCycle:"1Y"}},{sourceTerm:{billingCycle:"1Y"},targetTerm:{billingCycle:"2Y"}},{sourceTerm:{billingCycle:"2Y"},targetTerm:{billingCycle:"1Y"}},{sourceTerm:{billingCycle:"2Y"},targetTerm:{billingCycle:"2Y"}}]},{resourceKeys:["scmpAndScmpPlusEPaper"],parameters:[{sourceTerm:{billingCycle:"1M"},targetTerm:{billingCycle:"1M"}},{sourceTerm:{billingCycle:"1M"},targetTerm:{billingCycle:"1Y"}},{sourceTerm:{billingCycle:"1Y"},targetTerm:{billingCycle:"1Y"}},{sourceTerm:{billingCycle:"1Y"},targetTerm:{billingCycle:"2Y"}},{sourceTerm:{billingCycle:"2Y"},targetTerm:{billingCycle:"2Y"}}]},{resourceKeys:["scmpPlusDailyPrintBundle","scmpPlusWeekdayPrintBundle","scmpPlusWeekendPrintBundle"],parameters:[{sourceTerm:{billingCycle:"1Y"},targetTerm:{billingCycle:"1Y"}},{sourceTerm:{billingCycle:"1Y"},targetTerm:{billingCycle:"2Y"}},{sourceTerm:{billingCycle:"2Y"},targetTerm:{billingCycle:"2Y"}}]}].flatMap(e=>e.resourceKeys.flatMap(t=>e.parameters.map(e=>(function(e){let{sourceTerm:t,targetTerm:n}=e,r=function(e){let{sourceTerm:t,targetTerm:n}=e;return`WB[${t.billingCycle}${eC(t.resourceKey)}][${n.billingCycle}${eC(n.resourceKey)}]`}(e);return{name:`Winback: Source (${t.resourceKey} | ${t.billingCycle}) Target (${n.resourceKey} | ${n.billingCycle})`,offer:"winback",action:"subscribe",getPromotionName:e=>"USD-H"===e.user.currency?`PT-winback-usdh-${r}`:`PT-winback-${r}`,term:{billingCycle:n.billingCycle,resource:n.resourceKey},isEligible(e){var n,i,s;let a=null==(n=e.user.winback)?void 0:n.latestExpiredScmpB2CConversion;if(!a)return{isEligible:!1};let l=ey.decodeTermName(a.term.name),o=t.resourceKey===(null==l?void 0:l.resource),u=t.billingCycle.toLowerCase()===(null==l||null==(i=l.billingCycle)?void 0:i.toLowerCase());return!(o&&u)||null!=(s=e.user.redeemedPromoCodes)&&s.includes(r)?{isEligible:!1}:{isEligible:!0,source:{termId:a.term.term_id}}},selectTerm(e){let t=e.terms.find(t=>{var r;let i=ey.decodeTermName(t.name),s=n.resourceKey===i.resource&&n.billingCycle.toLowerCase()===(null==(r=i.billingCycle)?void 0:r.toLowerCase()),a=e.user.currency===i.currency,l="Rack"===i.variant,o=!i.isCrossProduct;return s&&a&&l&&o});return t?G(G({},t),{},{offerType:"WINBACK"}):null}}})({sourceTerm:{billingCycle:e.sourceTerm.billingCycle,resourceKey:t},targetTerm:{billingCycle:e.targetTerm.billingCycle,resourceKey:t}}))));function a0(e){let{conversions:t}=e;if(!t||0===t.length)return{latestExpiredScmpB2CConversion:null};let n=ev(t).filterByResourceFamilies(["scmp"],"exact").filterByCustom(e=>{let t="true"===e.user_access.granted.toString(),n=aK(e);return t&&n}).execute();if(null!=n&&n.length)return{latestExpiredScmpB2CConversion:null};let r=aq(t);return{latestExpiredScmpB2CConversion:r.reduce((e,t)=>{let n=r(e);return r(t)>n?t:e;function r(e){var t,n;let{user_access:r,subscription:i}=e;return null==(t=null==(n=r.expire_date)?null==i?void 0:i.end_date:n)?0:t}},r[0])}}let a1=["term","user_payment","user_payment_info"],a2=O.extend("rulesEngine/facts/user"),a3=D("rulesEngine/facts/user");function a4(e){return a8.apply(this,arguments)}function a8(){return(a8=F(function*(e,t={}){try{var n,r,i,s,a,o,u,c,d;e.addFact("userCookie",function(){try{let e=w.A.get("scmp_user");return e?JSON.parse(e):null}catch(e){return ab.error("getUserCookie error:",e),null}}());let[p=[],m=[],f={}]=yield Promise.all([function(e){return av.apply(this,arguments)}(null==t?void 0:t.piano),function(e){return aP.apply(this,arguments)}(null==t?void 0:t.piano),aS(t.rosetta,null==(n=t.piano)?void 0:n.token)]),g=e.getFact("appConfig");(0,l.A)(g)&&(a2("appConfig is empty, trying to get data from api again"),(g=yield sH(null==t?void 0:t.contentService))&&(o=g,L(sJ,o)));let y=(0,b.A)(g,"pianoResourceIds");e.addFact("pianoResourceIds",y),e.addFact("hasConversions",p.length>0);let h=p.map(e=>(0,b.A)(e,"term.name",""));e.addFact("allConversionTermNames",h);let P=p.map(e=>(0,b.A)(e,"term.type","").toLowerCase());e.addFact("allConversionTermTypes",P);let S=p.map(e=>(0,b.A)(e,"type","").toLowerCase());e.addFact("allConversionTypes",S);let C=p.map(e=>aM((0,b.A)(e,"term.resource.rid",""),y));e.addFact("allConversionResources",C);let[A,T]=(0,v.A)(p,e=>(0,b.A)(e,"user_access.granted"))||[[]],E=A.filter(e=>!(e.term.term_id in f)||"revoked"!==f[e.term.term_id]);null!=t&&null!=(r=t.piano)&&r.token&&a3.info("activeConversions: ",{activeConversions:E,activeConversionsBeforeFilter:A,userConversionStatusMap:f,userEmail:null==(s=(0,k.default)(null==t||null==(a=t.piano)?void 0:a.token))?void 0:s.email});let R=(d={user:{conversions:[...A.map(e=>(e.term.term_id in f&&(e.user_access.granted="revoked"!==f[e.term.term_id]),e)),...T],subscriptions:m}},["scmp","yp","posties"].reduce((e,t)=>{var n,r;let i,s;return(n=d,r=t,i=ev(n.user.conversions).filterByResourceFamilies([r],"subset").filterByCustom(aZ({targetTypes:["payment","custom"]})).filterByCustom(aX({granted:!0})).filterByCustom(e=>"scmp"!==r||aK(e)).execute().length>0,s=ev(n.user.conversions).filterByResourceFamilies([r],"subset").filterByCustom(aZ({targetTypes:["payment","custom"]})).filterByCustom(aX({granted:!1})).filterByCustom(e=>"scmp"!==r||aK(e)).execute().length>0,i||s)?!function(e,t){switch(t){case"scmp":case"yp":case"posties":let n=aJ({subscriptions:e.user.subscriptions,isSubscriptionActive:!0,targetResourceByFamilies:[t]});return 0!==n.length&&n.every(e=>!1===e.auto_renew)}}(d,t)?!function(e,t){switch(t){case"scmp":let n=aV(e.user.conversions),r=az(e,t);return n&&!r;case"yp":case"posties":let i=ev(e.user.conversions).filterByResourceFamilies([t],"subset").filterByCustom(aZ({targetTypes:["payment"]})).filterByCustom(aX({granted:!0})).execute().length>0,s=ev(e.user.conversions).filterByResourceFamilies([t],"subset").filterByCustom(aZ({targetTypes:["payment"]})).filterByCustom(aX({granted:!1})).execute().length>0,a=ev(e.user.conversions).filterByResourceFamilies([t],"subset").filterByCustom(aZ({targetTypes:["custom"]})).filterByCustom(aX({granted:!0})).execute().length>0,l=ev(e.user.conversions).filterByResourceFamilies([t],"subset").filterByCustom(aZ({targetTypes:["custom"]})).filterByCustom(aX({granted:!1})).execute().length>0;return!i&&!a&&(s||l)}}(d,t)?az(d,t)&&(e[t]="DEFAULT"):e[t]="CHURN":e[t]="PRE_CHURN":e[t]="NEW_USER",e},{posties:null,scmp:null,yp:null}));e.addFact("userTypes",R),e.addFact("activeConversions",E),e.addFact("hasActiveConversions",E.length>0);let[I]=(0,v.A)(m,e=>["active","completed"].includes((0,b.A)(e,"status","")))||[[]];e.addFact("hasActiveSubscriptions",I.length>0);let M=E.map(e=>(0,b.A)(e,"term.name",""));e.addFact("activeConversionTermNames",M);let O=E.map(e=>(0,b.A)(e,"term.type","").toLowerCase());e.addFact("activeConversionTermTypes",O);let D=E.map(e=>(0,b.A)(e,"type","").toLowerCase());e.addFact("activeConversionTypes",D);let x=E.map(e=>aM((0,b.A)(e,"term.resource.rid",""),y));e.addFact("activeConversionResources",x);let $=aV(p);e.addFact("hasSCMPB2CChurnedConversions",$);let _=aI(aD,y),N=p.filter(e=>_.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasIndividualSCMPConversions",N.length>0);let U=e=>{let{variant:t}=ey.decodeTermName(e.term.name);return"Trial"===t},B=p.filter(e=>_.includes((0,b.A)(e,"term.resource.rid"))&&!U(e));e.addFact("hasIndividualPaidSCMPConversions",B.length>0);let j=aI(ax,y),Y=p.filter(e=>j.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasIndividualYPConversions",Y.length>0);let G=aI(a$,y),H=p.filter(e=>G.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasIndividualPostiesConversions",H.length>0);let V=aI(aL,y),q=p.filter(e=>V.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasIndividualSCMPPlusConversions",q.length>0);let K=N.filter(e=>"payment"===(0,b.A)(e,"term.type")),z=H.filter(e=>"payment"===(0,b.A)(e,"term.type")),J=Y.filter(e=>"payment"===(0,b.A)(e,"term.type"));e.addFact("allIndividualPaymentSCMPConversions",K),e.addFact("hasIndividualPaymentSCMPConversions",K.length>0),e.addFact("hasIndividualPaymentPostiesConversions",z.length>0),e.addFact("allIndividualPaymentYPConversions",J.length>0);let X=N.filter(e=>(0,b.A)(e,"user_access.granted")).length>0;e.addFact("hasActiveIndividualSCMPConversions",X);let Z=Y.filter(e=>(0,b.A)(e,"user_access.granted")).length>0;e.addFact("hasActiveIndividualYPConversions",Z);let Q=aI(aF,y),ee=e=>Q.includes((0,b.A)(e,"user_access.resource.rid")),et=E.filter(ee);e.addFact("activeSCMPConversions",et),e.addFact("hasActiveScmpConversions",et.length>0);let en=aI(aN,y),er=E.filter(e=>en.includes((0,b.A)(e,"user_access.resource.rid")));e.addFact("activeSCMPLiteConversions",er),e.addFact("hasActiveScmpLiteConversions",er.length>0);let ei=aI(a_,y),es=E.filter(e=>ei.includes((0,b.A)(e,"user_access.resource.rid")));e.addFact("activeSCMPDigitalConversions",es),e.addFact("hasActiveScmpDigitalConversions",es.length>0);let ea=E.filter(e=>Q.includes((0,b.A)(e,"user_access.resource.rid"))&&!U(e));e.addFact("hasActivePaidSCMPConversions",ea.length>0);let el=aI(aU,y),eo=E.filter(e=>el.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActiveYpConversions",eo.length>0);let eu=aI(aB,y),ec=E.filter(e=>eu.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActiveYpSparkConversions",ec.length>0);let ed=aI(aj,y),ep=E.filter(e=>ed.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActivePostiesConversions",ep.length>0);let em=aI(aY,y),ef=E.filter(e=>em.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActiveCorpConversions",ef.length>0);let eg=aI(aG,y),eh=E.filter(e=>eg.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActiveFreeConversions",eh.length>0);let eb=Array.isArray(C)&&C.every(e=>"free"===e);e.addFact("hasOnlySCMPDigitalFreeResourceConversion",eb);let eP=aI(aW,y),eS=E.filter(e=>eP.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActivePartnersConversions",eS.length>0);let ew=aI(aH,y),eC=E.filter(e=>ew.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActiveSCMPPlusConversions",eC.length>0);let eA=E.filter(e=>"licensee contract redemption"===(0,b.A)(e,"type","").toLowerCase());e.addFact("hasActiveSiteLicenseConversions",eA.length>0);let ek=aI(aO,y),eT=E.filter(e=>ek.includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActiveEpaperConversions",eT.length>0),e.addFact("activeSiteLicenseTermName",(0,b.A)(eA,"0.term.name","")),e.addFact("activeSiteLicenseTermIds",eA.map(e=>e.term.term_id).join(","));let eE=I[0];e.addFact("latestActiveSubscription",eE);let eR=I.find(e=>["payment","external"].includes((0,b.A)(e,"term.type",""))&&aI(aD,y).includes((0,b.A)(e,"term.resource.rid")));yield(u=F(function*(){if(!eR)return void e.addFact("hasScmpChangeOptionsAvailable",!1);let n=yield aw(null==t?void 0:t.rosetta,eR.subscription_id);e.addFact("hasScmpChangeOptionsAvailable",n)}),function(){return u.apply(this,arguments)})(),e.addFact("activeScmpSubscription",eR),e.addFact("hasActiveScmpSubscription",!(0,l.A)(eR));let eI=I.find(e=>"payment"===(0,b.A)(e,"term.type","")&&aI(ax,y).includes((0,b.A)(e,"term.resource.rid")));e.addFact("hasActiveYpSubscription",!(0,l.A)(eI));let{allPublisherConversions:eM}=null==(i=yield(c=F(function*(e,n){try{let i=[];if(n>0){var r;i=null==(r=yield sL({config:null==t?void 0:t.pianoPublisherConversionsService,scmpUserCookie:null==t?void 0:t.scmpUserCookie}))?[]:r}let s=i.map(e=>{let{term:t,user_payment:n,user_payment_info:r}=e;return W(e,a1)});e.addFact("allPublisherConversions",s),e.addFact("hasPublisherConversions",s.length>0);let a=s.filter(e=>{var t;return(null==e||null==(t=e.user_access)?void 0:t.granted)&&(null==e?void 0:e.subscription)});e.addFact("activePublisherSubscriptionConversions",a),e.addFact("hasActivePublisherSubscriptionConversions",a.length>0),e.addFact("latestActivePublisherSubscriptionConversion",null==a?void 0:a[0]);let l=s.filter(ee);return e.addFact("activeSCMPPublisherConversions",l),{allPublisherConversions:i}}catch(e){a2("loadUserFacts error: %s",e.message)}}),function(e,t){return c.apply(this,arguments)})(e,K.length||z.length||J.length))?{}:i;e.addFact("winback",a0({conversions:eM}))}catch(e){a2("loadUserFacts error: %s",e.message)}})).apply(this,arguments)}let a5=O.extend("rulesEngine/facts/ipRangeAccess"),a6={hasSCMPLiteAccess:new Set(["SCMP+Lite"]),hasSCMPDigitalAccess:new Set(["SCMP","SCMP-B2B"]),hasSCMPPrintAccess:new Set(["printBundle"]),hasSCMPEpaperAccess:new Set(["SCMPePaper"]),hasSCMPPlusAccess:new Set(["SCMPPlus"]),hasYpDigitalAccess:new Set(["YP"]),hasYpPrintAccess:new Set(["YPPrint"]),hasYpEpaperAccess:new Set(["YPePaper"]),hasYpSparkDigitalAccess:new Set(["ypSparkDigital"]),hasYpSparkPrintAccess:new Set(["ypSparkPrint"]),hasYpSparkEpaperAccess:new Set(["ypSparkEpaper"]),hasPostiesDigitalAccess:new Set(["posties"]),hasPostiesEpaperAccess:new Set(["postiesEPaper"])},a9={hasSCMPLiteAccess:!1,hasSCMPDigitalAccess:!1,hasSCMPPrintAccess:!1,hasSCMPEpaperAccess:!1,hasSCMPPlusAccess:!1,hasYpDigitalAccess:!1,hasYpEpaperAccess:!1,hasYpSparkDigitalAccess:!1,hasYpSparkPrintAccess:!1,hasYpSparkEpaperAccess:!1,hasPostiesDigitalAccess:!1,hasPostiesEpaperAccess:!1};function a7(e){return le.apply(this,arguments)}function le(){return(le=F(function*(e){e.addRule(new sc("guest.userGeolocation").waitFor(sn).stage(0).when(()=>!0).then(({geo:e})=>e||"HK")),e.addRule(new sc("guest.supportPiano").waitFor(sn).when(({unSupportedGeos:e},{guest:{userGeolocation:t}={}})=>!(null!=e&&e.includes(t))).then(!0).fallback(!1)),e.addRule(new sc("guest.geoZone").waitFor(sn).when(()=>!0).then(({seaCountries:e,euCountries:t},{guest:{userGeolocation:n}={}})=>n?"HK"===n?"HK":"US"===n?"US":null!=t&&t.includes(n)?"EU":null!=e&&e.includes(n)?"SEA":"INT":"INT")),e.addRule(new sc("guest.currency").waitFor(sn).when(()=>!0).then(({},{guest:{userGeolocation:e}={}})=>(function(e){var t;let{userGeolocation:n}=null==e?{}:e;return null==(t=({HK:"HKD",SG:"SGD",MY:"MYR",PH:"USD-H",MO:"HKD",undefined:"USD"})[null==n?"undefined":n])?"USD":t})({userGeolocation:e})))})).apply(this,arguments)}let lt={isActive:!1,daysLeft:0,isWithinHalf:!1,expiryDate:null,halfExpiryDate:null,startDate:null};function ln(e){let[t]=e.split(" | "),[n,r]=t.split(": ");return r?`${n}: ${lr(r)}`:t}function lr(e){return({"digital + daily epaper":"Daily (Mon-Sun) Bundle","digital + weekend print + weekend epaper":"Weekend (Sat-Sun) Bundle","digital + weekday print + weekday epaper":"Weekday (Mon-Fri) Bundle","digital + daily print + daily epaper":"Daily (Mon-Sun) Bundle","digital + scmp plus + daily epaper":"Plus","digital + plus + daily epaper":"Plus","digital + plus + weekend print + weekend epaper":"Bundle Plus (Weekend)","digital + plus + weekday print + weekday epaper":"Bundle Plus (Weekday)","digital + plus + daily print + daily epaper":"Bundle Plus (Daily)"})[e.toLowerCase().replace(/^scmp /,"")]||e}function li(e){var t,n,r,i,s,a;let l=null==(t=null==e||null==(n=e.term)?void 0:n.term_id)?"":t,o=ln(null==(r=null==e||null==(i=e.term)?void 0:i.name)?"":r);return{termId:l,expireDate:null==(s=null==e||null==(a=e.user_access)?void 0:a.expire_date)?null:s,name:o}}let ls=ey.decodeTermName,la={digital:"digital"},ll={"digital + daily epaper":"dailyEPaperBundle","digital + weekend print + weekend epaper":"weekendPrintBundle","digital + weekday print + weekday epaper":"weekdayPrintBundle","digital + daily print + daily epaper":"dailyPrintBundle"},lo={"digital + plus + daily epaper":"scmpAndScmpPlusEPaper"},lu={"digital + plus + daily print + daily epaper":"scmpPlusDailyPrintBundle","digital + plus + weekend print + weekend epaper":"scmpPlusWeekendPrintBundle","digital + plus + weekday print + weekday epaper":"scmpPlusWeekdayPrintBundle"},lc={"posties epaper + digital":"postiesEPaperAndDigital","posties print + digital":"postiesPrintAndDigital"},ld={yp:"yp","digital + yp":"scmpPlusYp"};function lp(e){var t;let[n,r]=e.split(" / "),i=(e,t)=>{let n=e.exec(t);if(!(null!=n&&n.groups))return null;let{currency:r,price:i,frequency:s,billingPeriod:a}=n.groups;return{currency:"$"===r?"USD":r,price:"free"===i?0:parseFloat(i.replace(/,/g,"")),frequency:void 0===s?1:parseInt(s.replace(/,/g,"")),billingPeriod:a}},s=i(RegExp("^(?<currency>EUR|USD|CAD|AUD|SGD|PHP|MYR|GBP|HKD|\\$)?(?<price>[\\d,]*\\.[\\d,]*)?.?(?:every (?<frequency>[\\d,]+)|per)?.?(?:(?<billingPeriod>year|month|week|day)s?)$",""),n),a=i(RegExp("(?<currency>EUR|USD|CAD|AUD|SGD|PHP|MYR|GBP|HKD|\\$)?(?<price>[\\d,]*\\.[\\d,]*|free).+(?:for (?<frequency>[\\d,]*) (?<billingPeriod>year|month|week|day)s?)$",""),r);return s?{rack:s,trial:a?G(G({},a),{},{currency:null==(t=a.currency)?s.currency:t}):null}:null}function lm(e){let{decodedTerm:t}=e;return null!=t&&t.resource?new Set(Object.values(G(G(G(G({},la),ll),lo),lu))).has(t.resource)?"scmp":new Set(Object.values(ld)).has(t.resource)?"yp":new Set(Object.values(lc)).has(t.resource)?"posties":"unknown":"unknown"}function lf(e){let{term:t}=e,{resource:n}=ls(t.name);return n?new Set(Object.values(G(G({},la),ll))).has(n)?"scmp(standard)":new Set(Object.values(lo)).has(n)?"scmp(plus)":new Set(Object.values(lu)).has(n)?"scmp(bundle-plus)":new Set(Object.values(ld)).has(n)?"yp":new Set(Object.values(lc)).has(n)?"posties":"unknown":"unknown"}let lg={expireDate:0,dayLeft:0,termPeriod:"",isFirstChurning:!1,isSecondChurning:!1};function ly(e){var t;let{termPeriod:n,appConfig:r,type:i}=e,s={"first-churn":"1 month"===n?30:90,"second-churn":7}[i];if(!n)return s;let a={"first-churn":{"1 month":"monthlyFirstChurnDayLeft","1 year":"annualFirstChurnDayLeft","2 years":"biannualFirstChurnDayLeft"},"second-churn":{"1 month":"monthlySecondChurnDayLeft","1 year":"annualSecondChurnDayLeft","2 years":"biannualSecondChurnDayLeft"}}[i][n];if(!a)return s;let l=null==r||null==(t=r.expiryReminder)?void 0:t[a],o=parseInt(String(null==l?s:l),10);return isNaN(o)?s:o}let lh="UPGRADE",lb="RENEW",lv="DOWNGRADE",lP="PRECHURN";function lS(e,t=0){let n=Math.pow(10,t);return Math.round(parseFloat((e*n).toFixed(11)))/n}function lw(e){let{term:t,promotion:n,action:r="SUBSCRIBE",isNewPianoCustomer:i}=e,s=(function(e){var t,n,r,i;return null==(t=null==(n=null==e||null==(r=e.payment_billing_plan_table)?void 0:r.map(s))?null==e||null==(i=e.billingPlanTable)?void 0:i.map(s):n)?[]:t;function s(e){var t,n;return{billingPeriod:function(e){var t,n;let{billingPeriodValue:r,billingPeriodUnit:i}=null==(t=null==(n=RegExp("(?<billingPeriodValue>\\d+) (?<billingPeriodUnit>year|month|week|day)s?","").exec(e))?void 0:n.groups)?{}:t;return{value:parseInt(r,10),unit:i}}(e.billingPeriod),cycles:Number.parseInt(e.cycles,10),currency:e.currency,price:e.priceValue,taxRate:null==(t=e.taxRate)?0:t,tax:null==(n=e.taxValue)?0:n,total:e.priceAndTax,isTrial:"true"===e.isTrial,isFree:"true"===e.isFree}}})(t).filter(e=>(function(e){let{entry:t,context:{action:n}}=e;return n!==lb||t.cycles===lk.INFINITE})({entry:e,context:{action:r}})).filter(e=>{var n;return function(e){let{entry:t,context:{isNewPianoCustomer:n,isTrialBillingPlanForNewCustomersOnly:r}}=e;return!r||!t.isTrial||n}({entry:e,context:{isNewPianoCustomer:i,isTrialBillingPlanForNewCustomersOnly:null==(n=null==t?void 0:t.payment_trial_new_customers_only)?function(e){let{isCrossProduct:t,resource:n="",variant:r=""}=ls(e.name);return!(t||r&&new Set("Rack.2024JAN.IntroABTest(B).LiteABTest(50%).LiteABTest(70%).LiteABTest(85%).AddInk.PlusSoftLaunch(1M).PlusSoftLaunch(2M).Upgrade(Intro).Upgrade(50%).Downgrade(50%).Downgrade(Intro).Intro.DIGITIMES.FreeTrial(3M).LTS(N-0).LTS(N-1).LTS(N-2).LTS(L-0).LTS(L-1).LTS(L-2).LTS(M-0).LTS(M-1).LTS(M-2).LTS(H-0).LTS(H-1).LTS(H-2).USElection2024".split(".")).has(r)||["scmpAndScmpPlusEPaper","scmpPlusDailyPrintBundle","scmpPlusWeekdayPrintBundle","scmpPlusWeekendPrintBundle"].includes(n))}({name:t.name}):n}})});return n?function(e,t){switch(t.discount_type){case"fixed":{var n;let i=null==(n=t.fixed_discount_list)?void 0:n.find(t=>{var n;return t.currency===(null==(n=e.at(0))?void 0:n.currency)});if(!i)return e;let s=e=>{let t=i.amount_value,n=(100*e.price-100*t)/100,r=n*e.taxRate;return G(G({},e),{},{originalPrice:e.price,price:n,tax:r,total:n+r,isFree:n<=0})};return t.apply_to_all_billing_periods?e.map(e=>e.isFree?e:s(e)):r({consolidatedBillingTable:e,calculateDiscountedBillingPlan:s})}case"percentage":{let n=e=>{var n;let r=null==(n=t.percentage_discount)?0:n,i=lS(e.price*(1-r/100),2),s=lS(i*e.taxRate);return G(G({},e),{},{originalPrice:e.price,price:i,tax:s,total:i+s,isFree:i<=0})};return t.apply_to_all_billing_periods?e.map(n):r({consolidatedBillingTable:e,calculateDiscountedBillingPlan:n})}}function r(e){var n;let{consolidatedBillingTable:r,calculateDiscountedBillingPlan:i}=e;return r.reduce((e,t)=>{if(e.remainingDiscountBillingPeriod<=0||t.isFree)return e.consolidatedBillingTable.push(t),e;let n=Math.min(e.remainingDiscountBillingPeriod,t.cycles);return e.remainingDiscountBillingPeriod-=n,e.consolidatedBillingTable.push(G(G({},i(t)),{},{cycles:n})),t.cycles-n>0&&e.consolidatedBillingTable.push(G(G({},t),{},{cycles:t.cycles===lk.INFINITE?lk.INFINITE:t.cycles-n})),e},{consolidatedBillingTable:[],remainingDiscountBillingPeriod:null==(n=null==t?void 0:t.billing_period_limit)?0:n}).consolidatedBillingTable}}(s,n):s}function lC(e){var t,n;if(!e||!e.length)return null;let r=({fromBillingPeriod:e,toBillingPeriod:t,price:n})=>{let r={year:12,month:1,week:1/4,day:1/30};if(!r[e.unit]||!r[t.unit])throw Error("Invalid billing unit");let i=e.value*r[e.unit];return n*(t.value*r[t.unit]/i)},i=e.find(e=>e.isFree),s=e.find(e=>!e.isFree),a=e.at(-1);if(!s||!a)return null;let l=null==(t=a.originalPrice)?a.price:t,o=s.price,u=i?{value:i.billingPeriod.value*i.cycles,unit:i.billingPeriod.unit}:void 0,c={value:s.billingPeriod.value*s.cycles,unit:s.billingPeriod.unit},d=r({price:o,fromBillingPeriod:s.billingPeriod,toBillingPeriod:c}),p=r({price:l,fromBillingPeriod:a.billingPeriod,toBillingPeriod:c}),m=Math.round(lS((p-d)/p*100,2)),f=m>0,g=s.cycles,y=s.billingPeriod.unit!==a.billingPeriod.unit,h=s.billingPeriod.value>1,b=1===s.billingPeriod.value,v=(null==e?void 0:e.length)===1&&(null==(n=e[0])?void 0:n.cycles)===lk.INFINITE;return{currency:s.currency,isDiscounted:f,discountPercentage:m,monthlyChargePrice:r({price:o,fromBillingPeriod:s.billingPeriod,toBillingPeriod:{value:1,unit:"month"}}),monthlyOriginalPrice:r({price:l,fromBillingPeriod:a.billingPeriod,toBillingPeriod:{value:1,unit:"month"}}),hasFreeTrial:!!i,totalFreePeriod:u,totalChargePeriod:c,totalChargePeriodText:lA(c),chargePriceDuringTotalChargePeriod:d,originalPriceDuringTotalChargePeriod:p,originalPrice:l,originalBillingPeriod:a.billingPeriod,originalBillingPeriodText:lA(a.billingPeriod),chargeCycle:g,chargePrice:o,chargeBillingPeriod:s.billingPeriod,chargeBillingPeriodText:lA(s.billingPeriod),isSinglePaymentMultiPeriodDiscountWithVariedBillingPeriods:f&&1===g&&h&&y,isMultiplePaymentSinglePeriodDiscount:f&&g>1&&b,isSingleRecurringBillingTable:v}}function lA(e,t){let{useExplicitValue:n=!1}=null==t?{}:t,{value:r,unit:i}=e;return 1===r?n?`${r} ${i}`:`${i}`:`${r} ${i}s`}(0,a.t)({consolidateBillingTable:()=>lw,formatBillingPeriod:()=>lA,transformConsolidatedBillingTableToPlanData:()=>lC});let lk={INFINITE:0x7fffffff};function lT(e){return lE.apply(this,arguments)}function lE(){return(lE=F(function*({activeConversions:e,configs:t,searchPromotions:n}){var r;let i=t.find(e=>"Pre-churn Flow Override"===e.name);if(!(null!=i&&null!=(r=i.settings)&&r.plans))return[];let s=e.map(e=>null==e?void 0:e.subscription).find(e=>{let t=!(null!=e&&e.auto_renew),n=(null==e?void 0:e.status)==="active",r=null!=e&&!!e.next_bill_date&&T().isAfter(T.unix(null==e?void 0:e.next_bill_date).subtract(90,"days"));return t&&n&&r});if(!s)return[];let{billingCycle:a,resource:l}=ey.decodeTermName(s.term.name),o=i.settings.plans.find(e=>e.billingCycle===a&&e.resource===l);if(!(null!=o&&o.promotionName))return[];let[u]=yield n({names:[o.promotionName]});if(!u)return[];let c=lw({term:s.term,promotion:u,action:"RENEW",isNewPianoCustomer:!1});return[{term:s.term,promotionName:u.name,promotion:u,consolidatedBillingTable:c,subscribeAction:"RENEW"}]})).apply(this,arguments)}function lR(e){let{targetPreChurnSubscription:t,preChurnPromoCodeUsageMap:n={}}=e;if(!t)return!1;let{billingCycle:r,resource:i}=ls(t.term.name);return!!n[`${i}-${r}`]}function lI(e){return(function(e){let{conversions:t,validationFn:n}=e;return t.reduce((e,t)=>(n(t)&&e.push(t),e),[])})({conversions:e,validationFn:e=>{var t,n;return null!=(t=null==(n=e.promo_code)?void 0:n.code.startsWith("prechurn-"))&&t}}).reduce((e,t)=>{let{billingCycle:n,resource:r}=ls(t.term.name);return e[`${r}-${n}`]=!0,e},{})}function lM(e,t){let{offerType:n,payment_trial_new_customers_only:r}=null==t?{}:t,i=function(e){if(!e)return[];try{let t=[];return e.trial&&e.trial.price>0&&e.trial.price!==e.rack.price&&t.push({billingPeriod:`${e.trial.frequency} ${e.trial.billingPeriod}`,cycles:"1",currency:e.trial.currency,priceValue:e.trial.price,taxValue:0,priceAndTax:e.trial.price,isTrial:"true",isFree:"false"}),t.push({billingPeriod:`${e.rack.frequency} ${e.rack.billingPeriod}`,cycles:"2147483647",currency:e.rack.currency,priceValue:e.rack.price,taxValue:0,priceAndTax:e.rack.price,isTrial:"false",isFree:"false"}),t}catch(e){console.error(e)}}(lp(e.to_billing_plan));return{term_id:e.to_term_id,offerType:n,name:e.to_term_name,payment_billing_plan_table:i,payment_trial_new_customers_only:r}}function lO(e){return lD.apply(this,arguments)}function lD(){return(lD=F(function*(e){let{conversions:t,overallSubscriptionDaysLeft:n,redeemedPromoCodes:r,searchPromotions:i,isNewPianoCustomer:s,canUseChangeOptions:a}=e;return i?yield lY({plansDefinition:lx,conversions:t,overallSubscriptionDaysLeft:n,redeemedPromoCodes:r,searchPromotions:i,isNewPianoCustomer:s,canUseChangeOptions:a}):[]})).apply(this,arguments)}let lx={oneYearPreChurnPlans:{renewalPlan:{isEligible(e){var t;let{conversions:n,overallSubscriptionDaysLeft:r,redeemedPromoCodes:i}=e,{isEligibleForPromo:s,termCurrency:a,targetConversion:l}=l$(n,r,i);return s&&l&&null!=l&&null!=(t=l.subscription)&&t.term?{isEligible:!0,eligibleContext:{subscribeAction:lb,term:G(G({},l.subscription.term),{},{offerType:lP}),promotionName:`PT-2024jan-promo-code-subs-annual-renewal-70%-off${"USD-H"===a?"-"+a:""}`}}:{isEligible:!1}}},digital2YIntroUpgradePlan:{isEligible(e){var t;let{conversions:n,overallSubscriptionDaysLeft:r,redeemedPromoCodes:i,canUseChangeOptions:s}=e,{isEligibleForPromo:a,targetConversion:l}=l$(n,r,i);if(!a||!s)return{isEligible:!1};let o=null==l||null==(t=l.subscription)||null==(t=t.term)?void 0:t.change_options,u=null==o?void 0:o.find(e=>{let{resource:t,billingCycle:n,variant:r}=ls(e.to_term_name);return"2y"===n&&"digital"===t&&"Upgrade(Intro)"===r});return u?{isEligible:!0,eligibleContext:{subscribeAction:lh,term:lM(u,{offerType:lP})}}:{isEligible:!1}}}}};function l$(e,t,n){var r,i,s;let a=e.find(e=>"Subscription"===e.type),l=null==a||null==(r=a.subscription)||null==(r=r.term)?void 0:r.name,o=null==a||null==(i=a.subscription)||null==(i=i.term)?void 0:i.payment_currency;if(!l||t>90)return{isEligibleForPromo:!1};let{billingCycle:u,currency:c,resource:d}=ls(l),p=n.includes("renew2024JanPromoCodeSubs2425q3"),m=(null==a||null==(s=a.promo_code)?void 0:s.code)==="2024jan";return{isEligibleForPromo:!p&&m&&"1y"===u&&"HKD"!==o&&"digital"===d,termCurrency:c,targetConversion:a}}function lL(e){return l_.apply(this,arguments)}function l_(){return(l_=F(function*(e){let{subscriptions:t,preChurnPromoCodeUsageMap:n,shouldIncludeDowngradePlan:r=!1,searchPromotions:i,isNewPianoCustomer:s,canUseChangeOptions:a}=e;return i?yield lY({plansDefinition:lN,searchPromotions:i,subscriptions:t,preChurnPromoCodeUsageMap:n,shouldIncludeDowngradePlan:r,isNewPianoCustomer:s,canUseChangeOptions:a}):[]})).apply(this,arguments)}let lN={oneMonthPreChurnPlans:{standard1MWith3MIntroPriceRenewalPlan:lF("1m"),standard1YWith1MHalfPriceUpgradePlan:{isEligible({subscriptions:e,canUseChangeOptions:t}){var n;let r=lB({subscriptions:e,billingCycle:"1m"}),i=null==r||null==(n=r.term)?void 0:n.change_options;if(!i||!i.length||!t)return{isEligible:!1};let s=i.find(e=>{let{resource:t,billingCycle:n,variant:r}=ls(e.to_term_name);return"digital"===t&&"1y"===n&&"Upgrade(50%)"===r});return s?{isEligible:!0,eligibleContext:{subscribeAction:lh,term:lM(s,{offerType:lP})}}:{isEligible:!1}}},plusOnlyRackPriceDowngradePlan:lU("1m")},oneYearPreChurnPlans:{standard1YWith1YSeventyPercentOffPriceRenewalPlan:lF("1y"),plusOnlyRackPriceDowngradePlan:lU("1y")},twoYearPreChurnPlans:{standard2YWith2YSeventyPercentOffPriceRenewalPlan:lF("2y"),standard1YRackPriceDowngradePlan:{isEligible(e){var t;let{subscriptions:n,shouldIncludeDowngradePlan:r,canUseChangeOptions:i}=e,s=lB({subscriptions:n,billingCycle:"2y"}),a=null==s||null==(t=s.term)?void 0:t.change_options;if(!r||!a||!a.length||!i)return{isEligible:!1};let l=a.find(e=>{let{resource:t,billingCycle:n,variant:r}=ls(e.to_term_name);return"digital"===t&&"1y"===n&&null==r});return l?{isEligible:!0,eligibleContext:{subscribeAction:lv,term:lM(l,{offerType:lP,payment_trial_new_customers_only:!0})}}:{isEligible:!1}}},plusOnlyRackPriceDowngradePlan:lU("2y")}};function lF(e){return{isEligible(t){let{subscriptions:n}=t,r=lB({subscriptions:n,billingCycle:e});if((null==r?void 0:r.next_bill_date)==null)return{isEligible:!1};let i=90>=T(T.unix(null==r?void 0:r.next_bill_date)).diff(T(),"day"),s=lR({targetPreChurnSubscription:r,preChurnPromoCodeUsageMap:t.preChurnPromoCodeUsageMap});return r&&i&&!s?{isEligible:!0,eligibleContext:{subscribeAction:lb,term:G(G({},r.term),{},{offerType:lP}),promotionName:function(e){let{resource:t,billingCycle:n,currency:r,version:i}=ls(e.name),s=function({billingCycle:e,resource:t}){var n;let r,i;return!function({billingCycle:e,resource:t}){return"1m"===e&&"digital"===t}({billingCycle:e,resource:t})?(r=(n=t).toLowerCase().includes("plus"),i=n.toLowerCase().includes("daily")||n.toLowerCase().includes("weekend")||n.toLowerCase().includes("weekday"),r&&i)?"11.5":l({billingCycle:e,resource:t})?"70%off":"intro":"3mFor1mIntro"}({billingCycle:n,resource:t}),a=function({billingCycle:e,currency:t,resource:n}){return l({billingCycle:e,resource:n})?"":n.toLowerCase().includes("scmpplus")?"FY2425Q1"===i?"-2425q2":`-${null==i?void 0:i.toLowerCase().substring(2)}`:"USD-H"===t?"-2324q1":"1m"===e?"-2223q3":"1y"===e?"-2122q4":"2y"===e?"-2223q1":""}({billingCycle:n,currency:r,resource:t});return`PT-prechurn-${s}-${n}-${t}${"USD-H"===r?"-usdh":""}${a}-prechurn-${n}-${s}-discount`;function l({billingCycle:e,resource:t}){return"digital"===t&&("1y"===e||"2y"===e)}}(r.term)}}:{isEligible:!1}}}}function lU(e){return{isEligible(t){var n;let{subscriptions:r,shouldIncludeDowngradePlan:i,canUseChangeOptions:s}=t,a=lB({subscriptions:r,billingCycle:e});if(!i||!a)return{isEligible:!1};let{resource:l}=ls(null==(n=a.term)?void 0:n.name),o=null==l?void 0:l.toLowerCase().includes("scmpplus"),u=a.term.change_options,c=null==u?void 0:u.find(t=>{let{resource:n,billingCycle:r,variant:i}=ls(t.to_term_name);return"digital"===n&&r===e&&null==i});return o&&c&&(null==u?void 0:u.length)!==0&&s?{isEligible:!0,eligibleContext:{subscribeAction:lv,term:lM(c,{offerType:lP,payment_trial_new_customers_only:!0})}}:{isEligible:!1}}}}function lB(e){let{subscriptions:t,billingCycle:n}=e;return t.find(e=>{let{resource:t,billingCycle:r}=ls(e.term.name),i="digital"===t,s=null==t?void 0:t.toLowerCase().includes("scmpplus"),a=!1===e.auto_renew;return(i||s)&&a&&r===n})}let lj=["plansDefinition","searchPromotions","isNewPianoCustomer"];function lY(e){return lG.apply(this,arguments)}function lG(){return(lG=F(function*(e){let{plansDefinition:t,searchPromotions:n,isNewPianoCustomer:r}=e,i=W(e,lj);try{if(!t||!n||void 0===r)return[];let e=function(e,t){try{return Object.values(e).flatMap(e=>Object.values(e)).reduce((e,n)=>{let r=n.isEligible(t);return r.isEligible&&e.push(r.eligibleContext),e},[])}catch(e){return console.error(e),[]}}(t,i);if(!e)return[];let s=yield n({names:e.map(e=>e.promotionName).filter(e=>null!=e&&""!==e)});return e.map(e=>{let t=s.find(t=>e.promotionName&&t.name.includes(e.promotionName)),n=lw({action:e.subscribeAction,promotion:t,term:e.term,isNewPianoCustomer:r});return G(G({},e),{},{consolidatedBillingTable:n},t?{promotion:t}:{})})}catch(e){console.error(e)}})).apply(this,arguments)}function lW(e){e.addRule(new sc("user.isOverallChurned").when(({hasConversions:e,hasActiveConversions:t})=>!!e&&!t).then(!0).fallback(!1)),e.addRule(new sc("user.isActiveExternalSubscriber").when(({activeConversionTermTypes:e})=>{let t=new Set(e);return 1===t.size&&t.has("external")}).then(!0).fallback(!1)),e.addRule(new sc("user.isHyperActiveSubscriber").when(({activeSCMPConversions:e})=>{if(!(null!=e&&e.length))return!1;let t=e.map(e=>e.term.term_id);return t.length>1&&new Set(t).size<t.length}).then(!0).fallback(!1)),e.addRule(new sc("user.hasPendingTermChange").when(({latestActiveSubscription:e})=>!!e).then(({latestActiveSubscription:e})=>(null==e?void 0:e.status)==="completed").fallback(!1)),e.addRule(new sc("user.isAlipaySubscriber").when(({activeConversionTermNames:e})=>!!(null!=e&&e.find(e=>e.includes("AlipayHK")))).then(!0).fallback(!1)),e.addRule(new sc("user.isSCMPSubscriber").when(({hasActiveScmpConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isSCMPLiteSubscriber").when(({hasActiveScmpLiteConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isSCMPDigitalSubscriber").when(({hasActiveScmpDigitalConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isPaidSCMPSubscriber").when(({hasActivePaidSCMPConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isYPSubscriber").when(({hasActiveYpConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isPostiesSubscriber").when(({hasActivePostiesConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isSCMPPlusSubscriber").when(({hasActiveSCMPPlusConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.hasSCMPLiteAccessRight").stage(2).waitFor(st).when(({ipRangeAccess:e},{user:{isSCMPLiteSubscriber:t,isInternalStaff:n}={}})=>{var r;return null!=(r=t||n||(null==e?void 0:e.hasSCMPLiteAccess))&&r}).then(!0).fallback(!1)),e.addRule(new sc("user.hasSCMPDigitalAccessRight").stage(2).waitFor(st).when(({ipRangeAccess:e},{user:{isSCMPDigitalSubscriber:t,isInternalStaff:n}={}})=>{var r;return null!=(r=t||n||(null==e?void 0:e.hasSCMPDigitalAccess))&&r}).then(!0).fallback(!1)),e.addRule(new sc("user.hasSCMPPlusAccessRight").stage(2).waitFor(st).when(({ipRangeAccess:e},{user:{isSCMPPlusSubscriber:t,isInternalStaff:n}={}})=>{var r;return null!=(r=t||n||(null==e?void 0:e.hasSCMPPlusAccess))&&r}).then(!0).fallback(!1)),e.addRule(new sc("user.hasEpaperAccessRight").stage(2).waitFor(st).when(({ipRangeAccess:e,hasActiveEpaperConversions:t})=>{var n;return null!=(n=t||(null==e?void 0:e.hasSCMPEpaperAccess)||(null==e?void 0:e.hasYpEpaperAccess)||(null==e?void 0:e.hasYpSparkEpaperAccess)||(null==e?void 0:e.hasPostiesEpaperAccess))&&n}).then(!0).fallback(!1)),e.addRule(new sc("user.hasPostiesAccessRight").stage(2).waitFor(st).when(({hasActivePartnersConversions:e,ipRangeAccess:t},{user:{isPostiesSubscriber:n,isInternalStaff:r,isVipExclusive:i}={}})=>{var s;return null!=(s=n||r||i||e||(null==t?void 0:t.hasPostiesDigitalAccess))&&s}).then(!0).fallback(!1)),e.addRule(new sc("user.isCorpSubscriber").when(({hasActiveCorpConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isFreeSubscriber").when(({hasActiveFreeConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isSiteLicenseSubscriber").when(({hasActiveSiteLicenseConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isInternalStaff").when(({activeConversions:e,pianoResourceIds:t})=>!!e&&e.filter(e=>aI(["internal"],t).includes(e.term.resource.rid)).length>0).then(!0).fallback(!1)),e.addRule(new sc("user.isVipExclusive").when(({activeConversions:e,pianoResourceIds:t})=>!!e&&e.filter(e=>aI(["vip"],t).includes(e.term.resource.rid)).length>0).then(!0).fallback(!1)),e.addRule(new sc("user.isPrintBundle").when(({hasActiveConversions:e})=>!!e).then(({activeConversionTermNames:e,activeConversionResources:t})=>!!(null!=t&&t.includes("printBundle")||null!=t&&t.includes("SCMP")&&null!=e&&e.some(e=>e.startsWith("Annual: Digital +"))||null!=t&&t.includes("SCMP+ePaper")||null!=t&&t.includes("SCMP+Weekday+ePaper")||null!=t&&t.includes("SCMP+Daily+ePaper")||null!=t&&t.includes("SCMP+Weekend+ePaper"))).fallback(!1)),e.addRule(new sc("user.isAccessGrantedUser").when(({activeConversionTermTypes:e})=>{var t;return null!=(t=null==e?void 0:e.includes("grant_access"))&&t}).then(!0).fallback(!1)),e.addRule(new sc("user.isSCMPChurned").when(({hasSCMPB2CChurnedConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.isYPChurned").when(({hasIndividualYPConversions:e,hasActiveIndividualYPConversions:t})=>{var n;return null!=(n=e&&!t)&&n}).then(!0).fallback(!1)),e.addRule(new sc("user.clientName").stage(2).when((e,{user:{isCorpSubscriber:t,isSiteLicenseSubscriber:n}={}})=>{var r;return null!=(r=t||n)&&r}).then(({activeSiteLicenseTermName:e},{user:{isSiteLicenseSubscriber:t}={}})=>t?e:"unknown corporate client").fallback("")),e.addRule(new sc("user.isAutoRenewable").when(({activeConversionTermTypes:e})=>{var t;return null!=(t=null==e?void 0:e.includes("payment"))&&t}).then(!0).fallback(!1)),e.addRule(new sc("user.packages").when(({hasActivePublisherSubscriptionConversions:e})=>!!e).then(({activePublisherSubscriptionConversions:e})=>{var t;return null==(t=null==e?void 0:e.map(li).filter(Boolean))?[]:t}).fallback([])),e.addRule(new sc("user.isUpgradeable").when(({hasActivePublisherSubscriptionConversions:e})=>!!e).then(({activePublisherSubscriptionConversions:e})=>null==e?void 0:e.some(e=>{var t;return null==e||null==(t=e.subscription)||null==(t=t.term)||null==(t=t.change_options)?void 0:t.some(e=>{var t;return null==e||null==(t=e.to_term_name)?void 0:t.toLowerCase().includes("upgrade")})})).fallback(!1)),e.addRule(new sc("runtime.pianoUserInfo").when(({hasConversions:e})=>!!e).then(F(function*(){return yield sk()})).fallback(null)),e.addRule(new sc("runtime.pianoUserGracePeriodField").stage(2).when((e,{runtime:{pianoUserInfo:t}={}})=>!!(null!=t&&t.custom_fields)).then((e,{runtime:{pianoUserInfo:t}={}})=>{var n;return null==t||null==(n=t.custom_fields)?void 0:n.find(e=>"isGracePeriod"===e.fieldName)}).fallback(void 0)),e.addRule(new sc("runtime.pianoUserShowOnboardingField").stage(2).when((e,{runtime:{pianoUserInfo:t}={}})=>!!(null!=t&&t.custom_fields)).then((e,{runtime:{pianoUserInfo:t}={}})=>{var n;return null==t||null==(n=t.custom_fields)?void 0:n.find(e=>"showOnboarding"===e.fieldName)}).fallback(void 0)),e.addRule(new sc("runtime.pianoUserHasShownSwGLinkingFlowField").stage(2).when((e,{runtime:{pianoUserInfo:t}={}})=>!!(null!=t&&t.custom_fields)).then((e,{runtime:{pianoUserInfo:t}={}})=>{var n;return null==t||null==(n=t.custom_fields)?void 0:n.find(e=>"hasShownSwGLinkingFlow"===e.fieldName)}).fallback(void 0)),e.addRule(new sc("runtime.pianoUserHasShownSCMPPlusWelcomePopUpField").stage(2).when((e,{runtime:{pianoUserInfo:t}={}})=>!!(null!=t&&t.custom_fields)).then((e,{runtime:{pianoUserInfo:t}={}})=>{var n;return null==t||null==(n=t.custom_fields)?void 0:n.find(e=>"hasShownSCMPPlusWelcomePopUp"===e.fieldName)}).fallback(void 0)),e.addRule(new sc("user.gracePeriod").stage(3).when(({hasActivePublisherSubscriptionConversions:e},{runtime:{pianoUserGracePeriodField:t}={}})=>{let n=String(null==t?void 0:t.value).toLowerCase();return!!e&&!t&&"true"===n}).then(({hasActivePublisherSubscriptionConversions:e,activePublisherSubscriptionConversions:t},{runtime:{pianoUserGracePeriodField:n}={}})=>e&&n&&t?function(e,t){var n;if((null==e?void 0:e.value)!=="true")return null;let r=T(),i=t.reduce((e,t)=>{var n,r,i,s;if(!(null!=(n=t.subscription)&&n.next_bill_date))return e;if("payment subscription renewal with grace period"===t.type.toLowerCase()){let n=T.unix(null==(s=t.subscription)?void 0:s.next_bill_date);return null!=e&&e.expiryDate.isBefore(n)?e:{targetConversion:t,expiryDate:n}}let a=T.unix(null==(r=t.subscription)?void 0:r.next_bill_date),l=null==t||null==(i=t.subscription)||null==(i=i.term)?void 0:i.payment_renew_grace_period;if(!l)return e;let o=a.add(l,"day");return null!=e&&e.expiryDate.isBefore(o)?e:{targetConversion:t,expiryDate:o}},null);if(!i)return null;let s=T(e.created),a=null==i||null==(n=i.targetConversion)||null==(n=n.subscription)?void 0:n.term.payment_renew_grace_period;if(null==a)return null;let l=s.add(a,"day"),o=s.add(a/2,"day"),u=l.diff(r,"day"),c=a/2>=u;return{isActive:u>0,startDate:s.toDate(),daysLeft:u,expiryDate:l.toDate(),halfExpiryDate:o.toDate(),isWithinHalf:c,gracePeriodLength:a}}(n,t):lt).fallback(lt)),e.addRule(new sc("user.onboardingData").stage(3).when((e,{runtime:{pianoUserShowOnboardingField:t}={}})=>!!t).then((e,{runtime:{pianoUserShowOnboardingField:t}={}})=>({value:null==t?void 0:t.value,created:null==t?void 0:t.created})).fallback({value:null,created:null})),e.addRule(new sc("user.pianoCustomFields.hasShownSCMPPlusWelcomePopUp").stage(3).when((e,{runtime:{pianoUserHasShownSCMPPlusWelcomePopUpField:t}={}})=>!!t).then((e,{runtime:{pianoUserHasShownSCMPPlusWelcomePopUpField:{value:t}={}}={}})=>({value:"true"===String(t)})).fallback({value:!1})),e.addRule(new sc("user.autoRenewEnabled").when(({hasActiveScmpSubscription:e})=>!!e).then(({activeScmpSubscription:e})=>{var t;return null!=(t=(null==e?void 0:e.auto_renew)&&(null==e?void 0:e.term.type)==="payment")&&t}).fallback(!1)),e.addRule(new sc("user.overallAutoRenewEnabled").when(({hasActiveSubscriptions:e})=>!!e).then(({latestActiveSubscription:e})=>{var t;return null!=(t=(null==e?void 0:e.auto_renew)&&(null==e?void 0:e.term.type)==="payment")&&t}).fallback(!1)),e.addRule(new sc("user.autoRenewSubscriptionId").stage(2).when(({hasActiveScmpSubscription:e},{user:{autoRenewEnabled:t,isAutoRenewable:n}={}})=>{var r;return null!=(r=e&&n&&!t)&&r}).then(({activeScmpSubscription:e})=>{var t;return null==(t=null==e?void 0:e.subscription_id)?"":t}).fallback("")),e.addRule(new sc("user.overallAutoRenewSubscriptionId").stage(2).when(({hasActiveSubscriptions:e},{user:{overallAutoRenewEnabled:t,isAutoRenewable:n}={}})=>{var r;return null!=(r=e&&n&&!t)&&r}).then(({latestActiveSubscription:e})=>{var t;return null==(t=null==e?void 0:e.subscription_id)?"":t}).fallback("")),e.addRule(new sc("user.overallSubscriptionDaysLeft").when(({hasActiveSubscriptions:e})=>!!e).then(({latestActiveSubscription:e})=>{let t=null==e?void 0:e.next_bill_date;return t?Math.round((1e3*t-new Date().valueOf())/1e3/60/60/24):-1}).fallback(-1)),e.addRule(new sc("user.isActiveSubscriptionInFreeTrialPeriod").when(({hasActiveSubscriptions:e})=>!!e).then(({latestActivePublisherSubscriptionConversion:e})=>{var t,n;return(null==e||null==(t=e.subscription)?void 0:t.is_in_trial)===!0&&(null==e||null==(n=e.subscription)?void 0:n.trial_amount)===0}).fallback(!1)),e.addRule(new sc("user.expiryReminder").when(({hasActiveScmpSubscription:e})=>!!e).then(({activeScmpSubscription:e,appConfig:t})=>{if(!e||!t)return lg;let n=function(e){let{subscriptions:t}=e;return t.find(e=>{var t,n;let r=null==e||null==(t=e.term)?void 0:t.name,i=(null==e||null==(n=e.term)?void 0:n.type)==="external",{resource:s}=ey.decodeTermName(r);return((null==s?"":s).toLowerCase().includes("scmpplus")||!!(e=>{if(!(0,P.A)(e))return null;let t=e.toLowerCase();return[{name:"monthly: digital |",period:"1 month"},{name:"1-month: digital |",period:"1 month"},{name:"annual: digital |",period:"1 year"},{name:"1-year: digital |",period:"1 year"},{name:"2-year: digital |",period:"2 years"}].find(e=>t.includes(null==e?void 0:e.name))})(r))&&!i})}({subscriptions:[e]});return n?function(e){var t,n;let{subscription:r,appConfig:i}=e;if(null!=(t=null==r?void 0:r.auto_renew)&&t)return lg;let s=null==r?void 0:r.next_bill_date,a=(e=>{var t;let{resource:n}=ls(e),r=null!=(t=null==n?void 0:n.toLowerCase().includes("scmpplus"))&&t,i=(null==n?void 0:n.toLowerCase())==="digital";if(!r&&!i)return;let[s]=e.split(":"),a=s.toLowerCase().replace("-"," ");return a.startsWith("2")?`${a}s`:a})(null==r||null==(n=r.term)?void 0:n.name),l=ly({termPeriod:a,appConfig:i,type:"first-churn"}),o=ly({termPeriod:a,appConfig:i,type:"second-churn"}),u=Math.round((1e3*s-new Date().valueOf())/1e3/60/60/24),c=u>=0&&u<=l;return{expireDate:s,dayLeft:u,termPeriod:a,isFirstChurning:!c&&u<=o,isSecondChurning:c}}({subscription:n,appConfig:t}):lg}).fallback(lg)),e.addRule(new sc("user.tier").stage(2).when((e,{user:{isSiteLicenseSubscriber:t,isCorpSubscriber:n}={}})=>{var r;return null!=(r=t||n)&&r}).then(F(function*(){return yield sP()})).fallback("")),e.addRule(new sc("user.activeBillingPeriod").when(({hasIndividualPaymentSCMPConversions:e,hasActiveIndividualSCMPConversions:t,hasActivePublisherSubscriptionConversions:n})=>{var r;return null!=(r=e&&t&&n)&&r}).then(({latestActivePublisherSubscriptionConversion:e})=>{var t;return null==e||null==(t=e.subscription)||null==(t=t.term.payment_billing_plan_table)||null==(t=t[0])?void 0:t.billingPeriod}).fallback("")),e.addRule(new sc("user.myNewsOfferRedeemed").when(({hasConversions:e})=>!!e).then(({allConversionTermNames:e})=>null==e?void 0:e.includes("myNEWS 24 hours FREE unlimited access")).fallback(!1)),e.addRule(new sc("user.isPasswordless").waitFor(sn).when(({hasToken:e,userCookie:t})=>!!(e&&!t)).then(!0).fallback(!1)),e.addRule(new sc("user.isAuthenticated").waitFor(sn).when(({hasToken:e,userCookie:t})=>!!(e&&t)).then(!0).fallback(!1)),e.addRule(new sc("user.hasEverSubscribedToSCMP").when(({hasIndividualSCMPConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.hasEverSubscribedToYP").when(({hasIndividualYPConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.hasEverSubscribedToPosties").when(({hasIndividualPaymentPostiesConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.hasEverConvertedToSCMPPlus").when(({hasIndividualSCMPPlusConversions:e})=>!!e).then(!0).fallback(!1)),e.addRule(new sc("user.types").when(({userTypes:e})=>!!e).then(({userTypes:e})=>e).fallback({scmp:"NEW_USER",yp:"NEW_USER",posties:"NEW_USER"})),e.addRule(new sc("user.redeemedPromoCodes").when(({allPublisherConversions:e})=>!!e).then(({allPublisherConversions:e})=>null==e?void 0:e.reduce((e,t)=>{var n;let r=null==t||null==(n=t.promo_code)?void 0:n.code;return r&&e.push(r),e},[])).fallback([])),e.addRule(new sc("user.campaign2024JanSubscriberPreChurnOffer").stage(2).when(({activeSCMPPublisherConversions:e},{user:{autoRenewEnabled:t}={}})=>!!(e&&!t)).then(({activeSCMPPublisherConversions:e},{user:{redeemedPromoCodes:t,overallSubscriptionDaysLeft:n,isNewPianoCustomer:r=!0}={}})=>{var i,s;let a,l,o=null==e?void 0:e.find(e=>"Subscription"===e.type),u=null==o||null==(i=o.subscription)?void 0:i.term;if(!u)return{isEligible:!1};let c="renew2024JanPromoCodeSubs2425q3",d=u.name,p=u.payment_currency;if(!d||n&&n>90)return{isEligible:!1};let{billingCycle:m,currency:f,resource:g}=ey.decodeTermName(d);return(a=null==t?void 0:t.includes(c),l=(null==(s=o.promo_code)?void 0:s.code)==="2024jan",!a&&l&&"1y"===m&&"HKD"!==p&&"digital"===g)?{isEligible:!0,plans:[(()=>{var e,t,n,r,i;let[s]=null==(e=null==(t=u.change_options)?void 0:t.filter(e=>{let{billingCycle:t,resource:n,variant:r}=ey.decodeTermName(e.to_term_name);return"2y"===t&&"digital"===n&&"Upgrade(Intro)"===r}))?[]:e,a=lp(s.to_billing_plan);return null!=a&&null!=(n=a.rack)&&n.price?{currency:p,rackPrice:a.rack.price,intoPrice:null==a||null==(r=a.trial)?void 0:r.price,chargePrice:(null==a||null==(i=a.trial)?void 0:i.price)||a.rack.price,resource:"digital",subscribeAction:lh,billingCycle:"2y"}:null})(),(()=>{var e;let t=null==(e=lw({action:lb,term:u,isNewPianoCustomer:r}))?void 0:e.pop();if(!t)return null;let n={USD:36,"USD-H":18,MYR:108,SGD:51}[null==f?"":f];return n?{currency:p,rackPrice:t.price,chargePrice:n,resource:"digital",billingCycle:"1y",subscribeAction:lb,hiddenPromoCode:c,promotionName:`PT-2024jan-promo-code-subs-annual-renewal-70%-off${"USD-H"===f?"-"+f:""}`}:null})()].filter(Boolean)}:{isEligible:!1}}).fallback({isEligible:!1})),e.addRule(new sc("user.isLikelyToSubscribe").waitFor(st).when(({ltsBucket:e})=>void 0!==e).then(({ltsBucket:e})=>null!=e&&e).fallback(!1)),e.addRule(new sc("user.promoCodeUsage").when(({allPublisherConversions:e})=>!!(null!=e&&e.length)).then(({allPublisherConversions:e})=>e?{preChurn:G({},lI(e))}:{}).fallback({})),e.addRule(new sc("user.isNewPianoCustomer").when(({hasConversions:e,allConversionTermTypes:t})=>!!(e&&t)).then(({allConversionTermTypes:e})=>{let t=new Set(["payment"]);return!1===Array.from(new Set(null==e?[]:e)).some(e=>t.has(e))}).fallback(!0)),e.addRule(new sc("user.hasScmpUpgradeOptions").when(({hasScmpChangeOptionsAvailable:e})=>void 0!==e).then(({hasScmpChangeOptionsAvailable:e})=>e).fallback(!1)),e.addRule(new sc("user.hasScmpPlusUpgradeOptions").when(({latestActivePublisherSubscriptionConversion:e})=>null!=e).then(({latestActivePublisherSubscriptionConversion:e})=>{var t,n;return null!=(t=null==e||null==(n=e.subscription)||null==(n=n.term)||null==(n=n.change_options)?void 0:n.some(e=>{let{resource:t,variant:n}=ey.decodeTermName(e.to_term_name),r=!!t&&new Set([...ee,...Q]).has(t),i=!!n&&new Set(["Upgrade(Intro)"]).has(n);return r&&i}))&&t}).fallback(!1)),e.addRule(new sc("user.winback").when(({winback:e})=>!!e).then(({winback:e})=>e).fallback(void 0))}function lH(e){e.addRule(new sc("tracking.registrationPlatform").waitFor(sn).stage(8).when(()=>!0).then(({userCookie:e},{user:{isPasswordless:t}={}})=>{var n;if(t)return"passwordless";let r=null==e?void 0:e.source;return r?r.includes("nl:")?r.includes("facebook")?"NL-Facebook":r.includes("google")?"NL-Google":"NL-Email":r.includes("facebook")?"Facebook":r.includes("apple")?"Apple":r.includes("google:yolo")?"Google one-tap":r.includes("google:gsuite")||r.includes("google")?"Google":r.includes("email")?"Email":null==(n=({"piano:swg":"Email"})[r])?"":n:""})),e.addRule(new sc("tracking.subscriberStatus").waitFor(sn).stage(8).when(({hasToken:e})=>!!e).then(({hasConversions:e,hasActiveConversions:t,activeConversionTermTypes:n,activeConversionTypes:r,allConversionTermTypes:i,activeConversionResources:s})=>t?null!=n&&n.some(e=>["payment","custom","external"].includes(e))||null!=s&&s.some(e=>["vip","partners","printBundle"].includes(e))||null!=r&&r.includes("licensee contract redemption")?"active":null!=s&&s.includes("internal")?"staff":"none":e&&null!=i&&i.some(e=>["payment","custom","external"].includes(e))?"churn":"none").fallback("none")),e.addRule(new sc("tracking.ga4.userRole").waitFor(sn).stage(9).when(({hasToken:e})=>!!e).then((e,{tracking:{subscriberStatus:t}={}})=>{var n;return null==(n=({active:"subscriber",churn:"churn",none:"authenticated user",staff:"staff"})[null==t?"":t])?"anonymous user":n}).fallback("anonymous user")),e.addRule(new sc("tracking.ga4.subscriberPhase").stage(9).when(({hasToken:e})=>!!e).then((e,{user:{activeBillingPeriod:t,gracePeriod:n,expiryReminder:{isFirstChurning:r,isSecondChurning:i,expireDate:s}={},winback:a}={}})=>null!=n&&n.isActive?n.isWithinHalf?sr.FIRSTGRACE:sr.SECONDGRACE:null!=a&&a.latestExpiredScmpB2CConversion?sr.WINBACK:t?r?sr.FIRSTCHURNING:i?sr.SECONDCHURNING:null!=s&&s>0?sr.PRECHURNING:sr.DEFAULT:sr.NONSUBSCRIBER).fallback(sr.NONSUBSCRIBER)),e.addRule(new sc("tracking.userRole").waitFor(sn).stage(10).when(({hasToken:e})=>!!e).then((e,{tracking:{registrationPlatform:t,ga4:{userRole:n}={}}={}})=>{var r;return`${null==(r=({subscriber:"Subscriber",churn:"Churn","authenticated user":"authenticated user - Register",staff:"staff - Register"})[null==n?"":n])?"anonymous user":r} (${t&&""!==t?t:"Email"})`}).fallback("anonymous user")),e.addRule(new sc("tracking.ga4.siteLicenseContractIds").waitFor(sn).stage(8).when((e,{user:{isSiteLicenseSubscriber:t}={}})=>!!t).then(({activeSiteLicenseTermIds:e})=>null==e?null:e).fallback(null)),e.addRule(new sc("tracking.ga4.ipRangeContractIds").waitFor(st).stage(8).when(()=>!0).then(({ipRangeContractIds:e})=>null!=e&&e.length?e:null).fallback(null)),e.addRule(new sc("tracking.ga4.ipAccess").waitFor(st).stage(8).when(()=>!0).then(()=>{var e,t;let n=null==(e=K.loadedInstance)||null==(e=e.customVariables)?void 0:e.ip_access_client_id;return n?{id:n,type:(null==(t=K.loadedInstance)||null==(t=t.customVariables)?void 0:t.ip_ezproxy_user)===!0?"ezproxy":"whitelisting"}:null}).fallback(null)),e.addRule(new sc("tracking.ga4.baseParameters").waitFor([sn,st]).stage(12).when(()=>!0).then((e,t)=>{var n,r,i,s;let{appConfig:a,piano:l,activeConversions:o,allPublisherConversions:u}=e,{user:c,tracking:{ga4:{subscriberPhase:d}={}}={}}=t,p=(null==o?void 0:o.map(e=>e.term.term_id).filter(Boolean).join(","))||null,m="boolean"==typeof(null==c?void 0:c.autoRenewEnabled)?c.autoRenewEnabled?"auto renew on":"auto renew off":null,f=null==c?void 0:c.overallSubscriptionDaysLeft,g=(null==a?void 0:a.campaignConfigs)&&(null==c||null==(n=c.types)?void 0:n.scmp)&&iq({configurations:a.campaignConfigs,context:{app:{env:null==(r=null==(i=sl.getConfig())?void 0:i.env)?"development":r},user:{currency:null==l?void 0:l.currency,type:null==c||null==(s=c.types)?void 0:s.scmp,conversions:u}}});return G(G(G(G(G({},g&&{internal_campaign:g.name}),m&&{auto_renew:m}),f&&f>=0&&{no_of_days_left_expiry:f}),d&&{subscriber_phase:d}),p&&{user_term_ids:p})}).fallback({}))}var lV=(0,a.t)({getABTestVariantsPianoCustomVariable:()=>lz,setABTestVariablePianoCustomVariable:()=>lK});let lq="abTestVariants";function lK(e){var t;let{experimentId:n,testName:r,variant:i}=e;null==(t=K.instance)||t.push(["setCustomVariable",`${lq}.${r}`,{experimentId:n,variant:i}])}function lz(e){let{customVariables:t={}}=e;return Object.entries(t).reduce((e,[t,n])=>{if(!t.startsWith(`${lq}.`))return e;let r=t.replace(`${lq}.`,"");return G(G({},e),{},{[r]:n})},{})}let lJ=O.extend("utils/serverRules");function lX(e){return lZ.apply(this,arguments)}function lZ(){return(lZ=F(function*(e){var t;let{piano:n,contentService:r}=e;n&&r||lJ("piano, contentService config are required");let i=new sd;return yield aA(i,e),yield a7(i),yield i.run(),null!=(t=e.piano)&&t.token&&(yield a4(i,e),yield lW(i),yield lH(i),yield i.run()),{facts:i.getAllFacts(),outcome:i.getAllOutcome()}})).apply(this,arguments)}function lQ(e){return l0.apply(this,arguments)}function l0(){return(l0=F(function*(e){let t=new sd;return yield aA(t,e),yield void(t.addRule(new sc("user.isNewPianoCustomer").when(()=>!0).then(!0).fallback(!0)),t.addRule(new sc("user.types").when(()=>!0).then(()=>({scmp:"NEW_USER",yp:"NEW_USER",posties:"NEW_USER"}))),t.addRule(new sc("tracking.ga4").when(()=>!0).then(()=>({})))),yield t.run(),{facts:t.getAllFacts(),outcome:t.getAllOutcome()}})).apply(this,arguments)}let l1=O.extend("helpers/swg");function l2(){return(l2=F(function*(e){var t,n,r,i;let s=l1.extend("linking-flow"),a=null==(t=e.rulesEngine.getOutcome("runtime.pianoUserHasShownSwGLinkingFlowField.value"))?"false":t;if("true"===a)return void s("Skip for user that already be shown");let l=e.rulesEngine.getOutcome("user.isSCMPSubscriber");if(!l)return void s("Skip for user that not subscribed");let o=(null==(n=null==(r=e.rulesEngine.getFact("userCookie"))?void 0:r.scs)?[]:n).includes("google");if(!o)return void s("Skip for user without Google login");let u=e.rulesEngine.getOutcome("ui.popup.showSubscriberOnboarding");u?s("Skip for user will see the onboarding flow"):(window.SWG=window.SWG||[],s("Passed the condition check. Push task into SwG task queue",{isSubscribed:l,shouldShowSubscriberOnboarding:u,hasGoogleLogin:o,hasShownSwGLinkingFlow:a}),window.SWG.push((i=F(function*(e){try{let{entitlements:t,rn:n}=yield e.getEntitlements();if(t.some(e=>e.products.includes(n)))return void s("Skip for user that already linked with SwG")}catch(e){s("Failed getting SwG entitlements",{error:e});return}let t=new MutationObserver(e=>{for(let t of e)if("attributes"===t.type&&t.target===document.documentElement&&"style"===t.attributeName){if(!(t.target instanceof HTMLElement))continue;let e=t.target.style;if(e&&!e["padding-bottom"])return;s("Prevent SwG linking dialog modification on the root html style"),t.target.style.removeProperty("padding-bottom")}});t.observe(document.documentElement,{attributes:!0});try{s("Starting SwG linking flow"),yield e.saveSubscription(()=>{var e;return{token:null==(e=K.loadedInstance)?void 0:e.user.getProvider().getToken()}}),yield sE("true")}catch(e){s("Failed SwG linking flow with error",{error:e})}finally{s("Finished SwG linking flow"),t.disconnect()}}),function(e){return i.apply(this,arguments)})))})).apply(this,arguments)}(0,a.t)({internalChannelName:()=>l6,registerListener:()=>l8,removeListener:()=>l5,sendMessage:()=>l4});let l3=O.extend("utils/channel");function l4(e,t){if(!or())return void l3("sendMessage::window is undefined");let n=null==t?void 0:t.message;if(!n)return void l3("sendMessage::data.message is empty: %o",t);if((null==t?void 0:t.type)==="message"){let r=null==t?void 0:t.source;if(!r)return void l3("sendMessage::source can not be empty for postMessage event type: %o",t);l3("sendMessage::using postMessage to send %o",G({channel:e},n)),r.postMessage(G(G({},n),{},{channel:e}),{targetOrigin:"*"})}else l3("sendMessage::using custom event channel %s to send message %o",e,n),window.dispatchEvent(new CustomEvent(e,{detail:n}))}function l8(e){var t,n;l3("registerListener::channel: %s",e),t=e,or()?(l9||(l3("addMessageListener::added postMessage listener"),window.addEventListener("message",ot,!1),l9=!0),l3("addMessageListener::listening to channel %s",t),l7.add(t)):l3("addMessageListener::window is undefined"),n=e,or()?(l3("addCustomEventListener::listening to channel: %s",n),window.addEventListener(n,ot,!1)):l3("addCustomEventListener::window is undefined")}function l5(e){l3("removeListener::channel: %s",e),l7.delete(e),window.removeEventListener(e,ot,oe)}let l6="COMM_CHANNEL",l9=!1,l7=new Set,oe=!1;function ot(e){if(e instanceof MessageEvent){var t;let n=null==(t=e.data)?void 0:t.channel;n&&l7.has(n)&&(l3("messageHandler::received postMessage from %s: %o",n,e),ud.emit(l6,on(e)))}else l3("messageHandler::received custom event %o",e),ud.emit(l6,on(e))}function on(e){let t=e instanceof MessageEvent?{type:"message",source:null==e?void 0:e.source,message:null==e?void 0:e.data}:{type:"custom",message:null==e?void 0:e.detail};return l3("messageBuilder::output: %o",t),t}function or(){return"u">typeof window}let oi=O.extend("utils/waiter"),os=new class{constructor(){j(this,"_waitingList",void 0),this._waitingList={}}subscribe(e,t,n,r=!1){(0,l.A)(e)||(0,l.A)(t)?oi("subscribe()::name and channel are required"):(0,l.A)(this._waitingList[e])?oi("subscribe()::no such waiter name: %s",e):(this._waitingList[e].subscribers.push({channel:t,source:n,sent:!1,monitor:r}),oi("subscribe()::new [%s] subscriber with source [%o] added for channel [%s]",e,n,t),this.notify(e))}setStatus(e,t){(0,l.A)(e)||(0,l.A)(t)?oi("setStatus()::name and status are required"):(0,l.A)(this._waitingList[e])?oi("setStatus()::no such waiter name: %s",e):this._waitingList[e].status=t}setData(e,t){(0,l.A)(e)||(0,l.A)(t)?oi("setData()::name and data are required"):(0,l.A)(this._waitingList[e])?oi("setData()::no such waiter name: %s",e):this._waitingList[e].data=t}setError(e,t){(0,l.A)(e)||(0,l.A)(t)?oi("setError()::name and reason are required"):(0,l.A)(this._waitingList[e])?oi("setError()::no such waiter name: %s",e):(this._waitingList[e].status=oa.ERROR,this._waitingList[e].data=null,this._waitingList[e].reason=t)}buildResponse(e,t,n){if((0,l.A)(e)||(0,l.A)(this._waitingList[e]))return void oi("buildResponse()::no such waiter name: %s",e);if((0,l.A)(t))return void oi("buildResponse()::channel is required.");let{data:r}=this._waitingList[e];return(0,l.A)(r)?void oi("buildResponse()::waiter %s got no data",e):{type:n?"message":"custom",source:n,message:{channel:t,requestType:e,responseData:r}}}buildErrorResponse(e,t,n){if((0,l.A)(e)||(0,l.A)(this._waitingList[e]))return void oi("buildErrorResponse()::no such waiter name: %s",e);if((0,l.A)(t))return void oi("buildErrorResponse()::channel is required.");let{reason:r}=this._waitingList[e];return(0,l.A)(r)?void oi("buildErrorResponse()::waiter [%s] got no error message",e):{type:n?"message":"custom",source:n,message:{channel:t,requestType:e,responseData:null,error:!0,errorMessage:r}}}register(e){if((0,l.A)(this._waitingList[e])){if((0,l.A)(e))return void oi("register()::waiter name is required");this._waitingList[e]={status:oa.WAITING,subscribers:[],data:null},oi("register()::registered new waiter %s",e)}else oi("register()::waiter %s already registered, do you mean subscribe?")}notify(e){var t,n;if((0,l.A)(e)||(0,l.A)(this._waitingList[e]))return void oi("notify()::no such waiter name: %s",e);let{status:r,data:i,reason:s}=this._waitingList[e];if(r===oa.READY){if((0,l.A)(i))return void oi("notify()::data is empty");null==(t=this._waitingList[e])||null==(t=t.subscribers)||t.forEach(t=>{let{channel:n,source:r,sent:i,monitor:s}=t;if(!i){let i=this.buildResponse(e,n,r);(0,l.A)(i)?oi("notify()::could not build response message"):(ud.sendMessage(n,i),oi("notify()::notified channel %s for waiter %s, with data: %o",n,e,i),!0!==s&&(t.sent=!0))}})}else if(r===oa.ERROR){if((0,l.A)(s))return void oi("notify()::reason is empty");null==(n=this._waitingList[e])||null==(n=n.subscribers)||n.forEach(t=>{let{channel:n,source:r,sent:i}=t;if(!i){let i=this.buildErrorResponse(e,n,r);(0,l.A)(i)?oi("notify()::could not build error response message"):(ud.sendMessage(n,i),oi("notify()::notified channel %s for waiter %s, with error: %o",n,e,i),t.sent=!0,t.monitor=!1)}})}else oi("notify()::waiter [%s] status is [%s], will not notify",e,r)}update(e,t){(0,l.A)(e)||(0,l.A)(this._waitingList[e])?oi("update()::no such waiter name: %s",e):(0,l.A)(t)?oi("update()::data is empty"):(this.setStatus(e,oa.READY),this.setData(e,t),oi("update()::updated waiter %s, data: %o",e,t),this.notify(e))}cancel(e,t){(0,l.A)(e)||(0,l.A)(this._waitingList[e])?oi("cancel()::no such waiter name: %s",e):(this.setError(e,t),oi("cancel()::waiter %s cancelled, reason: %s",e,t),this.notify(e))}};Object.freeze(os);let oa={WAITING:"waiting",READY:"ready",ERROR:"error"};(0,a.t)({dispatchCheckoutSDKEvent:()=>od,dispatchCheckoutTemplateEvent:()=>op,listenToSDKEvents:()=>ou,listenToTemplateEvents:()=>oc});let ol="checkout/sdk",oo="checkout/template";function ou(e){return typeof window>"u"?()=>{}:(window.addEventListener(ol,e),()=>{window.removeEventListener(ol,e)})}function oc(e){return typeof window>"u"?()=>{}:(window.addEventListener(oo,e),()=>{window.removeEventListener(oo,e)})}function od(e){if(!(typeof window>"u"))return window.dispatchEvent(new CustomEvent(ol,{detail:e}))}function op(e){if(!(typeof window>"u"))return window.dispatchEvent(new CustomEvent(oo,{detail:e}))}function om(e){window.dataLayer=window.dataLayer||[],window.dataLayer.push({subscribe:e})}function of(e,t){var n;n=function(e=[]){return e.reduce((e,t)=>{let n=Object.assign({},e.customized_parameters,t.customized_parameters);return G(G(G({},e),t),{},{customized_parameters:n})},{})}([{event:"GA4_tracking",category:"subs",customized_parameters:G(G({},t.rulesEngine.getOutcome("tracking.ga4.baseParameters")),{},{trigger_point:"paywall"})},e]),window.dataLayer=window.dataLayer||[],window.dataLayer.push(n)}function og(e){let{sdk:t,callToAction:n,billingCountryName:r,paymentTaxRate:i,paymentMethod:s,termId:a}=e;of({subcategory:"shopping_cart",action:"click",customized_parameters:G({payment_method:s,term_offer_selected:a,payment_tax_rate:i,payment_country:r},n&&{call_to_action:n})},t)}function oy(){typeof document>"u"||(document.body.style.overflow="hidden")}function oh(){typeof document>"u"||(document.body.style.overflow="")}(0,a.t)({fetchAndCacheForbiddenCodePromotions:()=>ow,service:()=>ov});let ob=O.extend("modules/checkout/promotionUserTargeting/forbiddenPromotions"),ov={computeByApplication:e=>{let t=oP(e.rawPromotions),n=e.userTypes,r={winback:[...t.newSubs,...t.renew],newUser:[...t.winback,...t.renew],default:[...t.winback,...t.newSubs]};return"scmp"===e.targetApplication?(null==n?void 0:n.scmp)==="NEW_USER"?r.newUser:(null==n?void 0:n.scmp)==="DEFAULT"||(null==n?void 0:n.scmp)==="PRE_CHURN"?[...r.default,...t.newSCMP]:[...r.winback,...t.newSCMP]:[]},computeByUsedCodesFromCurrentUser(e){var t,n,r;let i,s=null==(t=null==(n=oP(e.rawPromotions))?void 0:n.oneTime)?[]:t,a=(i=null==(r=e.allPublisherConversions)?[]:r)?i.reduce((e,t)=>{var n,r;let i=null==(n=null==t||null==(r=t.promo_code)?void 0:r.code)?null:n;return null===i?e:[...e,i]},[]):[],l=Array.from(s).map(e=>e.code);return ob("usedPromoCodesByUser",a),a?a.filter(e=>l.includes(e)).map(e=>({type:"oneTime",code:e})):[]}};function oP(e=[]){let t=[{tag:"new-subs-only",type:"newSubs"},{tag:"renew-only",type:"renew"},{tag:"churned-only",type:"winback"},{tag:"new-scmp-only",type:"newSCMP"},{tag:"one-time-only",type:"oneTime"}];return e.reduce((e,n)=>{var r,i;let s=null==(r=null==n?void 0:n.fixed_promotion_code)?"":r;if(!s)return e;let a=null==(i=t.find(e=>n.name.toLowerCase().includes(e.tag)))?void 0:i.type;return a&&e[a].add({code:s,type:a}),e},{newSCMP:new Set,newSubs:new Set,oneTime:new Set,renew:new Set,winback:new Set})}let oS="forbiddenPromotion";function ow(){return oC.apply(this,arguments)}function oC(){return(oC=F(function*(){let e=oA.get();if(e)return ob("Using cached forbidden promotions"),e;let{promotions:t=[]}=yield sl.fetchPromotionList("-only");return oA.set(t),t})).apply(this,arguments)}let oA={get(){if(typeof window>"u")return null;try{let e=localStorage.getItem(oS);if(!e)return null;let{forbiddenPromotions:t=[],expiry:n=""}=JSON.parse(e);return new Date(n)<new Date||0===t.length?(localStorage.removeItem(oS),null):t}catch(e){return ob("Error fetching forbidden promotion cache:",e.message),null}},set(e){let t=new Date;t.setHours(t.getHours()+1);let n=JSON.stringify({forbiddenPromotions:e,expiry:t});localStorage.setItem(oS,n)}},ok=O.extend("modules/checkout/promotionUserTargeting");function oT(){return(oT=F(function*(e,t){var n,r,i,s;if(typeof window>"u"||!e)return ok("window/sdk is not defined"),[];let a=yield ow();if(!a)return ok("allPromotions is empty"),[];let{rulesEngine:l}=e,o=null==l?void 0:l.getFact("userTypes"),u={allPublisherConversions:null==(n=null==e||null==(r=e.rulesEngine)||null==(i=r.getFact)?void 0:i.call(r,"allPublisherConversions"))?[]:n,targetApplication:t,rawPromotions:a,userTypes:o},c=[...ov.computeByApplication(u),...ov.computeByUsedCodesFromCurrentUser(u)].filter((e,t,n)=>t===n.findIndex(t=>t.code===e.code));null==(s=K.instance)||s.push(["setCustomVariable","forbiddenPromoCodes",c])})).apply(this,arguments)}function oE(e){let{scmpUrl:t,application:n}=e;return({scmp:`${t}`,yp:`${t}/yp`,posties:`${t}/posties`})[n]||""}let oR=O.extend("modules/checkout/passwordless");function oI(){let e=w.A.get("scmp_pat");return!!e&&!!(0,k.default)(e).tmp}let oM=O.extend("modules/checkout");function oO(){return(oO=F(function*(e){let{sdk:t,term:n,offerId:r,paymentMethod:i,trackingId:s,config:a,wallType:l}=e;if(oM("pianoCheckout rosettaSDK",{sdk:t,term:n,offerId:r,trackingId:s,config:a,wallType:l}),!t||!n||!r||!s||!a||!l)return void oM("error: missing required parameters");try{var o,u,c,d;let e=null==(o=null==(u=n.hiddenPromoCode)?null==(c=n.promotion)?void 0:c.fixed_promotion_code:u)?void 0:o;if(!(null!=(d=K.loadedInstance)&&null!=(d=d.user)&&d.isUserValid())){oD.save({term:n,offerId:r,paymentMethod:i,trackingId:s,hiddenPromoCode:e}),od({eventType:"popup/show-authentication",data:{checkoutTerm:n,destination:window.location.href,config:a,wallType:l}});return}yield function(e,t){return oT.apply(this,arguments)}(t,lm({decodedTerm:ey.decodeTermName(n.name)})),oy(),ox({offerId:r,paymentMethod:i,term:n,trackingId:s,hiddenPromoCode:e},t)}catch(e){oM("error: failed to init piano checkout",e.message),od({eventType:"popup/show-error",data:null})}})).apply(this,arguments)}var oD=class e{static save(t){sessionStorage.setItem(e.storageKey,JSON.stringify(t))}static resumeIfSessionExists(t){var n;let{sdk:r,setPaymentMethod:i}=t,s=sessionStorage.getItem(e.storageKey);if(!s)return;let a=JSON.parse(s);if(!a||!(null!=(n=K.loadedInstance)&&n.user.isUserValid()))return;let{paymentMethod:l}=a;i(l),sessionStorage.removeItem(e.storageKey),setTimeout(()=>{try{oM("resuming session",a),ox(a,r)}catch(e){oM("error: failed to resume session",e.message)}},0)}};function ox(e,t){let{term:n,offerId:r,paymentMethod:i,trackingId:s,hiddenPromoCode:a}=e;if(function(e,t){var n,r,i,s,a,l,o,u,c;let d=null==(n=t.rulesEngine.getFact("activeConversions"))?[]:n,{isAlipaySubscriber:p=!1,isActiveExternalSubscriber:m=!1,isSiteLicenseSubscriber:f=!1,isSCMPSubscriber:g=!1}=t.rulesEngine.getOutcome("user")||{},y=!!d.find(e=>e.term.type.includes("external")),{isBlockedByUserStatus:h,isSubscribeRepeatedResource:b,conversionsCoveredTermResources:v}=function(e){let t,{checkoutTerm:n,subscribeAction:r,activeConversions:i,userContext:s}=e,a=function(e){if(!e)return!1;let{isExternalSubscriber:t,isAlipaySubscriber:n,isActiveExternalSubscriber:r,isSiteLicenseSubscriber:i,isSCMPSubscriber:s}=e;return t||n||r||i&&s}(s),{isSubscribeRepeatedResource:l,conversionsCoveredTermResources:o}=(t=function(e,t){if(!(null!=e&&e.length)||!(null!=t&&t.name))return[];let n=eb(ey.decodeTermName(t.name).resource);if(!n||!n.length)return[];let r=e.filter(e=>{var t,r,i,s;if(!(null!=e&&null!=(t=e.term)&&t.name))return!1;let a=(null==e||null==(r=e.term)?void 0:r.type)==="grant_access"?ef(null==e||null==(i=e.term)||null==(i=i.resource)?void 0:i.name):ey.decodeTermName(null==e||null==(s=e.term)?void 0:s.name).resource;if(!a)return!1;let l=eb(a);if(!l||!l.length)return!1;let o=new Set(l);return n.every(e=>null==o?void 0:o.has(e))});return r.length?r.sort((e,t)=>{let n=Number(e.create_date)||0;return(Number(t.create_date)||0)-n}):[]}(i,n),{isSubscribeRepeatedResource:"UPGRADE"!==r&&"RENEW"!==r&&t.length>0,conversionsCoveredTermResources:t});return{isBlockedByUserStatus:a,isSubscribeRepeatedResource:l,conversionsCoveredTermResources:o}}({checkoutTerm:e,subscribeAction:e.subscribeAction,activeConversions:d,userContext:{isExternalSubscriber:!!g&&y,isAlipaySubscriber:p,isActiveExternalSubscriber:m,isSiteLicenseSubscriber:f,isSCMPSubscriber:g}});if(h){let t=d[0];return od({eventType:"popup/show-already-have-access",data:{accessItemName:lr(null==(r=e.resource)?void 0:r.name),isCloseable:!0,userAccessStartDateUnixTimestamp:null==(i=null==t||null==(s=t.user_access)?void 0:s.start_date)?0:i,btnText:"RESUME READING"}}),!0}if(b){let e=null==v?void 0:v[0];return od({eventType:"popup/show-already-have-access",data:{accessItemName:(null==e||null==(a=e.term)?void 0:a.type)==="grant_access"?lr(null==e||null==(l=e.term)||null==(l=l.resource)?void 0:l.name):`${ln(null==e||null==(o=e.term)?void 0:o.name)} Subscription`,isCloseable:!0,userAccessStartDateUnixTimestamp:null==(u=null==e||null==(c=e.user_access)?void 0:c.start_date)?0:u,btnText:"RESUME READING"}}),!0}return!1}(n,t))return null;let l=K.loadedInstance;null==l||l.setCustomVariable("paymentMethod",i),null==l||l.setCustomVariable("hiddenPromoCode",a),null==l||l.setCustomVariable("checkoutTerm",{subscribeAction:"SUBSCRIBE"}),null==l||l.offer.startCheckout({termId:n.termId,offerId:r,showCloseButton:!0,trackingId:s,promoCode:a}),oy(),setTimeout(()=>{let e=window.document.getElementsByClassName("tp-modal").item(0),t=window.document.getElementsByClassName("tp-iframe-wrapper").item(0);if(!e||!(e instanceof HTMLElement))return;e.classList.add("checkout"),null==t||t.classList.add("checkout");let n=e=>{"block"===e.style.display&&(e.style.display="flex")};n(e),new MutationObserver(e=>{for(let t of e)"attributes"===t.type&&"style"===t.attributeName&&t.target instanceof HTMLElement&&n(t.target)}).observe(e,{attributes:!0})},500),om({currency:n.currency,plan:n.name,price:n.chargePrice}),function(e){var t;let{sdk:n,termName:r,paymentMethod:i,termId:s,promoCode:a}=e;of({subcategory:"shopping_cart",action:"imp",customized_parameters:{payment_method:i,call_to_action:"subscribe",term_offer_selected:s,lts_bucket:null==n||null==(t=n.rulesEngine)?void 0:t.getFact("ltsBucket"),product_type:lf({term:{name:r}}),promo_code:a}},n)}({sdk:t,termName:n.name,paymentMethod:i,termId:n.termId,promoCode:a})}j(oD,"storageKey","subscription_checkout_session");let o$=O.extend("checkout/paywallSetup"),oL=D("modules/localStorageCache");function o_(e){let t=localStorage.getItem(oN);if(!t)return null;try{return JSON.parse(t)}catch(e){}return JSON.parse(function(e){let{encryptedData:t,encryptionKey:n}=e;return E.AES.decrypt(t,n).toString(E.enc.Utf8)}({encryptedData:t,encryptionKey:e}))}let oN="__rosetta_sdk";var oF=(0,a.t)({LTS_AB_TEST_NAME:()=>oB,buildLTSVariant:()=>oV,checkIsLtsActive:()=>oW,getLtsBucket:()=>oY,getLtsBucketFromLocalStorage:()=>oG,getLtsTerms:()=>oH,setupPianoLtsEventListeners:()=>oj});let oU="ltsBucket",oB="lts";function oj(e){let{sdk:t}=e,n=e=>{var n;let r=parseInt(function(){if(!(typeof window>"u"))return new URL(window.location.href).searchParams.get(oU)}()||function(e){var n,r;let i=null==e||null==(n=e.result.events[0].eventExecutionContext.userSegments)||null==(n=n.COMPOSER1X)||null==(n=n.segments)?void 0:n.find(e=>{var t;return(null==(t=e.split(":"))?void 0:t[0])==="LTs"});if(!i){null==(r=K.instance)||r.push(["setCustomVariable",oU,void 0]),t.rulesEngine.addFact(oU,void 0);return}let[,,s]=i.split(":");return s}(e),10),i=isNaN(r)?null:r;null==(n=K.instance)||n.push(["setCustomVariable",oU,i]),t.rulesEngine.addFact(oU,i)};return t.prependListener("experienceExecute",n),{cleanup:()=>{t.off("experienceExecute",n)}}}function oY(e){let{customVariables:t={}}=e,n=null==t?void 0:t[oU];if(!n)return;let r=Number(n);return Number.isNaN(r)?void 0:r}function oG(e){return oY({customVariables:function(e){try{var t,n;let r=o_(e);return null==(t=null==r||null==(n=r.tp)?void 0:n.customVariables)?{}:t}catch(e){return oL.error("Failed to load tp custom variable from localStorage:",e),{}}}(e)})}function oW(e){let{user:t,terms:n,lts:r}=e;return!((null==t?void 0:t.type)!=="NEW_USER"||!n||(null==r?void 0:r.bucket)===void 0||void 0===r.variant)}function oH(e){let{terms:t,lts:n}=e;if(!oW(e))return[];let r=oV(n);return r?null==t?void 0:t.reduce((e,t)=>{let{variant:n}=ey.decodeTermName(t.name);return(null==n?void 0:n.toLowerCase())===r.toLowerCase()&&e.push(t),e},[]):[]}let oV=function(e){if(!e)return;let t={NaN:"N",0:"L",1:"M",2:"H"},n=Math.max(...Object.keys(t).filter(e=>"NaN"!==e).map(Number));return`lts(${t[Math.min(n,Math.floor(e.bucket/4))]||t.NaN}-${e.variant})`};var oq=class extends R{constructor(){super(),j(this,"_listeners",void 0),j(this,"_postpendListeners",void 0),this._listeners=new Map,this._postpendListeners=new Map}off(e,t){let n=this.getEventListeners(e),r=this.getPostpendListeners(e),i=n.indexOf(t),s=r.indexOf(t);return -1!==i&&n.splice(i,1),-1!==s&&r.splice(s,1),(-1!==i||-1!==s)&&this.updateEventEmitter(e),this}on(e,t){return this.getEventListeners(e).push(t),this.updateEventEmitter(e),this}removeListener(e,t){return this.off(e,t)}addListener(e,t){return this.on(e,t)}postpendListener(e,t){return this.getPostpendListeners(e).push(t),this.updateEventEmitter(e),this}prependListener(e,t){return this.getEventListeners(e).unshift(t),this.updateEventEmitter(e),this}removeAllListeners(e){return e?(this._listeners.delete(e),this._postpendListeners.delete(e)):(this._listeners.clear(),this._postpendListeners.clear()),super.removeAllListeners(e)}getEventListeners(e){return this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e)}getPostpendListeners(e){return this._postpendListeners.has(e)||this._postpendListeners.set(e,[]),this._postpendListeners.get(e)}updateEventEmitter(e){let t=this.getEventListeners(e),n=this.getPostpendListeners(e);super.removeAllListeners(e),[...t,...n].forEach(t=>super.on(e,t))}};let oK=O.extend("sdk");var oz=class extends oq{constructor(){super(),j(this,"ready",void 0),j(this,"rulesInitialized",void 0),j(this,"getRosettaAppConfig",sz),j(this,"registerService",ag),j(this,"getServiceConfig",ay),j(this,"getService",ah),j(this,"sendMessage",l4),j(this,"registerChannelListener",l8),j(this,"removeChannelListener",l5),j(this,"registerWaiter",os.register),j(this,"subscribeWaiter",os.subscribe),j(this,"updateWaiter",os.update),j(this,"cancelWaiter",os.cancel),j(this,"callApi",i8),j(this,"prepareArticleData",i3),j(this,"setArticleData",i4),j(this,"serverRules",lX),j(this,"anonymousServerRules",lQ),this.ready=!1,this.rulesInitialized=!1}setConfig(e){return oK(`SDK version: ${this.version}`),function(e){var t;let{aid:n,env:r,apiUri:i,debug:s=!1}=e;I?i0("setConfig is client side only"):n&&r&&i?(L(i1,{aid:n,env:r,apiUri:i,debug:s}),null==(t=K.instance)||t.push(["setDebug",s])):i0("setConfig: aid, env and apiUri are required")}(e.piano),L(i9,e.contentService),sl.setConfig(e.rosetta),this}getConfig(){return{piano:_(i1),contentService:_(i9),rosetta:sl.getConfig()}}init(){var e=this;return F(function*(){var t;let n,r,i;if(oK("init()"),I){let e="Make sure you call init() on the client side.";throw oK("init()",e),Error(e)}let s=_(i1);if(!s){let e="Make sure you call setConfig() on the client side.";throw oK("init()",e),Error(e)}yield K.loadAdBlockDetectionScript(),yield sq(e.getConfig()),function(e,t){try{var n,r,i,s,a;let l,o,u,c=o_(t);if(!c)return;l=K.instance,o=null==c||null==(s=c.tp)||null==(s=s.customVariables)?void 0:s.monthlyRenewNowPromoCodeHasBeingUse,(u=null==c||null==(a=c.tp)||null==(a=a.customVariables)?void 0:a.annualRenewNowPromoCodeHasBeingUsed)&&(null==l||l.push(["setCustomVariable","annualRenewNowPromoCodeHasBeingUsed",u])),o&&(null==l||l.push(["setCustomVariable","monthlyRenewNowPromoCodeHasBeingUsed",o])),e.rulesEngine.addFact("hasIpAccess",null==c||null==(n=c.facts)?void 0:n.hasIpAccess),e.rulesEngine.addFact("ipRangeAccess",null==c||null==(r=c.facts)?void 0:r.ipRangeAccess),e.rulesEngine.addFact("ipRangeContractIds",null==c||null==(i=c.facts)?void 0:i.ipRangeContractIds)}catch(e){oL.error("Failed to load data from localStorage:",e)}}(e,s.aid);try{yield K.loadScript(s.env)}catch(e){throw new oJ("failed to load piano script",{cause:e})}yield function(e){return i2.apply(this,arguments)}(e),(e=>{let{sdk:t}=e;t.on("completeUpgradePurchase",e=>{t.sendMessage("sdk/response-from-sdk",{type:"custom",message:{requestType:"checkout/completeUpgradePurchase",responseData:e}})})})({sdk:e}),oj({sdk:e}),n=K.loadedInstance,r=()=>{var t;let r=null==n?void 0:n.customVariables.geoLocation;(window.dataLayer=window.dataLayer||[]).push({_clear:!1,userProperties:{country:r}}),e.rulesEngine.addFact("piano",G(G({},e.rulesEngine.getFact("piano")),{},{currency:null==n||null==(t=n.customVariables)?void 0:t.currency}))},e.prependListener("experienceExecute",r),t=s.aid,i=()=>{let n=K.loadedInstance;if(!n)return;let r=e.rulesEngine.getFact("ipRangeAccess");var i,s,a=t,l={facts:{hasIpAccess:null!=(i=null==(s=n.customVariables)?void 0:s.ip_access_user)&&i||r&&Object.values(r).some(Boolean),ipRangeAccess:r},tp:{customVariables:n.customVariables}};try{let e=(0,o.A)(o_(a),l),t=function(e){let{plaintextData:t,encryptionKey:n}=e;return E.AES.encrypt(t,n).toString()}({plaintextData:JSON.stringify(e),encryptionKey:a});localStorage.setItem(oN,t)}catch(e){localStorage.removeItem(oN),oL.error("Failed to save data to localStorage:",e)}},e.postpendListener("experienceExecute",i),e.ready=!0,e.emit("onReady")})()}isReady(){return this.ready}get constants(){return i7}get version(){return"2.1.0"}execute(){var e,t,n;if(oK("execute()"),!K.loadedInstance)return;let r=sz();((null==r||null==(e=r.tracking)?void 0:e.shouldTrackPianoExecution)===!0||(null==r||null==(t=r.tracking)?void 0:t.shouldTrackPianoExecution)===void 0)&&sl.logPianoExecution((null==r||null==(n=r.tracking)?void 0:n.shouldTrackPianoExecution)===void 0),K.loadedInstance.experience.execute()}setPageUrl(e){var t;return oK("setPageUrl()",{pageUrl:e}),null==(t=K.instance)||t.push(["setPageURL",e]),this}get rulesEngine(){return sp}get Rule(){return sc}initRules(){var e=this;return F(function*(){try{var t;let n;K.loadedInstance||a5("tp object not found to set up ip range access listener"),n=t=>{(()=>{try{var n,r,i;let s=new Set(null==(n=null==(r=e.rulesEngine.getFact("activeConversions"))?void 0:r.map(e=>e.term.term_id))?[]:n),a=Array.from(new Set(null==(i=t.result)||null==(i=i.events)||null==(i=i.find(e=>"experienceExecute"===e.eventType))?void 0:i.eventExecutionContext.accessList.filter(e=>!s.has(e.termId))));if(0===a.length)return void e.rulesEngine.addFact("ipRangeAccess",a9,{replace:!0});e.rulesEngine.addFact("ipRangeContractIds",Array.from(new Set(a.map(e=>e.termId))).join(","),{replace:!0});let l=new Set(a.map(t=>{var n;return aM(t.rid,null==(n=e.rulesEngine.getFact("appConfig"))?void 0:n.pianoResourceIds)})),o=(0,g.A)(a9);for(let e in a6)o[e]=[...l].some(t=>a6[e].has(t));e.rulesEngine.addFact("ipRangeAccess",o,{replace:!0})}catch(t){a5("Error setting up ipRangeAccess facts. Using default facts",t),e.rulesEngine.addFact("ipRangeAccess",a9)}})(),e.off("experienceExecute",n)},e.prependListener("experienceExecute",n),yield sq(e.getConfig()),I||sp.setReady(sn),yield aA(sp,e.getConfig()),yield a7(sp),yield sp.run("_initGuest"),null!=(t=K.loadedInstance)&&t.externalJWT&&(yield a4(sp,e.getConfig())),yield lW(sp),yield sp.run("_initUser"),yield void sp.addRule(new sc("abTestVariants").waitFor([sn,st]).stage(8).when(()=>!0).then(()=>{var e;return lz({customVariables:null==(e=K.loadedInstance)?void 0:e.customVariables})}).fallback({})),yield void(sp.addRule(new sc("ui.masthead.button").waitFor([sn]).stage(10).when(({hasToken:e})=>!!e).then(({hasIpAccess:e,hasActiveScmpSubscription:t,hasActiveEpaperConversions:n},{user:{isSCMPSubscriber:r,isSCMPLiteSubscriber:i,isSCMPPlusSubscriber:s,autoRenewEnabled:a,isAutoRenewable:l,isUpgradeable:o,hasScmpUpgradeOptions:u,gracePeriod:c,hasPendingTermChange:d,isHyperActiveSubscriber:p,isFreeSubscriber:m,overallSubscriptionDaysLeft:f,isActiveSubscriptionInFreeTrialPeriod:g,winback:y}={},guest:{supportPiano:h}={}})=>({getDisplayVariant:({shouldIncludeEpaper:b=!1,shouldIncludeScmpPlus:v=!1})=>{if(!h||e)return"";if(null!=c&&c.isActive)return"GRACEPERIOD";if(i)return"";if(r){if(m&&!t)return"SUBSCRIBE";if(l&&!a)return g||(null==f?0:f)>90?"AUTORENEW":"RENEW";if(v&&s)return"SCMPPLUS";if(o&&!p&&!d&&u)return"UPGRADE"}return b&&!v&&n&&a?"EPAPER":null!=y&&y.latestExpiredScmpB2CConversion?"REACTIVATE":r?"":"SUBSCRIBE"}})).fallback(({hasIpAccess:e},{guest:{supportPiano:t}={}})=>({getDisplayVariant:()=>!t||e?"":"SUBSCRIBE"}))),sp.addRule(new sc("ui.tooltip.usertype").waitFor(sn).stage(10).when(({hasToken:e})=>!!e).then((e,{user:{isSiteLicenseSubscriber:t,isSCMPSubscriber:n,isInternalStaff:r,activeBillingPeriod:i}={}})=>r?"internal":t?n?"scmpGroupSub":"groupSub":n?i===ss.MONTHLY?"monthly":i===ss.ANNUAL?"annual":i===ss.BIANNUAL?"biannual":"subscriber":"nonSubscriber").fallback("anonymous")),sp.addRule(new sc("ui.tooltip.impressionUserType").waitFor(sn).stage(10).when(({hasToken:e})=>!!e).then((e,{user:{isPasswordless:t,isAuthenticated:n,isSCMPSubscriber:r,isInternalStaff:i}={}})=>i?"Authenticated Users":r?"Subscribers":n?"Authenticated Users":t?"Registered Users":"").fallback("Anonymous")),sp.addRule(new sc("ui.tooltip.impressionLabel").waitFor(sn).stage(10).when(({hasToken:e})=>!!e).then((e,{user:{isSCMPSubscriber:t,isSiteLicenseSubscriber:n,activeBillingPeriod:r}={}})=>{if(n)return"sitelicense";if(t)switch(r){case ss.MONTHLY:return"Monthly";case ss.ANNUAL:return"Annual";case ss.BIANNUAL:return"Biannual"}return""}).fallback("")),sp.addRule(new sc("ui.tooltip.messageObject").waitFor(sn).stage(11).when(({hasToken:e})=>!!e).then(({appConfig:e},{user:{isSCMPSubscriber:t}={},ui:{tooltip:{usertype:n}={}}={}})=>{var r,i;let s=n&&(null==e||null==(r=e.tooltip)?void 0:r[n]);if(s)return s;let a=null==e||null==(i=e.tooltip)?void 0:i.subscriber;return a&&t?a:{}}).fallback(({appConfig:e},{ui:{tooltip:{usertype:t}={}}={}})=>{var n;return t?null==e||null==(n=e.tooltip)?void 0:n[t]:{}})),sp.addRule(new sc("ui.article.printable").waitFor([sn,st]).stage(10).when(({hasToken:e})=>!!e).then(({hasIpAccess:e},{user:{isSCMPSubscriber:t}={},guest:{supportPiano:n}={}})=>!!(e||!n||t)).fallback(({hasIpAccess:e},{guest:{supportPiano:t}={}})=>!!(!t||e))),sp.addRule(new sc("ui.account.showAutoRenewWidget").waitFor(sn).stage(10).when(({hasToken:e})=>!!e).then(({hasActiveSubscriptions:e},{user:{overallAutoRenewEnabled:t,isAutoRenewable:n}={}})=>!!(e&&n&&!t)).fallback(!1)),sp.addRule(new sc("ui.popup.showSubscriberOnboarding").waitFor(sn).stage(10).when(({hasToken:e})=>!!e).then(({userCookie:e,hasActiveConversions:t},{user:{onboardingData:n}={}})=>{let r=null==n?void 0:n.value;return!!(e&&t&&"show"===r)}).fallback(!1)),sp.addRule(new sc("ui.popup.showSCMPPlusWelcomePopup").waitFor([sn,st]).stage(10).when(({hasToken:e})=>!!e).then(({userCookie:e},{user:{hasSCMPPlusAccessRight:t,pianoCustomFields:{hasShownSCMPPlusWelcomePopUp:n}={}}={}})=>e&&t&&!(null!=n&&n.value)).fallback(!1))),yield lH(sp),yield sp.run("_initMisc"),e.rulesInitialized=!0,e.emit("rules:initialized")}catch(t){oK("initRules() error: %s",t.message),e.rulesInitialized=!1}})()}initiateSwGLinkingFlow(){var e=this;return F(function*(){return function(e){return l2.apply(this,arguments)}(e)})()}setupPaywallCheckoutForPWA(e){return function(e,t){var n,r,i,s,a,l,o;let u,c,d,p;u=e.rulesEngine.getOutcome("tracking.ga4.userRole"),window.dataLayer=window.dataLayer||[],window.dataLayer.push({page:{ga4UserRole:u}}),ow();let{setupCheckoutScriptListenerCleanup:m,isTemplateReadyPromise:f}={setupCheckoutScriptListenerCleanup:()=>null==c?void 0:c(),isTemplateReadyPromise:new Promise(e=>{c=oc(t=>{"template/ready"===t.detail.eventType&&e(!0)})})};sN({jsLink:sF({filename:"subscriptionCheckout.js"}),tagId:"subscription-checkout-script"});let{cleanup:g,setPaymentMethod:y}=function(e){var t;let{sdk:n,config:r,popup:i}=e,s=null,a=null,l="",o="",u="",c=()=>{var e;null==(e=K.loadedInstance)||e.offer.close(),od({eventType:"popup/show-error",data:null})},d=()=>{oh(),function(e){let{sdk:t,paymentMethod:n,term:r,termId:i}=e;of({subcategory:"shopping_cart",action:"close",customized_parameters:{call_to_action:"subscribe",payment_method:n,term_offer_selected:null==i?null==r?void 0:r.termId:i}},t)}({sdk:n,termId:null==s?void 0:s.termId,paymentMethod:o})},p=e=>{a=e},m=e=>{var t;s=null==e?void 0:e.term,oM("submitPaymentHandler",e),og({callToAction:"subscribe",sdk:n,paymentTaxRate:null==e||null==(t=e.term)?void 0:t.taxRate,billingCountryName:l,paymentMethod:o,termId:null==e?void 0:e.term.termId})},f=(t=F(function*(e){var t,a,c,d,p,m;if(!s)return;(({conversion:e,checkoutTerm:t,scmpUrl:n})=>F(function*(){if(oI()){let r=e.email;try{oR("sending activation email",{email:r}),yield sl.sendActivationEmail({email:e.email,destination:oE({scmpUrl:n,application:lm({decodedTerm:ey.decodeTermName(t.name)})})}),oR("sending activation email completed",{email:r})}catch(e){oR.error("failed to send activation email",{email:r,error:e})}}})())({conversion:e,checkoutTerm:s,scmpUrl:r.scmp.url});let f=oI(),g=lm({decodedTerm:ey.decodeTermName(s.name)}),y=oE({scmpUrl:r.scmp.url,application:g});null==(t=K.loadedInstance)||t.offer.close(),oh(),om({conversionId:null==(a=null==e?void 0:e.termConversionId)?"":a,plan:null==(c=s.name)?"":c,price:null==(d=null==e?void 0:e.chargeAmount)?"":d,currency:null==(p=null==e?void 0:e.chargeCurrency)?"":p,promoCode:u});let h=yield sl.getPayment(null==e?void 0:e.paymentId);(function(e){let{sdk:t,transactionId:n,term:r,termId:i,paymentCountry:s,paymentMethod:a}=e;of({subcategory:"result",action:"sys",customized_parameters:{payment_method:a,call_to_action:"subscribe",result:"success",term_offer_selected:null==i?null==r?void 0:r.termId:i,payment_country:s,transaction_id:n,result_source:"piano"}},t)})({sdk:n,transactionId:null==h?void 0:h.transactionId,term:s,paymentCountry:l,paymentMethod:o}),od({eventType:"popup/show-thank-you",data:{isPasswordlessUser:f,isOnboarding:!f,email:e.email,termName:ln(s.name),tpZone:null==(m=K.loadedInstance)?void 0:m.zone,isCloseable:!0,triggerReloadOnClose:i.triggerReloadOnClose,resumeLink:y}}),function(e){var t,n;let{sdk:r,transactionId:i,term:s,termName:a,termId:l,paymentCountry:o,paymentMethod:u}=e;of({subcategory:"result",action:"imp",customized_parameters:{payment_method:u,call_to_action:"subscribe",transaction_id:i,result:"success",term_offer_selected:null==l?null==s?void 0:s.termId:l,payment_country:o,lts_bucket:null==r||null==(t=r.rulesEngine)?void 0:t.getFact("ltsBucket"),product_type:lf({term:{name:null==(n=null==a?null==s?void 0:s.name:a)?"":n}})}},r)}({sdk:n,transactionId:null==h?void 0:h.transactionId,term:s,paymentCountry:l,paymentMethod:o})}),function(e){return t.apply(this,arguments)}),g=({message:e})=>{switch(e.requestType){case"SYNC_CART_DATA":{let{responseData:t}=e;"billingCountry"===t.key&&(l=t.value),"appliedPromoCode"===t.key&&(u=t.value);break}case"action/trackGA4-thankyou-click-resume-reading":if(!s)return;!function(e){let{sdk:t,paymentMethod:n,promoCode:r,termId:i}=e;of({subcategory:"result",action:"click",customized_parameters:{call_to_action:"resume your reading",payment_method:n,term_offer_selected:i,promo_code:r}},t)}({sdk:n,paymentMethod:o,promoCode:u,termId:s.termId});break;case"action/trackGA4-thankyou-start-onboarding-click":of({category:"onboarding",action:"click",customized_parameters:{user_type:"subscriber",step:1,cta_type:"start",call_to_action:""}},n);break;case"action/trackGA4-select-billing-country":{if(!a)return;let{requestData:t}=e;og({sdk:n,callToAction:"select country",billingCountryName:t.value.name,paymentMethod:o,termId:a.termId});break}default:oM("unknown request type",e.requestType)}};return n.registerChannelListener("sdk/request-from-template"),n.on("submitPayment",m),n.on("checkoutComplete",f),n.on("checkoutSelectTerm",p),n.on("checkoutError",c),n.on("checkoutClose",d),n.on(l6,g),{cleanup:()=>{n.off("submitPayment",m),n.off("checkoutComplete",f),n.off("checkoutSelectTerm",p),n.off("checkoutError",c),n.off("checkoutClose",d),n.off(l6,g)},setPaymentMethod:e=>{o=e}}}({sdk:e,config:t,popup:{triggerReloadOnClose:!0}}),h=(n=e,r=t,i=y,n.registerChannelListener("pwa/request-from-template"),d=(s=F(function*(e){let{message:t}=e;switch(null==t?void 0:t.requestType){case"showOnboardingPopup":sY();break;case"action/samePageRedirect":var s;null!=t&&null!=(s=t.requestData)&&s.targetUrl&&window.open(t.requestData.targetUrl,"_self");break;case"action/paywallCheckout":let{offerId:a,term:l,paymentMethod:o,trackingId:u,wallType:c}=(null==t?void 0:t.requestData)||{};if(!a||!l||!c||void 0===u)return void o$("Missing required parameters for paywall checkout",{offerId:a,term:l,wallType:c,trackingId:u});i(o||""),yield function(e){return oO.apply(this,arguments)}({sdk:n,offerId:a,paymentMethod:o,term:l,trackingId:u,config:r,wallType:c})}}),function(e){return s.apply(this,arguments)}),n.on("COMM_CHANNEL",d),()=>{n.off("COMM_CHANNEL",d)}),{setupSessionRestorationCleanup:b}=(a=e,l=f,o=y,l.then(()=>{if(a.rulesInitialized)e();else{let t=()=>e();a.on("rules:initialized",t),p=()=>a.off("rules:initialized",t)}function e(){oD.resumeIfSessionExists({sdk:a,setPaymentMethod:o})}}).catch(e=>{o$("Failed to restore session:",e)}),{setupSessionRestorationCleanup:()=>null==p?void 0:p()});return{cleanup:()=>{h(),g(),m(),b()}}}(this,e)}};new oz;var oJ=class extends Error{};let oX=O.extend("modules/checkout/offers/standardDigital");function oZ(e={terms:[],user:{hasEverSubscribedToScmp:!1,hasEverSubscribedToPosties:!1,hasEverSubscribedToYoungPost:!1,hasEverConvertedToSCMPPlus:!1}}){if(oX("getStandardDigitalTerms",e),!e.terms)return oX("No terms or user found in context",e),[];let{terms:t,user:{hasEverSubscribedToScmp:n}}=e;return t.filter(e=>(function(e,t){let{resource:n}=ey.decodeTermName(e);return n===t})(e.name,"digital")).filter(e=>(function(e){let{variant:t}=ey.decodeTermName(e);return!t})(e.name)).map(e=>{let t,n,r,i,s,a,l;return t=(null==e?void 0:e.payment_billing_plan_table)||[],n=(null==e?void 0:e.payment_currency)||"",r=t.find(e=>(null==e?void 0:e.isTrial)!=="true"),i=t.find(e=>(null==e?void 0:e.isTrial)==="true"),s=(null==r?void 0:r.priceValue)||0,a=(null==i?void 0:i.priceValue)||s,l=(null==r?void 0:r.billingPeriod)||"",G(G(G(G(G(G({},e),!(null!=e&&e.termId)&&{termId:null==e?void 0:e.id}),n&&{currency:n}),!(null!=e&&e.rackPrice)&&{rackPrice:s}),!(null!=e&&e.introPrice)&&{introPrice:a}),!(null!=e&&e.billingPeriod)&&{billingPeriod:l})}).map(e=>G(G({},e),{},{discount:n||null==e.introPrice||null==e.rackPrice?0:Math.round((1-e.introPrice/e.rackPrice)*100),chargePrice:n?e.rackPrice:e.introPrice}))}function oQ(e){return[{billingCycle:"1M"},{billingCycle:"1Y"},{billingCycle:"2Y"}].map(t=>e({billingCycle:t.billingCycle}))}function o0(e){return o1.apply(this,arguments)}function o1(){return(o1=F(function*(e){let{context:t,services:n,plans:r}=e,i=r.reduce((e,n)=>{var r;let{isEligible:i,source:s}=n.isEligible(t);if(!i)return e;let a=n.selectTerm(t);if(!a)return e;let l=null==(r=n.getPromotionName)?void 0:r.call(n,t);return e.plans.push({offer:n.offer,action:n.action,targetTerm:a,targetPromotionName:l,source:s}),l&&e.uniquePlanPromotionNames.add(l),e},{plans:[],uniquePlanPromotionNames:new Set}),s=yield n.fetchPromotions(Array.from(i.uniquePlanPromotionNames));return i.plans.reduce((e,n)=>{var r;let i=ls(n.targetTerm.name);if(!1===i.decoded)return e;let a=(()=>{let{targetPromotionName:e}=n;if(e)return s.find(t=>t.name.toLowerCase().startsWith(e.toLowerCase()))})();return n.targetPromotionName&&!a||e.push({offer:n.offer,action:n.action,term:n.targetTerm,decodedTermName:i,promotion:a,consolidatedBillingTable:null==(r=lw({term:n.targetTerm,promotion:a,isNewPianoCustomer:t.user.isNewPianoCustomer}))?[]:r,source:n.source}),e},[])})).apply(this,arguments)}oQ(function(e){let{billingCycle:t}=e,n="scmpAndScmpPlusEPaper";return{name:`Plus Standard: ${n} | ${t}`,offer:"standard",action:"subscribe",term:{billingCycle:t,resource:n},isEligible:()=>({isEligible:!0}),selectTerm(e){let r=e.terms.find(r=>{var i;let s=ls(r.name),a=n===s.resource,l=t.toLowerCase()===(null==(i=s.billingCycle)?void 0:i.toLowerCase()),o=e.user.currency===s.currency,u=!s.variant;return a&&l&&o&&u});return r?G(G({},r),{},{offerType:"STANDARD"}):null}}}),[...oQ(function(e){let{billingCycle:t}=e,n="scmpAndScmpPlusEPaper";return{name:`Bundle Rack: ${n} | ${t}`,offer:"standard",action:"subscribe",term:{billingCycle:t,resource:n},isEligible:()=>({isEligible:!0}),selectTerm:e=>e.terms.find(r=>{var i;let s=ls(r.name),a=n===s.resource,l=t.toLowerCase()===(null==(i=s.billingCycle)?void 0:i.toLowerCase()),o=e.user.currency===s.currency,u="Rack"===s.variant,c=!s.isCrossProduct;return a&&l&&o&&u&&c})||null}}),...oQ(function(e){let{billingCycle:t}=e,n="scmpAndScmpPlusEPaper";return{name:`Bundle Intro: ${n} | ${t}`,offer:"standard",action:"subscribe",term:{billingCycle:t,resource:n},isEligible:e=>({isEligible:!e.user.hasEverConvertedToSCMPPlus}),getPromotionName(e){var n;return null==(n=({"1Y":{default:"PT-plus-1-month-free-trial-annual-intro-fix-PLUSINTROFIXANNUAL",usdh:"PT-plus-1-month-free-trial-annual-intro-fix-USD-H-PLUSINTROFIXANNUAL"},"2Y":{default:"PT-plus-1-month-free-trial-biannual-intro-fix-PLUSINTROFIXBIANNUAL",usdh:"PT-plus-1-month-free-trial-biannual-intro-fix-USD-H-PLUSINTROFIXBIANNUAL"}})[t])?void 0:n["USD-H"===e.user.currency?"usdh":"default"]},selectTerm:e=>e.terms.find(r=>{var i;let s=ls(r.name),a=n===s.resource,l=t.toLowerCase()===(null==(i=s.billingCycle)?void 0:i.toLowerCase()),o=e.user.currency===s.currency,u="Intro"===s.variant,c=!s.isCrossProduct;return a&&l&&o&&u&&c})||null}})],i=function(e){let{billingCycle:t,resource:n}=e;return{name:`Bundle Plus Rack: ${n} | ${t}`,offer:"standard",action:"subscribe",term:{billingCycle:t,resource:n},isEligible:()=>({isEligible:!0}),selectTerm:e=>e.terms.find(r=>{var i;let s=ls(r.name),a=n===s.resource,l=t.toLowerCase()===(null==(i=s.billingCycle)?void 0:i.toLowerCase()),o=e.user.currency===s.currency,u="Rack"===s.variant,c=!s.isCrossProduct;return a&&l&&o&&u&&c})||null}},[{billingCycle:"1Y",resource:"scmpPlusDailyPrintBundle"},{billingCycle:"2Y",resource:"scmpPlusDailyPrintBundle"},{billingCycle:"1Y",resource:"scmpPlusWeekdayPrintBundle"},{billingCycle:"2Y",resource:"scmpPlusWeekdayPrintBundle"},{billingCycle:"1Y",resource:"scmpPlusWeekendPrintBundle"},{billingCycle:"2Y",resource:"scmpPlusWeekendPrintBundle"}].map(e=>i({billingCycle:e.billingCycle,resource:e.resource})),(0,a.t)({checkDoesConversionsContainPreChurnPromoCodes:()=>lI,checkHasUserUsedPreChurnPromotion:()=>lR,computeWinbackContext:()=>a0,consolidatePlans:()=>o0,get2024JanPreChurnPlans:()=>lO,getConfigPreChurnFlowPlans:()=>lT,getEligiblePlans:()=>lY,getStandardDigitalTerms:()=>oZ,getStandardPreChurnPlans:()=>lL,winbackPlans:()=>aQ});var o2=(0,a.t)({CampaignPopupChannel:()=>iQ,CampaignPopupController:()=>iZ,addCampaignPopUpScript:()=>o4,resolveActiveCampaignSettings:()=>iq});let o3=D("modules/campaign/popup");function o4(){return o8.apply(this,arguments)}function o8(){return(o8=F(function*(){try{sN({jsLink:sF({filename:"campaignPopup.js"}),tagId:"campaign-pop-up-script"})}catch(e){o3.error("addCampaignPopUpScript()",e.message)}})).apply(this,arguments)}function o5(e){return e.includes("Plus")}(0,a.t)({checkCrossProductRequired:()=>o9,service:()=>o6});let o6={filterTerms:function(e,t){var n,r,i;if(!t){return r=e.terms,i=e.user,r.filter(e=>{var t,n;let r,s,{variant:a}=ey.decodeTermName(e.name);return!!(a&&["Intro","Rack"].includes(a)&&(o5(e.name)||e.name.includes("Bundle Plus")))||((t=e.name,n=i,r=t.includes("Posties"),s=t.includes("YP"),o5(t)&&(n.hasEverSubscribedToScmp||n.hasEverSubscribedToPosties||n.hasEverSubscribedToYoungPost)?n.hasEverConvertedToSCMPPlus:!s&&!r&&(n.hasEverSubscribedToPosties||n.hasEverSubscribedToYoungPost)?n.hasEverSubscribedToScmp:r&&(n.hasEverSubscribedToScmp||n.hasEverSubscribedToYoungPost)?n.hasEverSubscribedToPosties:!s||!n.hasEverSubscribedToScmp&&!n.hasEverSubscribedToPosties||n.hasEverSubscribedToYoungPost)?!e.name.includes("CrossProduct"):e.name.includes("CrossProduct"))})}let s=null==(n=e.terms)?void 0:n.filter(e=>!e.name.includes("CrossProduct"));return o9(e.user,t)?s.map(t=>{var n;return null==(n=function(e,t){let{billingCycle:n,currency:r,resource:i,variant:s}=ey.decodeTermName(t.name);return e.find(e=>{let{billingCycle:t,currency:a,isCrossProduct:l,resource:o,variant:u}=ey.decodeTermName(e.name);return n===t&&r===a&&i===o&&s===u&&l})}(e.terms,t))?t:n}):s}};function o9(e,t){return"plus"===t&&(e.hasEverSubscribedToScmp||e.hasEverSubscribedToYoungPost||e.hasEverSubscribedToPosties)?!e.hasEverConvertedToSCMPPlus:"scmp"===t&&(e.hasEverSubscribedToPosties||e.hasEverSubscribedToYoungPost)?!e.hasEverSubscribedToScmp:"posties"===t&&(e.hasEverSubscribedToScmp||e.hasEverSubscribedToYoungPost)?!e.hasEverSubscribedToPosties:"yp"===t&&(!!e.hasEverSubscribedToScmp||!!e.hasEverSubscribedToPosties)&&!e.hasEverSubscribedToYoungPost}(0,a.t)({SCMP_LITE_TEST_NAME:()=>o7,computeScmpLiteNonCoreGeosState:()=>ue});let o7="SCMP Lite";function ue(e){var t,n,r,i,s;let a=(n=(t=e.user).country,!!t.country&&"US"!==n&&"SG"!==n&&"HK"!==n&&(!(r=t.ltsBucket)||5>r));return{isEligible:a,liteTerms:a?(null==(s=(i=e).terms)?[]:s).filter(e=>{let{currency:t,variant:n}=ey.decodeTermName(e.name);return"LiteABTest(85%)"===n&&t===i.user.currency}):[]}}var ut=(0,a.t)({SCMP_LITE_CORE_GEOS_TEST_NAME:()=>un,computeScmpLiteCoreGeosState:()=>us});let un="SCMP Lite Core Geos",ur=["0","1","2"];function ui(e){return!!e&&ur.includes(e)}function us(e){var t,n,r,i,s,a,l,o;let u,c,d,p,m,{optimizely:f,user:g}=e,y=(n=f).isActive&&(null==(r=n.variation)?void 0:r.name)!=="0"&&["US","SG","HK"].includes(g.country)&&(null==(i=g.ltsBucket)?1/0:i)<5;return{isEligible:y,liteCoreGeosTerms:y?(m=(c=ui(u=Array.isArray(null==(s=e)?void 0:s.targetSpecificExpVariant)?null==s?void 0:s.targetSpecificExpVariant[0]:null==s?void 0:s.targetSpecificExpVariant)?u:null,d=ui(null==(l=s.optimizely.variation)?void 0:l.name)?null==(o=s.optimizely.variation)?void 0:o.name:null,(p=null==c?d:c)?({1:"LiteCoreGeosABTest(70%)",2:"LiteCoreGeosABTest(85%)"})[p]:null),(null==(a=s.terms)?[]:a).filter(e=>{let{currency:t,variant:n}=ls(e.name);return t===s.user.currency&&n===m})):[],variant:y?null==(t=f.variation)?void 0:t.name:void 0}}var ua=(0,a.t)({getApplicablePaywallStrategy:()=>ul});function ul({paywallStrategyConfigs:e,filterContext:t}){return null!=e&&e.length?uo.getTargetingPaywallSettings(e,t):null}let uo={getTargetingPaywallSettings:(e,t)=>{let n=({configs:e,user:t,article:n})=>e.reduce((e,r)=>{let{filters:i=[],settings:s={}}=r;return!(null!=i&&i.length)||null!=i&&i.some(e=>{var r,i,s,a,l,o;return[{filterValues:null==e||null==(r=e.user)?void 0:r.types,actualValues:null==t?void 0:t.type},{filterValues:null==e||null==(i=e.user)?void 0:i.currencies,actualValues:null==t?void 0:t.currency},{filterValues:null==e||null==(s=e.article)?void 0:s.paywalls,actualValues:null==n?void 0:n.paywall},{filterValues:null==e||null==(a=e.article)?void 0:a.flags,actualValues:null==n?void 0:n.flag},{filterValues:null==e||null==(l=e.article)?void 0:l.topicIds,actualValues:null==n?void 0:n.topicIds},{filterValues:null==e||null==(o=e.article)?void 0:o.sectionIds,actualValues:null==n?void 0:n.sectionIds}].every(uu)})?(0,o.A)(e,s):e},{});for(let r of e){let{name:e}=r,{configs:i}=r,s=n({configs:i,user:t.user,article:t.article});if(!(Object.keys(s).length<=0)&&function(e){let t=!0;if(e){let n=new Date;t=!!e.find(e=>{let t=new Date(e.start)<=n,r=!!e.end&&n>=new Date(e.end);return t&&!r})}return t}(s.dates))return{name:e,settings:s}}return null}},uu=e=>{let{filterValues:t,actualValues:n}=e;if(null==t)return!0;let r=Array.isArray(t)?t:[t];if(0===r.length)return!0;if(null==n)return!1;let i=Array.isArray(n)?n:[n];if(0===i.length)return!1;let s=r.map(e=>"string"==typeof e?e.toLowerCase():e),a=new Set(i.map(e=>"string"==typeof e?e.toLowerCase():e));return s.some(e=>a.has(e))};var uc=(0,a.t)({strategies:()=>ua}),ud=new oz;ey.decodeTermName}}]);
//# sourceMappingURL=3729d3da-b537382c1bdb2bac.js.map