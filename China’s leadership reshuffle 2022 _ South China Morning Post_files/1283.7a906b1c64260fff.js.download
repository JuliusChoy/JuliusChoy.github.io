!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b6e17df3-b29f-4a5b-98ff-3b4348549279",e._sentryDebugIdIdentifier="sentry-dbid-b6e17df3-b29f-4a5b-98ff-3b4348549279")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1283,5018],{1544:(e,t,n)=>{n.d(t,{X:()=>a});let a={notArchive:{entityId:"511139",entityUuid:"c4365f23-40c4-47d5-a503-5c7f58c7b2b5",name:"Not archive"},notVelocity:{entityId:"511138",entityUuid:"8f904aa8-bd1b-4a06-93fc-104e3559fd4e",name:"Not velocity"},scmpPlus:{entityId:"517129",entityUuid:"716f570e-3083-4138-a080-47d3830fafe3",name:"SCMP Plus"},velocity:{entityId:"507836",entityUuid:"a847a765-95e0-444a-a4df-76b85c9d089b",name:"velocity"},velocity2kViews:{entityId:"521128",name:"Velocity 2k"},velocity3kViews:{entityId:"521129",name:"Velocity 2k"}}},7982:(e,t,n)=>{n.d(t,{$:()=>s});var a=n(98503),i=n(14820),r=n(69524),l=n(99523),o=n(51623);let s=(e,t)=>{let n=(0,a.J)(t),s=(0,i.S)(),{0:c,1:u}=(0,o.useState)(()=>s&&null!=t&&t.initializeWithValue?l.A.get(e)??null:null),d=(0,o.useCallback)(t=>{l.A.set(e,t,n.current),u(t)},[e,n]),p=(0,o.useCallback)(()=>{l.A.remove(e),u(null)},[e]);return(0,r.u)(()=>{let t=l.A.get(e);!c&&t&&u(t)}),[c,d,p]}},8934:(e,t,n)=>{n.d(t,{kl:()=>i,nu:()=>r,xE:()=>l}),n(49194);var a=n(25249);let i=e=>{let t=r(e),n=t.includes("plus"),a=l(e),i=e=>t.includes(e)||n&&a===e;return{includeAsiaDiscoveryWidget:i("asia-discovery"),includeChinaFutureTechDiscoveryWidget:i("china-future-tech-discovery"),includeChinaScienceDiscoveryWidget:i("china-science-discovery"),includeComment:i("comment"),includeFocusArticle:i("focus-article"),includeMostPopular:i("most-popular"),includeMultimedia:i("multimedia"),includeOpenQuestionsSeriesDiscoveryWidget:i("open-questions-series-discovery"),includePlus:n,includeThisWeekInAsiaDiscovery:i("this-week-in-asia-discovery"),includeTrendingTopics:i("trending-topics")}},r=e=>{switch(e){case a.u.asia.entityId:return["this-week-in-asia-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.business.entityId:case a.u.economy.entityId:case a.u.hongKong.entityId:return["plus","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.china.entityId:return["china-science-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.chinaFutureTech.entityId:return["focus-article","plus","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.comment.entityId:case a.u.kPop.entityId:case a.u.sport.entityId:return["recommended-for-you","comment","multimedia","trending-topics"];case a.u.lifestyle.entityId:return["post-magazine","comment","recommended-for-you","multimedia","trending-topics"];case a.u.news.peopleAndCulture.entityId:return["post-magazine","recommended-for-you","comment","multimedia","trending-topics"];case a.u.olympic.entityId:return["recommended-for-you","multimedia","most-popular"];case a.u.tech.entityId:return["china-future-tech-discovery","recommended-for-you","comment","multimedia","trending-topics"];case a.u.thisWeekInAsia.entityId:return["asia-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];case a.u.us.entityId:case a.u.us.usElections.entityId:return["focus-article","comment","recommended-for-you","multimedia","trending-topics"];case a.u.world.entityId:return["open-questions-series-discovery","comment","recommended-for-you","multimedia","trending-topics","most-popular"];default:return["comment","recommended-for-you","multimedia","trending-topics","most-popular"]}},l=e=>({[a.u.chinaFutureTech.entityId]:"china-science-discovery"})[e]??"china-future-tech-discovery"},9162:(e,t,n)=>{n.d(t,{R:()=>h,g:()=>b}),n(61100),n(52973);var a=n(33261);n(6611),n(50528),n(95429),n(45621),n(37684);var i=n(71316),r=n(98503),l=n(10028),o=n(51623),s=n(33503),c=n(42497),u=n(24944),d=n(25858),p=n(99644),g=n(39337),y=n(45664),m=n(92138);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let b=()=>{let[e,t]=(0,l.fp)(y.B),n=(0,o.useCallback)(e=>{let{ga4CustomParameter:t,isShow:n}=e;n&&(0,p.z2)(t)&&(async()=>{await (0,g.a)({priority:"background"}),(0,m.UL)({action:"imp",category:"login",customized_parameters:t,subcategory:"popup"})})()},[]);return{closeLoginDialog:(0,o.useCallback)(()=>{t(e=>w(w({},e),{},{description:"",destination:"",emailLoginTitle:"Sign In / Register",isVisible:!1,title:"Sign In / Register"})),n({ga4CustomParameter:void 0,isShow:!1})},[t,n]),loginDialogState:e,openLoginDialog:(0,o.useCallback)(e=>{t(w(w({},e),{},{description:e.description??"",emailLoginTitle:"Sign In / Register",isVisible:!0,title:e.title??"Sign In / Register",variant:"dialog"})),n({ga4CustomParameter:e.ga4CustomParameter,isShow:!0})},[t,n]),setLoginDialogState:t}},v=()=>{let{loginDialogState:e,setLoginDialogState:t}=b(),n=(0,l.Xr)(u.R),{0:a,1:r}=(0,o.useState)([]);return{attachEventHandlers:(0,o.useCallback)(()=>{e.wallType&&localStorage.removeItem(e.wallType);let a=[],l=i.on(i.EVENT.EMAIL_REGISTRATION_SUCCESS,e=>{n(e.email)});"function"==typeof l&&a.push(l);let o=i.on(i.EVENT.EMAIL_REGISTRATION_COMPLETED,t=>{location.href=(()=>{let n=new URL(window.location.href),a=new URL(`${c.$.account.registerCallbackUrl}${(0,d.QS)(t.email)}`);return a.searchParams.set("source","pwa"),e.destination&&a.searchParams.set("destination",e.destination),n.searchParams.set("destination",encodeURIComponent(a.href)),e.registrationTerm&&n.searchParams.set(e.registrationTerm,"true"),n.toString()})()});"function"==typeof o&&a.push(o);let u=i.on(i.EVENT.OPEN_WITH_EXTERNAL_BROWSER,()=>{t(e=>w(w({},e),{},{variant:"dialog-with-primary-close-button-only"}))});"function"==typeof u&&a.push(u),[{event:i.EVENT.APPLE_LOGIN_BUTTON_CLICKED,loginMethod:"Apple"},{event:i.EVENT.GOOGLE_LOGIN_BUTTON_CLICKED,loginMethod:"Google"},{event:i.EVENT.FACEBOOK_LOGIN_BUTTON_CLICKED,loginMethod:"Facebook"}].forEach(t=>{let{event:n,loginMethod:r}=t,l=i.on(n,()=>{e.wallType&&(0,s.g$)(e.wallType,r)});"function"==typeof l&&a.push(l)}),r(a)},[t,e.destination,e.registrationTerm,e.wallType,n]),detachEventHandlers:(0,o.useCallback)(()=>{0!==a.length&&(a.forEach(e=>e()),r([]))},[a])}},h=()=>{let{loginDialogState:e}=b(),{attachEventHandlers:t,detachEventHandlers:n}=v(),a=(0,r.J)(n);return{reference:(0,o.useCallback)(n=>{if(!e.isVisible||!n)return void a.current();i.init({APPLICATION:e.application,DESTINATION:e.destination});let r=(0,s.fu)();i.initLoginWidget(n.id,{destination:e.destination,emailLoginTitle:e.emailLoginTitle,isInWebView:r,loginDescription:e.description,registerSource:"regi"===e.wallType?"loginwall":"",thirdPartySignInOptions:{withApple:!0,withFacebook:!0,withGoogle:!r},title:e.title}),t()},[t,a,e.application,e.description,e.destination,e.emailLoginTitle,e.isVisible,e.title,e.wallType])}}},21774:(e,t,n)=>{n.d(t,{Z:()=>a});let a=function(e){return e.Cryptic="cryptic",e.Quick="quick",e.WordSearch="wordSearch",e}({})},34435:(e,t,n)=>{n.d(t,{I4:()=>u,W5:()=>c,gl:()=>s,oe:()=>d}),n(61100),n(45621),n(52973),n(95429),n(37684);var a=n(33261);n(6611);var i=n(74797),r=n(92138);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t){var n;null==(n=window.dataLayer)||n.push(e)}function c(e){var t;null==(t=window.dataLayer)||t.push({subscribe:(0,i.fs)(e)})}function u(e,t){var n;null==(n=window.dataLayer)||n.push(e)}function d(e){u({_clear:!0,event:"VirtualPageview",page:o(o(o({},e),(0,r.Rf)()&&{product:"plus"}),!e.page_location&&{page_location:window.location.href}),subscribe:e.subscribe})}},38825:(e,t,n)=>{n.d(t,{Ae:()=>u,RO:()=>s,SH:()=>o,eW:()=>c,rJ:()=>l});var a=n(33261);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n(89968),n(8871),n(61100),n(45621),n(52973),n(6611),n(95429),n(37684);let l=function(e){return e.Asia="asia",e.HongKong="hk",e.International="int",e}({}),o={[l.Asia]:{href:"/asia",label:"Asia"},[l.HongKong]:{href:"/hk",label:"Hong Kong"},[l.International]:{href:"/",label:"International"}},s=[l.International,l.HongKong,l.Asia].map(e=>r({value:e},o[e])),c=[l.HongKong,l.International,l.Asia].map(e=>r({value:e},o[e])),u={[l.Asia]:"News, opinions, infographics and videos on Asia news in China, Hong Kong, Singapore, Malaysia, India, Japan, Korea, Australia and more.",[l.HongKong]:"News, opinions, infographics and videos on HK and China issues: geopolitics, economy, law & crime, weather and lifestyle.",[l.International]:"News, opinions, infographics and videos on China issues: geopolitics, diplomacy, economy, technology and lifestyle."}},45018:(e,t,n)=>{n.r(t),n.d(t,{ArticlePianoPaywallProvider:()=>c,useArticlePianoPaywallContext:()=>u}),n(61100),n(45621),n(52973),n(6611),n(95429),n(37684);var a=n(33261),i=n(51623),r=n(43575);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let s=(0,i.createContext)({}),c=e=>{let{children:t}=e,{0:n,1:a}=(0,i.useState)({}),l=(0,i.useMemo)(()=>o({},n),[n]),c=(0,i.useCallback)(e=>{null==a||a(t=>o(o({},t),{},{[e.articleEntityId]:e.state}))},[a]);return(0,r.jsx)(s.Provider,{value:{articlePianoPaywallStateMap:l,resetArticlePianoPaywallStateMap:()=>{null==a||a(()=>({}))},updateArticlePianoPaywallStateState:c},children:t})};c.displayName="ArticlePianoPaywallProvider";let u=()=>(0,i.useContext)(s)},45664:(e,t,n)=>{n.d(t,{B:()=>a});let a=(0,n(19764).eU)({description:"",destination:"",emailLoginTitle:"",isVisible:!1,title:"",variant:"dialog"})},49032:(e,t,n)=>{n.d(t,{b:()=>E});var a=n(33261),i=n(44590);n(49194),n(69597),n(45621),n(49232),n(21218),n(66087),n(61100),n(52973),n(70994),n(6611),n(95429),n(37684);var r=n(94413),l=n.n(r),o=n(10028),s=n(9323),c=n.n(s),u=n(51623),d=n(70897),p=n(33503),g=n(25858),y=n(24944),m=n(45018),f=n(9162),w=n(92138),b=n(34435),v=n(61035),h=n(73506),O=n(89888),P=n(57645);let S=["channel"];function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let E=()=>{let e=(0,d.useRelayEnvironment)(),{openLoginDialog:t}=(0,f.g)(),{handleUpdateRosettaState:n}=(0,P.n)(),{isLoggedIn:a}=(0,o.md)(y.b),{updateArticlePianoPaywallStateState:r}=(0,m.useArticlePianoPaywallContext)();return{attachEventHandlers:(0,u.useCallback)(()=>{let o=e=>{let{maxViews:t,views:a,viewsLeft:i}=e;[1,50].includes(t)||(n({meterData:e}),(0,p.g$)("paywallMeterViews",`${a}`),(0,p.g$)("paywallMeterViewsLeft",`${i}`))};l().on("experienceExecute",async e=>{var t,a,i,r;(()=>{var e,t,n,a;(null==(e=window.tp)||null==(e=e.customVariables)?void 0:e.ip_access_user)&&(null==(t=window.tp)||null==(t=t.customVariables)?void 0:t.ip_access_client)&&((0,b.W5)({ipClientName:null==(n=window.tp)||null==(n=n.customVariables)?void 0:n.ip_access_client}),(0,w.EO)({product:"SCMP - IP whitelisting"}),null!=(a=window.tp)&&null!=(a=a.customVariables)&&a.ip_ezproxy_user?(0,w.EO)({ipClientIsEZproxy:"EZproxy"}):(0,w.EO)({ipClientIsEZproxy:"IP whitelisting"}))})();let o="paywallNotRequired";(null==(t=e.result)||null==(t=t.events)||null==(a=t.find)?void 0:a.call(t,e=>{var t;return(null==e||null==(t=e.eventParams)?void 0:t.displayMode)==="inline"}))&&(o="requiresInlinePaywall"),(null==(i=e.result)||null==(i=i.events)||null==(r=i.find)?void 0:r.call(i,e=>{var t;return(null==e||null==(t=e.eventParams)?void 0:t.displayMode)==="modal"}))&&(o="requiresModalPaywall");let s=function(){var e;return((null==(e=window)||null==(e=e.tp)||null==(e=e.customVariables)?void 0:e.ip_access_user)??!1)||Object.values(l().rulesEngine.getFact("ipRangeAccess")).some(Boolean)}();l().rulesEngine.addFact("hasIpAccess",s),l().rulesEngine.setReady("pianoExperience"),await l().rulesEngine.run();let c=null===l()||void 0===l()?void 0:l().rulesEngine.getOutcome("user.hasSCMPLiteAccessRight");n({hasIpAccess:s,hasPianoExperienceExecuted:!0,hasScmpDigitalAccessRight:null===l()||void 0===l()?void 0:l().rulesEngine.getOutcome("user.hasSCMPDigitalAccessRight"),hasScmpLiteAccessRight:c,hasScmpPlusAccessRight:null===l()||void 0===l()?void 0:l().rulesEngine.getOutcome("user.hasSCMPPlusAccessRight")}),h.R.emit("showPaywall",o);let{ipAccess:u,ipRangeContractIds:d,siteLicenseContractIds:p}=l().rulesEngine.getOutcome("tracking.ga4");if(p||d){let e=[p,d].filter(e=>null!==e).join(",");(0,w.EO)({ga4SiteLicensing:e})}let g=null==u?void 0:u.id,y=null==u?void 0:u.type;if(g&&y)switch(y){case"ezproxy":(0,w.EO)({ga4Ezproxy:g});break;case"whitelisting":(0,w.EO)({ga4IpWhitelisting:g})}}),l().on("showOffer",e=>{"modal"===e.displayMode&&document.body.classList.add(v.M),(()=>{if(!e.activeMeters)return;let t=JSON.parse(e.activeMeters);if(!t||0===t.length)return;let[n]=t,{maxViews:i,totalViews:r,viewsLeft:s}=n;if(r>5&&5===i&&0===s&&(o(n),a)){var c;null==(c=l().getService("cartAbandoner"))||c.showCartAbandonerOfferOnNextVisit()}})()}),l().on("meterActive",e=>{o(e)}),l().registerChannelListener("pwa/request-from-template"),l().on("COMM_CHANNEL",async n=>{var a,o,s,u,d,y;let{message:m}=n;if(!(null!=m&&m.requestType))return;switch(m.requestType){case"action/showPaywall":h.R.emit("showPaywall","requiresInlinePaywall"),m.responseData="ready";break;case"action/trackGA4":(0,w.UL)(m.requestData,{untyped:!0});break;case"appConfig/rosetta":case"context/appConfig":m.responseData=l().getRosettaAppConfig();break;case"article/search":let f=await (0,O.aL)({environment:e,filter:{sectionIds:(null==(a=m.requestData)?void 0:a.articleSectionIds)??[]}});m.responseData=f;break;case"cartAbandoner":{let e=l().getService("cartAbandoner");switch(null==(y=m.requestData)?void 0:y.action){case"cartAbandonerOfferShown":null==e||e.cartAbandonerOfferShown();break;case"clearCookies":null==e||e.cleanupCookies();break;case"login":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{trigger_point:"abandoned cart popup"}});break;case"registerOfferShown":null==e||e.registerOfferShown()}return}case"context/subscriptionStatus":m.responseData=l().rulesEngine.getOutcome("user");break;case"localStorage/get":let b=null==(o=m.requestData)?void 0:o.localStorage;null!=b&&b.includes("rSDK_")&&(m.responseData={localStorageResult:localStorage.getItem(b),localStorageVar:b});break;case"localStorage/set":let v=null==(s=m.requestData)?void 0:s.localStorage,P=null==(u=m.requestData)?void 0:u.localStorageVal;null!=v&&v.includes("rSDK_")&&P&&((0,p.g$)(v,JSON.stringify(P)),m.responseData={localStorageResult:P,localStorageVar:v});break;case"login/archive":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"archive_wall",trigger_point:"paywall"},wallType:"archive"});break;case"login/exclusiveHardPaywall":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"exclusive_wall",trigger_point:"paywall"},wallType:"exclusiveWall"});break;case"login/freeTrialPromo":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{trigger_point:"paywall"},wallType:"freeTrialPromo"});break;case"login/google/regiwall":(0,p.g$)("REGI_WALL_LOGIN_METHOD","Google"),location.href=(0,g.E6)({registerSource:"loginwall"});break;case"login/lite":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"lite_wall",trigger_point:"paywall"},wallType:"lite"});break;case"login/meter2":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"meter_wall_2",trigger_point:"paywall"},wallType:"meter2"});break;case"login/meter4":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"meter_wall_4",trigger_point:"paywall"},wallType:"meter4"});break;case"login/newsletter":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"newsletter_wall",trigger_point:"paywall"},wallType:"newsletter"});break;case"login/paywall":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"paywall",trigger_point:"paywall"},wallType:"paywall"});break;case"login/regiwall":t({description:"To continue reading, create your free account or log in now",destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"sign in wall",trigger_point:"paywall"},wallType:"regi"});break;case"login/velocity":t({destination:window.location.origin+window.location.pathname,ga4CustomParameter:{paywall_type:"velocity_wall",trigger_point:"paywall"},wallType:"velocity"});break;case"rendered/paywall":let k=m.requestData.articleEntityId,E=m.requestData.paywallType;k&&(null==r||r({articleEntityId:k,state:`shown${c()(E)}Paywall`}));break;case"rule/facts":m.responseData="*"===m.requestData.name?l().rulesEngine.getAllFacts():l().rulesEngine.getFact(m.requestData.name);break;case"rule/outcome":m.responseData="*"===m.requestData.name?l().rulesEngine.getAllOutcome():l().rulesEngine.getOutcome(m.requestData.name);break;case"tp/customVariables":m.responseData=(null==(d=window.tp)?void 0:d.customVariables)??{};break;default:m.error=!0,m.errorMessage="unknown requestType"}let{channel:C}=m,T=(0,i.A)(m,S);l().sendMessage("pwa/response-from-app",I(I({},n),{},{message:T}))})},[e,n,a,t,r])}}},51503:(e,t,n)=>{n.d(t,{Fg:()=>g,NS:()=>p,lv:()=>d}),n(95429),n(45621),n(37684),n(61100),n(52973),n(89968),n(8871),n(49194);var a,i=n(94413),r=n(51623),l=n(70897),o=n(42497),s=n(1544),c=n(89275),u=n(88769);let d=()=>{let{experiment:e}=(0,c.x)(i.ScmpLiteCoreGeos.SCMP_LITE_CORE_GEOS_TEST_NAME),{experiment:t}=(0,c.x)(i.Lts.LTS_AB_TEST_NAME),{experiment:n}=(0,c.x)(u.u.ContextualPaywallMessaging);(0,r.useEffect)(()=>{[t,e,n].forEach(e=>{e&&i.AbTest.setABTestVariablePianoCustomVariable({experimentId:e.id,testName:e.experimentName,variant:e.variation})})},[n,t,e])},p=e=>{var t;let d=(0,l.readInlineData)(void 0!==a?a:a=n(75585),e),{experiment:p}=(0,c.x)(u.u.VelocityWallThreshold),g=o.$.rosetta.piano.applicationId,y=(0,r.useRef)(i.Lts.getLtsBucketFromLocalStorage(g)??0),m=(0,r.useMemo)(()=>{var e;return null==(e=d.paywallTypes)?void 0:e.map(e=>null==e?void 0:e.entityId)},[d.paywallTypes]),f=null==m?void 0:m.includes(s.X.notVelocity.entityId),w=(0,r.useMemo)(()=>{var e;let t=0===y.current;return!!(null!=p&&null!=(e=p.variation)&&e.name)&&t&&!f&&(null==m?void 0:m.includes(s.X.velocity.entityId))},[null==p||null==(t=p.variation)?void 0:t.name,f,m]);return{applyVelocityWallThresholdLogic:(0,r.useCallback)(()=>{switch(null==p?void 0:p.variation.name){case"0":return null==m?void 0:m.includes(s.X.velocity.entityId);case"1":return null==m?void 0:m.includes(s.X.velocity2kViews.entityId);case"2":return null==m?void 0:m.includes(s.X.velocity3kViews.entityId);default:return!1}},[null==p?void 0:p.variation.name,m]),shouldApplyVelocityWallThresholdTest:w}},g=()=>{let{experiment:e}=(0,c.x)(u.u.LTSHardPaywall),t=o.$.rosetta.piano.applicationId,n=(0,r.useRef)(i.Lts.getLtsBucketFromLocalStorage(t)??0).current;return{ltsHardPaywallABTestTag:(0,r.useMemo)(()=>{var t;return(null==e||null==(t=e.variation)?void 0:t.name)==="1"&&+n>=7?"LTS-Hard-Paywall/hard-paywall-variant":""},[e,n])}}},57645:(e,t,n)=>{n.d(t,{n:()=>c}),n(61100),n(45621),n(52973),n(6611),n(95429),n(37684);var a=n(33261),i=n(10028),r=n(51623),l=n(94663);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let c=()=>{let e=(0,i.Xr)(l.E);return{handleUpdateRosettaState:(0,r.useCallback)((t,n,a)=>{let i=(e,t)=>{let n={error:3,loading:1,"not-executed":0,success:2};return t?n[e]>n[t]?e:t:e};e(e=>({error:a??(null==e?void 0:e.error),result:s(s({},null==e?void 0:e.result),t),status:i(n??"loading",null==e?void 0:e.status)}))},[e])}}},61035:(e,t,n)=>{n.d(t,{M:()=>a});let a="offer-meter-open"},69428:(e,t,n)=>{n.d(t,{N:()=>j}),n(50528),n(49194),n(50109);var a,i=n(94413),r=n.n(i),l=n(94956),o=n(10028),s=n(53438),c=n(51623),u=n(42497),d=n(86269),p=n(83096),g=n(98387),y=n(25858),m=n(79823),f=n(74797),w=n(87232),b=n(99644),v=n(4323),h=n(8934),O=n(92138),P=n(51166),S=n(69524),k=n(70897);let I=()=>{let e=(0,k.useRelayEnvironment)(),[t,i]=(0,l.Y)(async()=>{var t;let i=await (0,k.fetchQuery)(e,void 0!==a?a:a=n(93977),{},{fetchPolicy:"store-or-network"}).toPromise();if(!(null!=i&&null!=(t=i.appConfig)&&t.json))return;let r=i.appConfig.json;return"production"===u.$.general.env?r.production:r.dev});return(0,S.u)(()=>{i.execute()}),{rosettaConfigState:t}};var E=n(49032),C=n(51503),T=n(89888),A=n(91738),_=n(90383),D=n(50601),L=n(57645);let j=()=>{let e=(0,c.useRef)(!1),{navigatorInfo:t,navigatorInfoLoaded:n}=(0,o.md)(P.X),{isRosettaPianoExecutionReady:a,shouldSkipPianoExecution:i}=(0,_.x)(t,n),{registerRosettaCampaignPopupService:S}=(0,v.O)(),{handleUpdateRosettaState:k}=(0,L.n)(),{pianoAccessToken:j,user:$}=(0,y.zI)(),{update:R}=(0,d.n)("scmp_subscriber",e=>e,{domain:u.$.account.cookieDomain,expires:1}),{set:M}=(0,p.Q)("scmp_subscriber",{parse:e=>e,stringify:e=>e}),{set:x}=(0,p.Q)(A.x,{defaultValue:[]}),V=(0,g.O)(),{getUrlAliasByUrl:N}=(0,D.n)(),{attachEventHandlers:K}=(0,E.b)(),{query:U}=(0,s.useRouter)(),H=(0,f.JO)(U.entityId)??"",[F,{execute:q}]=(0,l.Y)(async()=>{if(!(e.current||(0,w.u)("piano"))){e.current=!0,r().setConfig({contentService:{apiKey:u.$.rosetta.contentService.apiKey,apiUri:`${u.$.rosetta.apiGatewayHost}/content-delivery/v2`,env:B(u.$.rosetta.contentService.environment)},piano:{aid:u.$.rosetta.piano.applicationId,apiUri:u.$.rosetta.piano.apiUri,env:"production"===u.$.rosetta.piano.environment.toLocaleLowerCase()?"production":"sandbox"},rosetta:{env:B(u.$.rosetta.environment),uri:`${u.$.rosetta.subscribeHost}`}}).setPageUrl(`${location.origin}${location.pathname}`).setToken(j),r().registerService("geo",{apiKey:u.$.rosetta.contentService.apiKey,apiUri:`${u.$.rosetta.apiGatewayHost}/gloc/v1`}),r().registerService("tierInfo",{apiKey:u.$.rosetta.contentService.apiKey,apiUri:`${u.$.corporateSubscriber.host}/tier`}),r().registerService("pianoUserInfo",{aid:u.$.rosetta.piano.applicationId,apiUri:`${u.$.rosetta.subscribeHost}/api/user`}),r().registerService("pianoPublisherConversions",{aid:u.$.rosetta.piano.applicationId,apiUri:`${u.$.rosetta.subscribeHost}/api/user/conversions`}),r().registerService("onboarding",{env:B(u.$.rosetta.contentService.environment),urlPrefix:u.$.rosetta.subscribeTemplateHost}),r().registerService("mastheadRenewPopUp",{env:B(u.$.rosetta.contentService.environment),urlPrefix:u.$.rosetta.subscribeTemplateHost}),r().registerService("cartAbandoner",{cookieDomain:u.$.account.cookieDomain,env:B(u.$.rosetta.contentService.environment),urlPrefix:u.$.rosetta.subscribeTemplateHost,userTypeApiUri:`${u.$.general.userTypeHost}/client-id/`}),S();try{var t,n;await r().init(),K(),await r().initRules();let{supportPiano:e}=r().rulesEngine.getOutcome("guest");(V===m.g.Homepage||V===m.g.Plus||V===m.g.Section&&(0,h.nu)(H).includes("plus"))&&!1===i&&r().execute();let a=r().rulesEngine.getFact("hasToken"),l=r().rulesEngine.getOutcome("user"),o=r().rulesEngine.getOutcome("tracking"),s=r().rulesEngine.getOutcome("user.isSCMPSubscriber"),c=null===r()||void 0===r()?void 0:r().rulesEngine.getOutcome("user.isSCMPPlusSubscriber");(e=>{let{tier:t}=e??{};(0,b.z2)(t)&&(0,O.EO)({tier:t})})(l),(e=>{var t,n;(0,T.f0)("SUBSCRIBER_STATUS",null==e?void 0:e.subscriberStatus);let a=(null==$||null==(t=$.username)||null==(n=t.split)||null==(n=n.call(t,"@"))?void 0:n[0])??`${(null==$?void 0:$.firstname)??""} ${(null==$?void 0:$.lastname)??""}`;(0,b.z2)(null==a?void 0:a.trim())&&(0,T.f0)("USER_NAME",a),(0,T.f0)("subscribeUrl",(()=>{let e=new URL(u.$.rosetta.subscribeHost);return e.searchParams.set("destination",location.origin),e.toString()})())})(o),R(o.subscriberStatus),M(o.subscriberStatus),x([...c?["scmp-plus"]:[]]),k({contentServiceUserInfo:{isSubscriptionEnabled:e},instance:r(),isScmpPlusSubscriber:c,isScmpSubscriber:s,tracking:o,user:l},"success");let d=N(window.location.href);["/scmp_comments","/newsletters"].every(e=>!d.startsWith(e))&&(null==(n=r().getService("cartAbandoner"))||n.placeTrigger({hasToken:a,isRosetta:!1,isSCMPSubscriber:s})),null==(t=r().getService("mastheadRenewPopUp"))||t.addMastheadRenewPopUpScript()}catch(e){k(void 0,"error",e instanceof Error?e:Error(JSON.stringify(e)))}try{r().initiateSwGLinkingFlow()}catch(e){}}});(0,c.useEffect)(()=>{!e.current&&a&&q()},[q,a]);let{rosettaConfigState:W}=I();function B(e){return"production"===e.toLocaleLowerCase()?"production":"development"}(0,c.useEffect)(()=>{var e;let{isShowPremiumPromo:t=!1,litePaywallTimeFrame:n=3,oldArticleTimeframe:a=15,paywallCampaign:i}=(null==(e=W.result)?void 0:e.paywallSettings)??{};k({appSettings:{isShowPremiumPromo:t,litePaywallTimeFrame:n,oldArticleTimeframe:a,paywallCampaignName:null==i?void 0:i.name}})},[k,W]),(0,C.lv)(),(0,c.useEffect)(()=>{let e;if(V!==m.g.Article)return;let t=!1,n=()=>{var n;t||(e=null==(n=r().setupPaywallCheckoutForPWA({account:{debugLog:u.$.account.debugLog,gtmContainerId:u.$.googleTagManager.containerId,isInWebView:!1,recaptchaContainerId:u.$.account.recaptchaContainerId,recaptchaSiteKey:u.$.account.recaptchaSiteKey,url:u.$.account.scmpAccountHost},scmp:{url:`https://${u.$.domain.scmp}`}}))?void 0:n.cleanup)};return r().on("onReady",n),()=>{var a;t=!0,null==(a=e)||a(),r().off("onReady",n)}},[V])}},73506:(e,t,n)=>{n.d(t,{R:()=>a});let a=new(n(93569)).A},75585:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});let a={kind:"InlineDataFragment",name:"hooksVelocityWallThresholdABTest"};a.hash="24f4781ebcb72939e081458116b35b95";let i=a},81473:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});let a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"first"},{defaultValue:null,kind:"LocalArgument",name:"sectionIds"}],t=[{fields:[{kind:"Variable",name:"sectionIds",variableName:"sectionIds"}],kind:"ObjectValue",name:"filter"},{kind:"Variable",name:"first",variableName:"first"},{kind:"Literal",name:"orderBy",value:{direction:"DESC",field:"PUBLISHED_DATE"}}],n={alias:null,args:null,kind:"ScalarField",name:"entityId",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"headline",storageKey:null},i={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"helpersRosettaPaywallArticleSearchQuery",selections:[{alias:null,args:t,concreteType:"ArticleConnection",kind:"LinkedField",name:"articles",plural:!1,selections:[{alias:null,args:null,concreteType:"ArticleEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Article",kind:"LinkedField",name:"node",plural:!1,selections:[n,a,i],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"helpersRosettaPaywallArticleSearchQuery",selections:[{alias:null,args:t,concreteType:"ArticleConnection",kind:"LinkedField",name:"articles",plural:!1,selections:[{alias:null,args:null,concreteType:"ArticleEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Article",kind:"LinkedField",name:"node",plural:!1,selections:[n,a,i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"532c7f0b9cfd7988a922677512089dc6",id:null,metadata:{},name:"helpersRosettaPaywallArticleSearchQuery",operationKind:"query",text:"query helpersRosettaPaywallArticleSearchQuery(\n  $first: Int!\n  $sectionIds: [String]\n) {\n  articles(first: $first, filter: {sectionIds: $sectionIds}, orderBy: {field: PUBLISHED_DATE, direction: DESC}) {\n    edges {\n      node {\n        entityId\n        headline\n        images {\n          url\n        }\n        id\n      }\n    }\n  }\n}\n"}}}();a.hash="b7c8548733cc146a2f0480854fa2cde3";let i=a},86269:(e,t,n)=>{n.d(t,{n:()=>l});var a=n(98503),i=n(51623),r=n(7982);function l(e,t,n){let[l,o,s]=(0,r.$)(e,n),c=(0,a.J)(t);return{remove:s,update:o,value:(0,i.useMemo)(()=>l&&c.current(l),[c,l])}}},88769:(e,t,n)=>{n.d(t,{u:()=>a});let a={ContextualPaywallMessaging:"Contextual Paywall Messaging",HigherPaywall:"Higher Paywall",HPMostPopularArticleLabel:"Most popular article label",LTSHardPaywall:"LTS 70 Hard Paywall",PaywallMasking:"Paywall Masking",SubNavTrendingLabel:"SubNav Trending Label",VelocityWallThreshold:"Velocity Wall Threshold"}},89275:(e,t,n)=>{n.d(t,{x:()=>r}),n(69597),n(45621),n(49232);var a=n(51623),i=n(93066);let r=e=>{let{activeExperimentStates:t}=(0,i.h)();return{experiment:(0,a.useMemo)(()=>t?Object.values(t).find(t=>t.experimentName===e):null,[e,t])}}},89888:(e,t,n)=>{n.d(t,{RV:()=>u,SI:()=>c,aL:()=>d,f0:()=>s}),n(6611),n(61100),n(45621),n(52973),n(89968),n(8871);var a,i=n(89497),r=n.n(i),l=n(70897),o=n(61035);let s=(e,t)=>{window.tp??=[],c("setCustomVariable",e,t)},c=function(e){window.tp??=[];for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];window.tp.push([e,...n])},u=()=>{var e,t;window.tp&&document.body.classList.contains(o.M)&&(null==(e=window.tp.offer)||null==(t=e.close)||t.call(e),document.body.classList.remove(o.M))},d=async e=>{var t;let{environment:n,filter:a}=e,i={first:(null==a?void 0:a.size)??10,sectionIds:(null==a?void 0:a.sectionIds)??[]},o=await (0,l.fetchQuery)(n,p,i).toPromise();return{articles:(null==o||null==(t=o.articles)||null==(t=t.edges)?void 0:t.map(e=>{var t,n;return{entityId:e.node.entityId,headline:e.node.headline,imageUrl:null==(t=r()(null==e||null==(n=e.node)?void 0:n.images))?void 0:t.url}}))??[]}},p=void 0!==a?a:a=n(81473)},90383:(e,t,n)=>{n.d(t,{x:()=>i});var a=n(51623);let i=(e,t)=>({isRosettaPianoExecutionReady:!!t,shouldSkipPianoExecution:(0,a.useMemo)(()=>null!=e&&!!e.isLightHouseCrawler||(null==e||!e.isBot)&&(null==e?void 0:e.botScoreGroup)==="1-29",[e])})},91738:(e,t,n)=>{n.d(t,{x:()=>a});let a="scmp_subscriptions"},92138:(e,t,n)=>{n.d(t,{EO:()=>c,Rf:()=>o,UL:()=>s}),n(61100),n(45621),n(52973),n(95429),n(37684);var a=n(33261);n(50528),n(6611);var i=n(34435);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let o=()=>{var e;if("plus"===new URLSearchParams(window.location.search).get("display")||(null==(e=window.location.pathname.split("/"))?void 0:e[1])==="plus")return!0};function s(e,t){var n;let a=o();(0,i.gl)(l({_clear:!0,event:"GA4_tracking"},l(l({},e),{},{customized_parameters:l(l(l({},null==e?void 0:e.customized_parameters),a&&{product:"plus"}),!(null!=e&&null!=(n=e.customized_parameters)&&n.page_location)&&{page_location:window.location.href})})),t)}let c=e=>{var t;null==(t=window.dataLayer)||t.push({_clear:!1,userProperties:e})}},93977:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});let a=function(){var e=[{kind:"Literal",name:"filter",value:{entityId:"rosetta"}}],t={alias:null,args:null,kind:"ScalarField",name:"json",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"rosettaConfigAppConfigQuery",selections:[{alias:null,args:e,concreteType:"AppConfig",kind:"LinkedField",name:"appConfig",plural:!1,selections:[t],storageKey:'appConfig(filter:{"entityId":"rosetta"})'}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"rosettaConfigAppConfigQuery",selections:[{alias:null,args:e,concreteType:"AppConfig",kind:"LinkedField",name:"appConfig",plural:!1,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:'appConfig(filter:{"entityId":"rosetta"})'}]},params:{cacheID:"ba87f29d45e0c4f16483caf962f6a201",id:null,metadata:{},name:"rosettaConfigAppConfigQuery",operationKind:"query",text:'query rosettaConfigAppConfigQuery {\n  appConfig(filter: {entityId: "rosetta"}) {\n    json\n    id\n  }\n}\n'}}}();a.hash="6f94a6408d173e20bb7b38467308b96e";let i=a}}]);
//# sourceMappingURL=1283.7a906b1c64260fff.js.map