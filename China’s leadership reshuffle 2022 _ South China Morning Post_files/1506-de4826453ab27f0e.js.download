!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="5d697811-be80-4186-ae8e-99859f23dcd1",e._sentryDebugIdIdentifier="sentry-dbid-5d697811-be80-4186-ae8e-99859f23dcd1")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1506],{5538:(e,n,l)=>{l.d(n,{t:()=>t});let t=function(e){return e.Bookmark="Bookmark",e.UnBookmark="UnBookmark",e}({})},13108:(e,n,l)=>{l.d(n,{S:()=>t});let t=(0,l(19764).eU)({})},13890:(e,n,l)=>{l.d(n,{Q:()=>t});let t=(0,l(19764).eU)({showNewBookmarkAnimation:!1,showRippleEffect:!1,showSmallRipple:!1,toggleBookmarkRippleEffect:()=>{},toggleShowNewBookmarkAnimation:()=>{}})},21506:(e,n,l)=>{l.d(n,{v:()=>Q,O:()=>N}),l(6611),l(95429),l(37684);var t,a,o,r=l(33261);l(89968),l(8871),l(61100),l(45621),l(52973),l(21218),l(66087),l(50528);var i=l(88833),s=l.n(i),c=l(10028),d=l(28086),u=l.n(d),k=l(91396),m=l.n(k),y=l(19775),g=l.n(y),p=l(51623),f=l(70897),b=l(6261),w=l(5538),v=l(76920),h=l(42497),F=l(24944),O=l(99644),E=l(98503),K=l(74256),S=l(86904);function A(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),l.push.apply(l,t)}return l}function L(e){for(var n=1;n<arguments.length;n++){var l=null!=arguments[n]?arguments[n]:{};n%2?A(Object(l),!0).forEach(function(n){(0,r.A)(e,n,l[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):A(Object(l)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(l,n))})}return e}let B=e=>{let{enqueueSnackbar:n}=(0,K.dh)(),{enabled:l=!0}=(0,S.g)(),t=(0,E.J)(e);return{handleOpenSnackbar:(0,p.useCallback)(e=>{var a;let{duration:o,leftElement:r,rightElement:i}=e;l&&n(L(L({},t.current),{},{autoHideDuration:o,leftElement:r,rightElement:i,style:L({},null==(a=t.current)?void 0:a.style),variant:"simple"}))},[l,n,t])}};var I=l(15122),T=l(21508),j=l(49994);let D=(0,I.A)("div",{target:"ef9k2dx1"})("color:#ffffff;font-size:16px;font-family:",j.XT,";"),C=(0,I.A)(T.s,{target:"ef9k2dx0"})("color:#4585ff;font-weight:900;font-size:16px;font-family:",j.XT,";");var P=l(53308),$=l(13890),x=l(9162),U=l(92138),M=l(80613),R=l(13108),V=l(43575);function _(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),l.push.apply(l,t)}return l}function z(e){for(var n=1;n<arguments.length;n++){var l=null!=arguments[n]?arguments[n]:{};n%2?_(Object(l),!0).forEach(function(n){(0,r.A)(e,n,l[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):_(Object(l)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(l,n))})}return e}let N=()=>{let{isLoggedIn:e}=(0,c.md)(F.b),n=(0,M.yu)(),a=(0,c.Xr)(R.S),o=(0,p.useCallback)(async()=>{let e=await (0,f.fetchQuery)(n,void 0!==t?t:t=l(27942),{},{fetchPolicy:"network-only"}).toPromise();if((0,O.z2)(e))return{bookmarks:(null==e?void 0:e.bookmarks.edges.filter(e=>{let{node:n}=e;return(0,O.z2)(n)}).map(e=>{let{node:n}=e;return n.targetEntityId}))??[],follows:(null==e?void 0:e.follows.edges.filter(e=>{let{node:n}=e;return(0,O.z2)(n)}).map(e=>{let{node:n}=e;return`${n.type}:${n.targetEntityId}`}))??[]}},[n]),{data:r,mutate:i}=(0,v.Ay)(e?"user-service-init":null,o,{refreshInterval:36e5,revalidateOnFocus:!1,revalidateOnMount:!0,revalidateOnReconnect:!0});(0,p.useEffect)(()=>{(r||i)&&a(z(z({},r),{},{mutate:i}))},[r,i,a])},q=(e,n,l)=>e?m()(n,l):u()(n,l),Q=()=>{let{bookmarks:e,follows:n,mutate:t}=(0,c.md)(R.S),{handleOpenSnackbar:r}=B(),{isLoggedIn:i}=(0,c.md)(F.b),{openLoginDialog:d}=(0,x.g)(),{toggleBookmarkRippleEffect:u,toggleShowNewBookmarkAnimation:k}=(0,c.md)($.Q),m=(0,M.yu)(),y=e=>{switch(e.toLowerCase()){case"author":return b.y.Author;case"section":return b.y.Section;case"topic":return b.y.Topic}},v=(0,p.useCallback)(n=>(null==e?void 0:e.some(e=>e===n))??!1,[e]),O=(0,p.useCallback)((e,l)=>{let t=y(e);return void 0!==t&&((null==n?void 0:n.some(e=>e===`${t}:${l}`))??!1)},[n]);return{bookmarkAction:(0,p.useCallback)(async(e,n,o,c)=>{var y,p;let b=e===w.t.Bookmark?"add":"remove";null!=o&&null!=(y=o.ga4Events)&&y.click&&(0,U.UL)(s()(o.ga4Events.click,{customized_parameters:{action_type:b}}),{untyped:!0});let v=()=>{let e=new URL(window.location.href);e.search=g().stringify({action:{bookmark:n}}),d({description:"Login or register to save your favourite articles.",destination:e.toString(),ga4CustomParameter:{trigger_point:"bookmark"},title:"Bookmark this story"})};if(!i)return void v();if(t)try{await t(t=>new Promise((i,d)=>{(0,f.commitMutation)(m,{mutation:void 0!==a?a:a=l(47799),onCompleted:n=>{var l;let{bookmarkResults:a}=n;i(z(z({},t),{},{bookmarks:q(e===w.t.Bookmark,(null==t?void 0:t.bookmarks)??[],a.edges.map(e=>{let{node:n}=e;return n.targetEntityId}))})),null!=o&&null!=(l=o.ga4Events)&&l.click&&(0,U.UL)(s()(o.ga4Events.click,{action:"sys",customized_parameters:{action_type:b}}),{untyped:!0}),r({duration:4e3,leftElement:(0,V.jsx)(D,{"data-qa":"useUserService-bookmarkAction-StyledSnackbarMessage",children:e===w.t.Bookmark?"Bookmarked":"Unbookmarked"}),rightElement:(0,V.jsx)(C,{pathname:`${h.$.account.scmpAccountHost}/manage/bookmark`,"data-qa":"useUserService-bookmarkAction-StyledSnackbarAction",children:"View all"})}),e===w.t.Bookmark&&(u(),k(!0)),null==c||c()},onError:e=>{d(e)},variables:{action:e,entityIds:[n]}})}),{optimisticData:l=>z(z({},l),{},{bookmarks:q(e===w.t.Bookmark,(null==l?void 0:l.bookmarks)??[],[n])}),populateCache:!0,revalidate:!1,rollbackOnError:!0})}catch(e){(null==e||null==(p=e.res)?void 0:p.status)===401&&v()}},[m,r,i,t,d,u,k]),checkIsBookmarked:v,checkIsFollowed:O,followAction:(0,p.useCallback)(async(e,n,a,s)=>{if(!i||!t)return;let c=y(n);if(void 0!==c)try{await t(n=>new Promise((t,i)=>{(0,f.commitMutation)(m,{mutation:void 0!==o?o:o=l(40350),onCompleted:l=>{let{followResults:a}=l;t(z(z({},n),{},{follows:q(e===b.WD.Follow,(null==n?void 0:n.follows)??[],a.edges.map(e=>{let{node:n}=e;return`${n.type}:${n.targetEntityId}`}))})),r({duration:4e3,leftElement:(0,V.jsx)(P.ey,{"data-qa":"useUserService-followAction-SnackbarMessageContainer",children:e===b.WD.Follow?"Following":"Unfollowed"}),rightElement:(0,V.jsx)(P.aB,{pathname:h.$.account.scmpAccountHost+"/manage/following","data-qa":"useUserService-followAction-SnackbarViewAllLink",children:"View all"})}),null==s||s()},onError:e=>{i(e)},variables:{action:e,entityIds:a,type:c}})}),{optimisticData:n=>z(z({},n),{},{follows:q(e===b.WD.Follow,(null==n?void 0:n.follows)??[],a.map(e=>`${c}:${e}`))}),populateCache:!0,revalidate:!1,rollbackOnError:!0})}catch(e){null==s||s(e)}},[m,r,i,t])}}},27942:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});let t=function(){var e=[{kind:"Literal",name:"first",value:1e4}],n={alias:null,args:null,kind:"ScalarField",name:"targetEntityId",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"hooksFetchUserServiceQuery",selections:[{alias:null,args:e,concreteType:"BookmarkConnection",kind:"LinkedField",name:"bookmarks",plural:!1,selections:[{alias:null,args:null,concreteType:"BookmarkEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Bookmark",kind:"LinkedField",name:"node",plural:!1,selections:[n],storageKey:null}],storageKey:null}],storageKey:"bookmarks(first:10000)"},{alias:null,args:e,concreteType:"FollowConnection",kind:"LinkedField",name:"follows",plural:!1,selections:[{alias:null,args:null,concreteType:"FollowEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Follow",kind:"LinkedField",name:"node",plural:!1,selections:[n,l],storageKey:null}],storageKey:null}],storageKey:"follows(first:10000)"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"hooksFetchUserServiceQuery",selections:[{alias:null,args:e,concreteType:"BookmarkConnection",kind:"LinkedField",name:"bookmarks",plural:!1,selections:[{alias:null,args:null,concreteType:"BookmarkEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Bookmark",kind:"LinkedField",name:"node",plural:!1,selections:[n,t],storageKey:null}],storageKey:null}],storageKey:"bookmarks(first:10000)"},{alias:null,args:e,concreteType:"FollowConnection",kind:"LinkedField",name:"follows",plural:!1,selections:[{alias:null,args:null,concreteType:"FollowEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Follow",kind:"LinkedField",name:"node",plural:!1,selections:[n,l,t],storageKey:null}],storageKey:null}],storageKey:"follows(first:10000)"}]},params:{cacheID:"90c2baff000f3ccc3c4384bd618f3f7c",id:null,metadata:{},name:"hooksFetchUserServiceQuery",operationKind:"query",text:"query hooksFetchUserServiceQuery {\n  bookmarks(first: 10000) {\n    edges {\n      node {\n        targetEntityId\n        id\n      }\n    }\n  }\n  follows(first: 10000) {\n    edges {\n      node {\n        targetEntityId\n        type\n        id\n      }\n    }\n  }\n}\n"}}}();t.hash="f184ed634a94910a5e58d9b497ca4c99";let a=t},40350:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});let t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"action"},n={defaultValue:null,kind:"LocalArgument",name:"entityIds"},l={defaultValue:null,kind:"LocalArgument",name:"type"},t=[{kind:"Variable",name:"action",variableName:"action"},{kind:"Variable",name:"entityIds",variableName:"entityIds"},{kind:"Variable",name:"type",variableName:"type"}],a={alias:null,args:null,kind:"ScalarField",name:"targetEntityId",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"hooksFollowActionMutation",selections:[{alias:"followResults",args:t,concreteType:"FollowConnection",kind:"LinkedField",name:"follow",plural:!1,selections:[{alias:null,args:null,concreteType:"FollowEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Follow",kind:"LinkedField",name:"node",plural:!1,selections:[a,o],storageKey:null}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,l,n],kind:"Operation",name:"hooksFollowActionMutation",selections:[{alias:"followResults",args:t,concreteType:"FollowConnection",kind:"LinkedField",name:"follow",plural:!1,selections:[{alias:null,args:null,concreteType:"FollowEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Follow",kind:"LinkedField",name:"node",plural:!1,selections:[a,o,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"ea73745a1b60089ba61fc1831a38f8ce",id:null,metadata:{},name:"hooksFollowActionMutation",operationKind:"mutation",text:"mutation hooksFollowActionMutation(\n  $action: FollowAction!\n  $type: FollowType!\n  $entityIds: [String!]!\n) {\n  followResults: follow(action: $action, type: $type, entityIds: $entityIds) {\n    edges {\n      node {\n        targetEntityId\n        type\n        id\n      }\n    }\n  }\n}\n"}}}();t.hash="609ca9e0789a6f11591f7e90529f11c2";let a=t},47799:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});let t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"action"},{defaultValue:null,kind:"LocalArgument",name:"entityIds"}],n=[{kind:"Variable",name:"action",variableName:"action"},{kind:"Variable",name:"entityIds",variableName:"entityIds"}],l={alias:null,args:null,kind:"ScalarField",name:"targetEntityId",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksBookmarkActionMutation",selections:[{alias:"bookmarkResults",args:n,concreteType:"BookmarkConnection",kind:"LinkedField",name:"bookmark",plural:!1,selections:[{alias:null,args:null,concreteType:"BookmarkEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Bookmark",kind:"LinkedField",name:"node",plural:!1,selections:[l],storageKey:null}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksBookmarkActionMutation",selections:[{alias:"bookmarkResults",args:n,concreteType:"BookmarkConnection",kind:"LinkedField",name:"bookmark",plural:!1,selections:[{alias:null,args:null,concreteType:"BookmarkEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Bookmark",kind:"LinkedField",name:"node",plural:!1,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"c84c9dcab4e375d9c96358eb56bf676a",id:null,metadata:{},name:"hooksBookmarkActionMutation",operationKind:"mutation",text:"mutation hooksBookmarkActionMutation(\n  $action: BookmarkAction!\n  $entityIds: [String!]!\n) {\n  bookmarkResults: bookmark(action: $action, entityIds: $entityIds) {\n    edges {\n      node {\n        targetEntityId\n        id\n      }\n    }\n  }\n}\n"}}}();t.hash="da7b1e549171a99ab7937b8911d65c61";let a=t},53308:(e,n,l)=>{l.d(n,{aB:()=>i,ey:()=>r,xk:()=>s}),l(61100),l(45621),l(52973),l(6611),l(95429),l(37684);var t=l(15122),a=l(21508),o=l(49994);let r=(0,t.A)("span",{target:"e1plt2it2"})("color:#ffffff;font-size:16px;font-family:",o.XT,";"),i=(0,t.A)(a.s,{target:"e1plt2it1"})("color:#4585ff;font-weight:900;font-size:16px;font-family:",o.XT,";"),s=(0,t.A)("div",{target:"e1plt2it0"})({name:"1nth7ss",styles:"position:relative;display:inline-flex;align-items:center;inline-size:fit-content"})},86904:(e,n,l)=>{l.d(n,{g:()=>c,m:()=>s});var t=l(44590),a=l(51623),o=l(43575);let r=["children"],i=(0,a.createContext)({enabled:!0}),s=e=>{let{children:n}=e,l=(0,t.A)(e,r);return(0,o.jsx)(i.Provider,{value:l,children:n})};s.displayName="SimpleSnackbarContextProvider";let c=()=>(0,a.useContext)(i)}}]);
//# sourceMappingURL=1506-de4826453ab27f0e.js.map